/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";var e={58394:function(e,t,n){e.exports=n.p+"aa4de94bf4f733cca96b.css"}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.m=e,n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(){var n,r,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",c=a.toStringTag||"@@toStringTag";function i(e,a,o,c){var i=a&&a.prototype instanceof l?a:l,u=Object.create(i.prototype);return t(u,"_invoke",function(e,t,a){var o,c,i,l=0,u=a||[],d=!1,p={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(e,t){return o=e,c=0,i=n,p.n=t,s}};function f(e,t){for(c=e,i=t,r=0;!d&&l&&!a&&r<u.length;r++){var a,o=u[r],f=p.p,v=o[2];e>3?(a=v===t)&&(i=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=n):o[0]<=f&&((a=e<2&&f<o[1])?(c=0,p.v=t,p.n=o[1]):f<v&&(a=e<3||o[0]>t||t>v)&&(o[4]=e,o[5]=t,p.n=v,c=0))}if(a||e>1)return s;throw d=!0,t}return function(a,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,i=v;(r=c<2?n:i)||!d;){o||(c?c<3?(c>1&&(p.n=-1),f(c,i)):p.n=i:p.v=i);try{if(l=2,o){if(c||(a="next"),r=o[a]){if(!(r=r.call(o,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,c<2&&(c=0)}else 1===c&&(r=o.return)&&r.call(o),c<2&&(i=TypeError("The iterator does not provide a '"+a+"' method"),c=1);o=n}else if((r=(d=p.n<0)?i:e.call(t,p))!==s)break}catch(e){o=n,c=1,i=e}finally{l=1}}return{value:r,done:d}}}(e,o,c),!0),u}var s={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var p=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),f=d.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,c,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=d,t(f,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,c,"GeneratorFunction"),t(f),t(f,c,"Generator"),t(f,o,function(){return this}),t(f,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:v}})()}function t(e,n,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,a){function c(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},t(e,n,r,a)}function n(e,t,n,r,a,o,c){try{var i=e[o](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var c=e.apply(t,r);function i(e){n(c,a,o,i,s,"next",e)}function s(e){n(c,a,o,i,s,"throw",e)}i(void 0)})}}var a="excel_copilot_api_key",o={apiKey:"",lastResponse:null,pendingAction:null,selectionData:null,selectionAddress:"",chatHistory:[],isFirstMessage:!0},c={};function i(){return i=r(e().m(function t(){var n;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Excel.run(function(){var t=r(e().m(function t(n){return e().w(function(e){for(;;)switch(e.n){case 0:return n.workbook.worksheets.getActiveWorksheet().onSelectionChanged.add(s),e.n=1,n.sync();case 1:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 1:t.n=3;break;case 2:t.p=2,n=t.v,console.log("Selection handler setup skipped:",n.message);case 3:return t.a(2)}},t,null,[[0,2]])})),i.apply(this,arguments)}function s(){return l.apply(this,arguments)}function l(){return(l=r(e().m(function t(){var n;return e().w(function(e){for(;;)switch(e.n){case 0:if(null===(n=c.useSelection)||void 0===n||!n.checked){e.n=1;break}return e.n=1,u();case 1:return e.a(2)}},t)}))).apply(this,arguments)}function u(){return d.apply(this,arguments)}function d(){return d=r(e().m(function t(){var n,a;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:if(null===(n=c.useSelection)||void 0===n?void 0:n.checked){t.n=1;break}return c.selectionText.textContent="Selection disabled",o.selectionData=null,o.selectionAddress="",t.a(2);case 1:return t.p=1,t.n=2,Excel.run(function(){var t=r(e().m(function t(n){var r,a,i;return e().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.getSelectedRange()).load(["address","values","rowCount","columnCount"]),e.n=1,n.sync();case 1:o.selectionAddress=r.address,o.selectionData=r.values,a=r.rowCount,i=r.columnCount,c.selectionText.textContent="".concat(r.address," (").concat(a,"×").concat(i,")");case 2:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:t.n=4;break;case 3:t.p=3,a=t.v,c.selectionText.textContent="No selection",console.error("Selection error:",a);case 4:return t.a(2)}},t,null,[[1,3]])})),d.apply(this,arguments)}function p(){o.isFirstMessage&&(c.welcomeScreen.style.display="none",c.chatContainer.classList.add("active"),o.isFirstMessage=!1)}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";p();var r=document.createElement("div");r.className="message ".concat(e," ").concat(n);var a="ai"===e?"fa-sparkles":"fa-user";r.innerHTML='\n        <div class="message-avatar">\n            <i class="fas '.concat(a,'"></i>\n        </div>\n        <div class="message-content">').concat(function(e){var t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return(t=(t=(t=t.replace(/```(\w*)\n?([\s\S]*?)```/g,function(e,t,n){return"<pre>".concat(n.trim(),"</pre>")})).replace(/`([^`]+)`/g,"<code>$1</code>")).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")).replace(/\n/g,"<br>")}(t),"</div>\n    "),c.chatContainer.appendChild(r),c.chatContainer.scrollTop=c.chatContainer.scrollHeight,o.chatHistory.push({role:e,content:t,type:n})}function v(){p();var e=document.createElement("div");e.className="message ai",e.id="typingIndicator",e.innerHTML='\n        <div class="message-avatar">\n            <i class="fas fa-sparkles"></i>\n        </div>\n        <div class="message-content">\n            <div class="typing-indicator">\n                <span></span><span></span><span></span>\n            </div>\n        </div>\n    ',c.chatContainer.appendChild(e),c.chatContainer.scrollTop=c.chatContainer.scrollHeight}function g(){var e;null===(e=document.getElementById("typingIndicator"))||void 0===e||e.remove()}function h(){return m.apply(this,arguments)}function m(){return(m=r(e().m(function t(){var n,r,a,i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=c.promptInput.value.trim()){e.n=1;break}return e.a(2);case 1:if(o.apiKey){e.n=2;break}return B(),O("Please set your API key first","warning"),e.a(2);case 2:return f("user",n),c.promptInput.value="",c.promptInput.style.height="auto",c.sendBtn.disabled=!0,v(),e.p=3,e.n=4,y(n);case 4:r=e.v,g(),a=I(r),o.lastResponse=a,f("ai",a.message,a.hasAction?"action":"normal"),a.hasAction&&(c.applyBtn.disabled=!1,o.pendingAction=a.action),e.n=6;break;case 5:e.p=5,i=e.v,g(),f("ai","Sorry, I encountered an error: ".concat(i.message),"error");case 6:return e.a(2)}},t,null,[[3,5]])}))).apply(this,arguments)}function y(e){return w.apply(this,arguments)}function w(){return(w=r(e().m(function t(n){var r,a,c,i,s,l,u;return e().w(function(e){for(;;)switch(e.n){case 0:return a=b(),c=E(),i="".concat(a,"\n\n").concat(c,"\n\nUser: ").concat(n),s="".concat("https://generativelanguage.googleapis.com/v1beta/models/").concat("gemini-2.0-flash",":generateContent?key=").concat(encodeURIComponent(o.apiKey)),e.n=1,fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}],generationConfig:{temperature:.7,maxOutputTokens:2048}})});case 1:if((l=e.v).ok){e.n=3;break}return e.n=2,l.text();case 2:throw e.v,new Error("API Error: ".concat(l.status));case 3:return e.n=4,l.json();case 4:return u=e.v,e.a(2,(null==u||null===(r=u.candidates)||void 0===r||null===(r=r[0])||void 0===r||null===(r=r.content)||void 0===r||null===(r=r.parts)||void 0===r?void 0:r.map(function(e){return e.text||""}).join(""))||"")}},t)}))).apply(this,arguments)}function b(){return'You are Excel AI Copilot, a helpful assistant for Microsoft Excel. You help users analyze data, create formulas, generate charts, and automate tasks.\n\nBe concise and friendly. When providing formulas, use exact Excel syntax.\n\nWhen you want to modify the sheet, include an ACTION block:\n[ACTION]\ntype: formula|values|format|chart\ntarget: cell reference or "selection"\ndata: the data to apply\n[/ACTION]\n\nOnly include ACTION blocks when the user wants to modify the sheet.'}function E(){var e,t;if(!o.selectionData||!o.selectionAddress)return"No data selected.";for(var n=Math.min(o.selectionData.length,100),r=Math.min((null===(e=o.selectionData[0])||void 0===e?void 0:e.length)||0,26),a="",c=0;c<n;c++){for(var i=[],s=0;s<r;s++){var l;i.push(null!==(l=o.selectionData[c][s])&&void 0!==l?l:"")}a+=i.join("\t")+"\n"}return"Selected: ".concat(o.selectionAddress," (").concat(o.selectionData.length," rows × ").concat((null===(t=o.selectionData[0])||void 0===t?void 0:t.length)||0," cols)\n\nData:\n").concat(a)}function I(e){var t=e.match(/\[ACTION\]([\s\S]*?)\[\/ACTION\]/);if(t){var n,r,a,o=t[1],c=o.match(/type:\s*(\w+)/),i=o.match(/target:\s*([^\n]+)/),s=o.match(/data:\s*([\s\S]*?)(?=\n\w+:|$)/);return{message:e.replace(/\[ACTION\][\s\S]*?\[\/ACTION\]/,"").trim()||"Ready to apply changes. Click 'Apply to Sheet' when ready.",hasAction:!0,action:{type:(null==c||null===(n=c[1])||void 0===n?void 0:n.trim())||"value",target:(null==i||null===(r=i[1])||void 0===r?void 0:r.trim())||"selection",data:(null==s||null===(a=s[1])||void 0===a?void 0:a.trim())||""}}}return{message:e,hasAction:!1,action:null}}function k(){return C.apply(this,arguments)}function C(){return C=r(e().m(function t(){var n,a;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:if(o.pendingAction){t.n=1;break}return O("No changes to apply","error"),t.a(2);case 1:return n=o.pendingAction,t.p=2,t.n=3,Excel.run(function(){var t=r(e().m(function t(r){var a,o,c,i,s;return e().w(function(e){for(;;)switch(e.n){case 0:o=r.workbook.worksheets.getActiveWorksheet(),c="selection"!==n.target&&n.target?o.getRange(n.target):r.workbook.getSelectedRange(),s=n.type,e.n="formula"===s?1:"values"===s||"value"===s?2:"format"===s?3:"chart"===s?4:5;break;case 1:return c.formulas=[[n.data]],e.a(3,6);case 2:try{i=JSON.parse(n.data),Array.isArray(i)?Array.isArray(i[0])||(i=[i]):i=[[i]]}catch(e){i=[[n.data]]}return(i.length>1||(null===(a=i[0])||void 0===a?void 0:a.length)>1)&&(c=c.getCell(0,0).getResizedRange(i.length-1,i[0].length-1)),c.values=i,e.a(3,6);case 3:return S(c,n.data),e.a(3,6);case 4:return x(0,o,c,n.data),e.a(3,6);case 5:c.values=[[n.data]];case 6:return e.n=7,r.sync();case 7:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 3:return f("ai","✅ Changes applied successfully!","action"),O("Changes applied!"),o.pendingAction=null,c.applyBtn.disabled=!0,t.n=4,u();case 4:t.n=6;break;case 5:t.p=5,a=t.v,f("ai","❌ Failed to apply: ".concat(a.message),"error"),O("Failed to apply changes","error");case 6:return t.a(2)}},t,null,[[2,5]])})),C.apply(this,arguments)}function S(e,t){var n=t.toLowerCase();n.includes("bold")&&(e.format.font.bold=!0),n.includes("italic")&&(e.format.font.italic=!0),n.includes("currency")&&(e.numberFormat=[["$#,##0.00"]]),n.includes("percent")&&(e.numberFormat=[["0.00%"]]),n.includes("header")&&(e.format.font.bold=!0,e.format.fill.color="#7C3AED",e.format.font.color="#FFFFFF")}function x(e,t,n,r){var a=r.toLowerCase(),o=Excel.ChartType.columnClustered;a.includes("line")?o=Excel.ChartType.line:a.includes("pie")?o=Excel.ChartType.pie:a.includes("bar")?o=Excel.ChartType.barClustered:a.includes("area")&&(o=Excel.ChartType.area);var c=t.charts.add(o,n,Excel.ChartSeriesBy.auto);c.setPosition("H2","O15"),c.title.text="Generated Chart"}function B(){c.apiKeyInput.value=o.apiKey,c.settingsModal.classList.add("active")}function T(){c.settingsModal.classList.remove("active")}function A(){var e=c.apiKeyInput.value.trim();o.apiKey=e,localStorage.setItem(a,e),T(),O("Settings saved!")}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=c.toast.querySelector("i");n.className="success"===t?"fas fa-check-circle":"fas fa-exclamation-circle",n.style.color="success"===t?"var(--success)":"var(--error)",c.toastMessage.textContent=e,c.toast.classList.add("show"),setTimeout(function(){c.toast.classList.remove("show")},3e3)}Office.onReady(function(e){var t,n,r,s,l,d,p,f,v,g,m,y,w;e.host===Office.HostType.Excel&&(c.welcomeScreen=document.getElementById("welcomeScreen"),c.chatContainer=document.getElementById("chatContainer"),c.promptInput=document.getElementById("promptInput"),c.sendBtn=document.getElementById("sendBtn"),c.applyBtn=document.getElementById("applyBtn"),c.refreshBtn=document.getElementById("refreshBtn"),c.useSelection=document.getElementById("useSelection"),c.selectionText=document.getElementById("selectionText"),c.contextInfo=document.getElementById("contextInfo"),c.settingsBtn=document.getElementById("settingsBtn"),c.settingsModal=document.getElementById("settingsModal"),c.closeSettings=document.getElementById("closeSettings"),c.cancelSettings=document.getElementById("cancelSettings"),c.saveSettings=document.getElementById("saveSettings"),c.apiKeyInput=document.getElementById("apiKeyInput"),c.togglePassword=document.getElementById("togglePassword"),c.toast=document.getElementById("toast"),c.toastMessage=document.getElementById("toastMessage"),o.apiKey=localStorage.getItem(a)||"",null===(n=c.sendBtn)||void 0===n||n.addEventListener("click",h),null===(r=c.promptInput)||void 0===r||r.addEventListener("keydown",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h())}),null===(s=c.promptInput)||void 0===s||s.addEventListener("input",function(){c.sendBtn.disabled=!c.promptInput.value.trim()}),null===(l=c.applyBtn)||void 0===l||l.addEventListener("click",k),null===(d=c.refreshBtn)||void 0===d||d.addEventListener("click",function(){c.refreshBtn.classList.add("spinning"),u().then(function(){setTimeout(function(){return c.refreshBtn.classList.remove("spinning")},500)})}),null===(p=c.useSelection)||void 0===p||p.addEventListener("change",u),null===(f=c.settingsBtn)||void 0===f||f.addEventListener("click",B),null===(v=c.closeSettings)||void 0===v||v.addEventListener("click",T),null===(g=c.cancelSettings)||void 0===g||g.addEventListener("click",T),null===(m=c.saveSettings)||void 0===m||m.addEventListener("click",A),null===(y=c.togglePassword)||void 0===y||y.addEventListener("click",function(){var e=c.apiKeyInput,t=c.togglePassword.querySelector("i");"password"===e.type?(e.type="text",t.classList.replace("fa-eye","fa-eye-slash")):(e.type="password",t.classList.replace("fa-eye-slash","fa-eye"))}),null===(w=c.settingsModal)||void 0===w||w.addEventListener("click",function(e){e.target===c.settingsModal&&T()}),document.querySelectorAll(".suggestion-chip").forEach(function(e){e.addEventListener("click",function(){var t=e.dataset.prompt;c.promptInput.value=t,c.sendBtn.disabled=!1,h()})}),u(),function(){i.apply(this,arguments)}(),(t=c.promptInput)&&t.addEventListener("input",function(){t.style.height="auto",t.style.height=Math.min(t.scrollHeight,120)+"px"}))})}(),new URL(n(58394),n.b)}();
//# sourceMappingURL=taskpane.js.map