/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";var e={58394:function(e,t,n){e.exports=n.p+"28aa308a3fe61fe20f80.css"}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.m=e,n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(){var n,r,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",c=a.toStringTag||"@@toStringTag";function i(e,a,o,c){var i=a&&a.prototype instanceof l?a:l,u=Object.create(i.prototype);return t(u,"_invoke",function(e,t,a){var o,c,i,l=0,u=a||[],d=!1,p={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(e,t){return o=e,c=0,i=n,p.n=t,s}};function f(e,t){for(c=e,i=t,r=0;!d&&l&&!a&&r<u.length;r++){var a,o=u[r],f=p.p,m=o[2];e>3?(a=m===t)&&(i=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=n):o[0]<=f&&((a=e<2&&f<o[1])?(c=0,p.v=t,p.n=o[1]):f<m&&(a=e<3||o[0]>t||t>m)&&(o[4]=e,o[5]=t,p.n=m,c=0))}if(a||e>1)return s;throw d=!0,t}return function(a,u,m){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,m),c=u,i=m;(r=c<2?n:i)||!d;){o||(c?c<3?(c>1&&(p.n=-1),f(c,i)):p.n=i:p.v=i);try{if(l=2,o){if(c||(a="next"),r=o[a]){if(!(r=r.call(o,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,c<2&&(c=0)}else 1===c&&(r=o.return)&&r.call(o),c<2&&(i=TypeError("The iterator does not provide a '"+a+"' method"),c=1);o=n}else if((r=(d=p.n<0)?i:e.call(t,p))!==s)break}catch(e){o=n,c=1,i=e}finally{l=1}}return{value:r,done:d}}}(e,o,c),!0),u}var s={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var p=[][o]?r(r([][o]())):(t(r={},o,function(){return this}),r),f=d.prototype=l.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,c,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=d,t(f,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,c,"GeneratorFunction"),t(f),t(f,c,"Generator"),t(f,o,function(){return this}),t(f,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:m}})()}function t(e,n,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}t=function(e,n,r,a){function c(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?o?o(e,n,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},t(e,n,r,a)}function n(e,t,n,r,a,o,c){try{var i=e[o](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var c=e.apply(t,r);function i(e){n(c,a,o,i,s,"next",e)}function s(e){n(c,a,o,i,s,"throw",e)}i(void 0)})}}var a="excel_copilot_api_key",o={apiKey:"",lastResponse:null,pendingAction:null,selectionData:null,selectionAddress:"",chatHistory:[]};function c(){return c=r(e().m(function t(){var n;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,Excel.run(function(){var t=r(e().m(function t(n){return e().w(function(e){for(;;)switch(e.n){case 0:return n.workbook.worksheets.getActiveWorksheet().onSelectionChanged.add(i),e.n=1,n.sync();case 1:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 1:t.n=3;break;case 2:t.p=2,n=t.v,console.log("Selection handler setup skipped:",n.message);case 3:return t.a(2)}},t,null,[[0,2]])})),c.apply(this,arguments)}function i(){return s.apply(this,arguments)}function s(){return(s=r(e().m(function t(){var n;return e().w(function(e){for(;;)switch(e.n){case 0:if(!(null===(n=document.getElementById("useSelection"))||void 0===n?void 0:n.checked)){e.n=1;break}return e.n=1,l();case 1:return e.a(2)}},t)}))).apply(this,arguments)}function l(){return u.apply(this,arguments)}function u(){return u=r(e().m(function t(){var n,a,c,i;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:if(a=null===(n=document.getElementById("useSelection"))||void 0===n?void 0:n.checked,c=document.getElementById("selectionInfo"),a){t.n=1;break}return c.innerHTML='<span class="info-label">Selection context disabled</span>',o.selectionData=null,o.selectionAddress="",t.a(2);case 1:return t.p=1,t.n=2,Excel.run(function(){var t=r(e().m(function t(n){var r,a,i,s;return e().w(function(e){for(;;)switch(e.n){case 0:return(r=n.workbook.getSelectedRange()).load(["address","values","rowCount","columnCount","numberFormat"]),e.n=1,n.sync();case 1:o.selectionAddress=r.address,o.selectionData=r.values,a=r.rowCount,i=r.columnCount,s=d(r.values,3,4),c.innerHTML="\n        <strong>".concat(r.address,"</strong> (").concat(a," rows × ").concat(i,' cols)\n        <div style="margin-top:4px; font-family: monospace; font-size:10px;">').concat(s,"</div>\n      ");case 2:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:t.n=4;break;case 3:t.p=3,i=t.v,c.innerHTML='<span class="info-label">Could not read selection</span>',console.error("Selection error:",i);case 4:return t.a(2)}},t,null,[[1,3]])})),u.apply(this,arguments)}function d(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;if(!e||!e.length)return"Empty selection";for(var a=Math.min(e.length,n),o=Math.min((null===(t=e[0])||void 0===t?void 0:t.length)||0,r),c="",i=0;i<a;i++){for(var s,l=[],u=0;u<o;u++){var d=e[i][u],p=null===d||""===d?"·":String(d).substring(0,8);l.push(p)}(null===(s=e[0])||void 0===s?void 0:s.length)>r&&l.push("..."),c+=l.join(" | ")+"<br>"}return e.length>n&&(c+="..."),c}Office.onReady(function(e){e.host===Office.HostType.Excel&&(o.apiKey=localStorage.getItem(a)||"",function(){var e,t,n,r,a,o;document.querySelectorAll(".action-btn").forEach(function(e){e.addEventListener("click",function(){return t=e.dataset.action,void((n=p[t])&&(document.getElementById("promptInput").value=n,h()));var t,n})}),null===(e=document.getElementById("btnRefresh"))||void 0===e||e.addEventListener("click",l),null===(t=document.getElementById("btnSend"))||void 0===t||t.addEventListener("click",h),null===(n=document.getElementById("btnApply"))||void 0===n||n.addEventListener("click",E);var c=document.getElementById("promptInput");null==c||c.addEventListener("keydown",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h())}),null===(r=document.getElementById("btnSaveSettings"))||void 0===r||r.addEventListener("click",P),null===(a=document.getElementById("btnCloseSettings"))||void 0===a||a.addEventListener("click",F),null===(o=document.getElementById("useSelection"))||void 0===o||o.addEventListener("change",l)}(),l(),function(){c.apply(this,arguments)}())});var p={analyze:"Analyze this data and provide key insights, patterns, and any anomalies you notice. Include statistics like averages, min/max values, and trends.",formula:"Based on this data, suggest useful Excel formulas I could use. Provide the exact formula syntax I can copy.",chart:"Recommend the best chart type for this data and explain why. Then help me create it.",format:"Suggest how to format this data for better readability. Include conditional formatting ideas.",clean:"Identify any data quality issues (duplicates, blanks, inconsistencies) and suggest how to clean this data.",summarize:"Create a concise summary of this data including totals, averages, and key takeaways."};function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal",r=document.getElementById("chatContainer"),a=r.querySelector(".welcome-message");a&&a.remove();var c=document.createElement("div");c.className="message ".concat(e," ").concat(n);var i=function(e){var t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return(t=(t=t.replace(/```(\w*)\n?([\s\S]*?)```/g,function(e,t,n){return'<div class="code-block">'.concat(n.trim(),"</div>")})).replace(/`([^`]+)`/g,'<code style="background:#f0f0f0;padding:2px 4px;border-radius:2px;">$1</code>')).replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")}(t);c.innerHTML='<div class="message-content">'.concat(i,"</div>"),r.appendChild(c),r.scrollTop=r.scrollHeight,o.chatHistory.push({role:e,content:t,type:n})}function m(){var e=document.getElementById("chatContainer"),t=document.createElement("div");t.className="message ai typing",t.id="typingIndicator",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight}function g(){var e;null===(e=document.getElementById("typingIndicator"))||void 0===e||e.remove()}function h(){return y.apply(this,arguments)}function y(){return(y=r(e().m(function t(){var n,r,a,c,i,s;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=document.getElementById("promptInput"),r=n.value.trim()){e.n=1;break}return e.a(2);case 1:if(o.apiKey){e.n=2;break}return L(),j("Please set your Gemini API key first","error"),e.a(2);case 2:return f("user",r),n.value="",m(),j("Thinking..."),e.p=3,e.n=4,v(r);case 4:a=e.v,g(),c=k(a),o.lastResponse=c,f("ai",c.message,c.hasAction?"action":"normal"),i=document.getElementById("btnApply"),c.hasAction&&i&&(i.disabled=!1,o.pendingAction=c.action),j("Ready","success"),e.n=6;break;case 5:e.p=5,s=e.v,g(),f("ai","Error: ".concat(s.message),"error"),j(s.message,"error");case 6:return e.a(2)}},t,null,[[3,5]])}))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=r(e().m(function t(n){var r,a,c,i,s,l,u,d,p;return e().w(function(e){for(;;)switch(e.n){case 0:return a=w(),c=A(),i="".concat(a,"\n\n").concat(c,"\n\nUser Request: ").concat(n),s="".concat("https://generativelanguage.googleapis.com/v1beta/models/").concat("gemini-2.0-flash",":generateContent?key=").concat(encodeURIComponent(o.apiKey)),e.n=1,fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}],generationConfig:{temperature:.7,maxOutputTokens:2048}})});case 1:if((l=e.v).ok){e.n=3;break}return e.n=2,l.text();case 2:throw u=e.v,new Error("API Error ".concat(l.status,": ").concat(u));case 3:return e.n=4,l.json();case 4:if(d=e.v,p=(null==d||null===(r=d.candidates)||void 0===r||null===(r=r[0])||void 0===r||null===(r=r.content)||void 0===r||null===(r=r.parts)||void 0===r?void 0:r.map(function(e){return e.text||""}).join(""))||""){e.n=5;break}throw new Error("Empty response from AI");case 5:return e.a(2,p)}},t)}))).apply(this,arguments)}function w(){return'You are Excel AI Copilot, an intelligent assistant for Microsoft Excel. You help users analyze data, create formulas, generate charts, format spreadsheets, and automate tasks.\n\nCAPABILITIES:\n1. DATA ANALYSIS: Analyze patterns, trends, statistics, anomalies\n2. FORMULA CREATION: Generate Excel formulas with exact syntax\n3. CHART RECOMMENDATIONS: Suggest and help create visualizations\n4. DATA FORMATTING: Conditional formatting, number formats, styles\n5. DATA CLEANING: Find duplicates, fix inconsistencies, fill blanks\n6. CALCULATIONS: Perform calculations and explain results\n\nRESPONSE FORMAT:\n- Be concise and actionable\n- When providing formulas, use exact Excel syntax\n- When suggesting actions that modify the sheet, include an ACTION block\n\nACTION BLOCK FORMAT (when you want to modify the sheet):\n[ACTION]\ntype: <formula|value|format|chart>\ntarget: <cell reference or "selection">\ndata: <the data to apply>\n[/ACTION]\n\nExample action for inserting a formula:\n[ACTION]\ntype: formula\ntarget: D2\ndata: =SUM(A2:C2)\n[/ACTION]\n\nExample action for inserting values:\n[ACTION]\ntype: values\ntarget: A1\ndata: [["Header1","Header2"],["Value1","Value2"]]\n[/ACTION]\n\nOnly include ACTION blocks when the user wants to modify the sheet. For questions and analysis, just provide the answer.'}function A(){var e,t;if(!o.selectionData||!o.selectionAddress)return"CONTEXT: No data selected. User should select data for context-aware assistance.";for(var n=Math.min(o.selectionData.length,100),r=Math.min((null===(e=o.selectionData[0])||void 0===e?void 0:e.length)||0,26),a="",c=0;c<n;c++){for(var i=[],s=0;s<r;s++){var l;i.push(null!==(l=o.selectionData[c][s])&&void 0!==l?l:"")}a+=i.join("\t")+"\n"}return"CONTEXT:\nSelected Range: ".concat(o.selectionAddress,"\nDimensions: ").concat(o.selectionData.length," rows × ").concat((null===(t=o.selectionData[0])||void 0===t?void 0:t.length)||0," columns\n\nDATA:\n").concat(a)}function k(e){var t=e.match(/\[ACTION\]([\s\S]*?)\[\/ACTION\]/);if(t){var n,r,a,o=t[1],c=o.match(/type:\s*(\w+)/),i=o.match(/target:\s*([^\n]+)/),s=o.match(/data:\s*([\s\S]*?)(?=\n\w+:|$)/);return{message:e.replace(/\[ACTION\][\s\S]*?\[\/ACTION\]/,"").trim()||"I'll apply the changes when you click 'Apply Changes'.",hasAction:!0,action:{type:(null==c||null===(n=c[1])||void 0===n?void 0:n.trim())||"value",target:(null==i||null===(r=i[1])||void 0===r?void 0:r.trim())||"selection",data:(null==s||null===(a=s[1])||void 0===a?void 0:a.trim())||""}}}return{message:e,hasAction:!1,action:null}}function E(){return I.apply(this,arguments)}function I(){return I=r(e().m(function t(){var n,a;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:if(o.pendingAction){t.n=1;break}return j("No pending action to apply","error"),t.a(2);case 1:return n=o.pendingAction,j("Applying ".concat(n.type,"...")),t.p=2,t.n=3,Excel.run(function(){var t=r(e().m(function t(r){var a;return e().w(function(e){for(;;)switch(e.n){case 0:a=n.type,e.n="formula"===a?1:"values"===a||"value"===a?3:"format"===a?5:"chart"===a?7:9;break;case 1:return e.n=2,C(r,n);case 2:case 4:case 6:case 8:return e.a(3,10);case 3:return e.n=4,x(r,n);case 5:return e.n=6,O(r,n);case 7:return e.n=8,R(r,n);case 9:return e.n=10,x(r,n);case 10:return e.n=11,r.sync();case 11:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 3:return f("ai","✓ Changes applied successfully!","action"),j("Changes applied!","success"),o.pendingAction=null,document.getElementById("btnApply").disabled=!0,t.n=4,l();case 4:t.n=6;break;case 5:t.p=5,a=t.v,console.error("Apply error:",a),f("ai","Failed to apply changes: ".concat(a.message),"error"),j("Failed to apply changes","error");case 6:return t.a(2)}},t,null,[[2,5]])})),I.apply(this,arguments)}function C(e,t){return T.apply(this,arguments)}function T(){return(T=r(e().m(function t(n,r){var a;return e().w(function(e){for(;;)switch(e.n){case 0:a=n.workbook.worksheets.getActiveWorksheet(),("selection"!==r.target&&r.target?a.getRange(r.target):n.workbook.getSelectedRange()).formulas=[[r.data]];case 1:return e.a(2)}},t)}))).apply(this,arguments)}function x(e,t){return S.apply(this,arguments)}function S(){return(S=r(e().m(function t(n,r){var a,o,c,i;return e().w(function(e){for(;;)switch(e.n){case 0:o=n.workbook.worksheets.getActiveWorksheet(),c="selection"!==r.target&&r.target?o.getRange(r.target):n.workbook.getSelectedRange();try{i=JSON.parse(r.data),Array.isArray(i)?Array.isArray(i[0])||(i=[i]):i=[[i]]}catch(e){i=[[r.data]]}(i.length>1||(null===(a=i[0])||void 0===a?void 0:a.length)>1)&&(c=c.getCell(0,0).getResizedRange(i.length-1,i[0].length-1)),c.values=i;case 1:return e.a(2)}},t)}))).apply(this,arguments)}function O(e,t){return N.apply(this,arguments)}function N(){return(N=r(e().m(function t(n,r){var a,o,c;return e().w(function(e){for(;;)switch(e.n){case 0:a=n.workbook.worksheets.getActiveWorksheet(),o="selection"!==r.target&&r.target?a.getRange(r.target):n.workbook.getSelectedRange(),(c=r.data.toLowerCase()).includes("bold")&&(o.format.font.bold=!0),c.includes("italic")&&(o.format.font.italic=!0),(c.includes("currency")||c.includes("$"))&&(o.numberFormat=[["$#,##0.00"]]),(c.includes("percent")||c.includes("%"))&&(o.numberFormat=[["0.00%"]]),c.includes("date")&&(o.numberFormat=[["mm/dd/yyyy"]]),c.includes("center")&&(o.format.horizontalAlignment=Excel.HorizontalAlignment.center),(c.includes("header")||c.includes("title"))&&(o.format.font.bold=!0,o.format.fill.color="#4472C4",o.format.font.color="#FFFFFF");case 1:return e.a(2)}},t)}))).apply(this,arguments)}function R(e,t){return B.apply(this,arguments)}function B(){return(B=r(e().m(function t(n,r){var a,o,c,i,s;return e().w(function(e){for(;;)switch(e.n){case 0:a=n.workbook.worksheets.getActiveWorksheet(),o="selection"!==r.target&&r.target?a.getRange(r.target):n.workbook.getSelectedRange(),c=r.data.toLowerCase(),i=Excel.ChartType.columnClustered,c.includes("line")?i=Excel.ChartType.line:c.includes("pie")?i=Excel.ChartType.pie:c.includes("bar")?i=Excel.ChartType.barClustered:c.includes("area")?i=Excel.ChartType.area:c.includes("scatter")&&(i=Excel.ChartType.xyscatter),(s=a.charts.add(i,o,Excel.ChartSeriesBy.auto)).setPosition("H2","O15"),s.title.text="Generated Chart";case 1:return e.a(2)}},t)}))).apply(this,arguments)}function L(){var e=document.getElementById("settingsModal"),t=document.getElementById("apiKeyInput");e&&t&&(t.value=o.apiKey,e.classList.remove("hidden"))}function F(){var e;null===(e=document.getElementById("settingsModal"))||void 0===e||e.classList.add("hidden")}function P(){var e=document.getElementById("apiKeyInput");e&&(o.apiKey=e.value.trim(),localStorage.setItem(a,o.apiKey),F(),j("API key saved!","success"))}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.getElementById("statusBar");n&&(n.textContent=e,n.className="status-bar "+t)}}(),new URL(n(58394),n.b)}();
//# sourceMappingURL=taskpane.js.map