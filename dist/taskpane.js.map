{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/webpack/bootstrap","webpack://office-addin-taskpane-js/webpack/runtime/global","webpack://office-addin-taskpane-js/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane-js/webpack/runtime/publicPath","webpack://office-addin-taskpane-js/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane-js/./src/taskpane/ai-engine.js","webpack://office-addin-taskpane-js/./src/taskpane/excel-data.js","webpack://office-addin-taskpane-js/./src/taskpane/diagnostics.js","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.js","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.html"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = (typeof document !== 'undefined' && document.baseURI) || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","/*\r\n * AI Engine - Advanced AI capabilities for Excel Copilot\r\n * Features: Task-specific prompts, function calling, RAG, multi-step reasoning, learning\r\n */\r\n\r\n/* global localStorage */\r\n\r\n// ============================================================================\r\n// Configuration\r\n// ============================================================================\r\nconst AI_CONFIG = {\r\n    CORRECTIONS_KEY: \"excel_copilot_corrections_v2\",\r\n    PATTERNS_KEY: \"excel_copilot_patterns_v2\",\r\n    MAX_CORRECTIONS: 200,\r\n    MAX_PATTERNS: 200,\r\n    SCHEMA_VERSION: 2\r\n};\r\n\r\n// ============================================================================\r\n// Task Type Detection\r\n// ============================================================================\r\nconst TASK_TYPES = {\r\n    FORMULA: \"formula\",\r\n    CHART: \"chart\",\r\n    ANALYSIS: \"analysis\",\r\n    FORMAT: \"format\",\r\n    DATA_ENTRY: \"data_entry\",\r\n    VALIDATION: \"validation\",\r\n    GENERAL: \"general\"\r\n};\r\n\r\nconst TASK_KEYWORDS = {\r\n    [TASK_TYPES.FORMULA]: [\r\n        \"formula\", \"sum\", \"average\", \"count\", \"vlookup\", \"xlookup\", \"if\", \"calculate\",\r\n        \"total\", \"add up\", \"multiply\", \"divide\", \"percentage\", \"sumif\", \"countif\",\r\n        \"index\", \"match\", \"concatenate\", \"lookup\", \"function\",\r\n        \"clean\", \"trim\", \"upper\", \"lower\", \"remove spaces\", \"text manipulation\",\r\n        \"convert\", \"proper case\", \"title case\", \"capitalize\"\r\n    ],\r\n    [TASK_TYPES.CHART]: [\r\n        \"chart\", \"graph\", \"visualize\", \"plot\", \"pie\", \"bar\", \"line\", \"column\",\r\n        \"histogram\", \"scatter\", \"trend\", \"visualization\", \"diagram\"\r\n    ],\r\n    [TASK_TYPES.ANALYSIS]: [\r\n        \"analyze\", \"analysis\", \"insight\", \"summary\", \"summarize\", \"statistics\",\r\n        \"trend\", \"pattern\", \"outlier\", \"anomaly\", \"compare\", \"correlation\",\r\n        \"distribution\", \"breakdown\", \"report\", \"findings\"\r\n    ],\r\n    [TASK_TYPES.FORMAT]: [\r\n        \"format\", \"style\", \"color\", \"bold\", \"italic\", \"font\", \"border\",\r\n        \"highlight\", \"conditional\", \"table\", \"header\", \"align\", \"merge\"\r\n    ],\r\n    [TASK_TYPES.DATA_ENTRY]: [\r\n        \"fill\", \"enter\", \"input\", \"write\", \"set\", \"update\", \"change value\",\r\n        \"put\", \"insert\", \"add data\", \"populate\"\r\n    ],\r\n    [TASK_TYPES.VALIDATION]: [\r\n        \"dropdown\", \"validation\", \"list\", \"restrict\", \"allow\", \"select from\",\r\n        \"choices\", \"options\", \"pick list\"\r\n    ]\r\n};\r\n\r\n/**\r\n * Detects the task type from user prompt\r\n * @param {string} prompt - User's input\r\n * @returns {string} Task type\r\n */\r\nfunction detectTaskType(prompt) {\r\n    const lower = prompt.toLowerCase();\r\n    \r\n    for (const [taskType, keywords] of Object.entries(TASK_KEYWORDS)) {\r\n        for (const keyword of keywords) {\r\n            if (lower.includes(keyword)) {\r\n                return taskType;\r\n            }\r\n        }\r\n    }\r\n    \r\n    return TASK_TYPES.GENERAL;\r\n}\r\n\r\n// ============================================================================\r\n// Task-Specific System Prompts\r\n// ============================================================================\r\nconst TASK_PROMPTS = {\r\n    [TASK_TYPES.FORMULA]: `You are an Excel Formula Expert. Your specialty is creating precise, efficient Excel formulas.\r\n\r\n## YOUR EXPERTISE\r\n- All Excel functions: SUM, AVERAGE, VLOOKUP, XLOOKUP, INDEX/MATCH, IF, SUMIF, COUNTIF, etc.\r\n- Array formulas and dynamic arrays\r\n- Nested functions and complex logic\r\n- Error handling with IFERROR, IFNA\r\n- Date/time calculations\r\n- Text manipulation functions\r\n\r\n## FORMULA BEST PRACTICES\r\n1. Use XLOOKUP over VLOOKUP when possible (more flexible)\r\n2. Prefer INDEX/MATCH for complex lookups\r\n3. Always wrap lookups in IFERROR for robustness\r\n4. Use structured references when working with tables\r\n5. Consider performance for large datasets\r\n\r\n## CRITICAL: UNIQUE VALUES AND COUNTS - RELIABLE APPROACH\r\nWhen user asks for \"unique values and their counts\" (e.g., unique departments with employee counts):\r\n\r\n**BEST APPROACH - Use removeDuplicates + COUNTIF:**\r\n\r\nStep 1: Copy the source data to the target column\r\n<ACTION type=\"copy\" source=\"C2:C51\" target=\"E2\">\r\n</ACTION>\r\n\r\nStep 2: Remove duplicates from the copied data\r\n<ACTION type=\"removeDuplicates\" target=\"E2:E51\">\r\n{\"columns\": [0]}\r\n</ACTION>\r\n\r\nStep 3: Add COUNTIF formula in adjacent column (only first cell)\r\n<ACTION type=\"formula\" target=\"F2\">\r\n=COUNTIF($C:$C, E2)\r\n</ACTION>\r\n\r\nStep 4: Use autofill to copy the formula down\r\n<ACTION type=\"autofill\" source=\"F2\" target=\"F2:F20\">\r\n</ACTION>\r\n\r\nThis approach:\r\n-  Works in all Excel versions\r\n-  No spill errors\r\n-  No dimension mismatch\r\n-  Reliable and predictable\r\n\r\n**DO NOT use UNIQUE() function** - it causes spill errors and compatibility issues!\r\n\r\n## CRITICAL: DATA CLEANING IN-PLACE\r\n**NEVER apply formulas to the same column they reference (causes circular reference)!**\r\n\r\nWhen cleaning/converting data (TRIM, UPPER, LOWER, PROPER, etc.):\r\n- **WRONG**: Apply =TRIM(C2) to C2 or =PROPER(D2) to D2 (circular reference!)\r\n- **RIGHT**: Apply formula to a NEW column (like H2), then use copyValues to replace\r\n\r\nExample for \"Convert City to Proper Case\":\r\nStep 1 - Create formulas in helper column:\r\n<ACTION type=\"formula\" target=\"H2:H51\">\r\n=PROPER(D2)\r\n</ACTION>\r\n\r\nStep 2 - Copy values back to original column:\r\n<ACTION type=\"copyValues\" target=\"D2\" source=\"H2:H51\">\r\n</ACTION>\r\n\r\n**ALWAYS use both steps for data cleaning/conversion!**\r\n\r\n## OUTPUT FORMAT\r\nAlways provide formulas in ACTION tags:\r\n<ACTION type=\"formula\" target=\"CELL\">\r\n=YOUR_FORMULA\r\n</ACTION>\r\n\r\nExplain what the formula does and why you chose this approach.`,\r\n\r\n    [TASK_TYPES.CHART]: `You are an Excel Data Visualization Expert. Your specialty is creating effective charts.\r\n\r\n## YOUR EXPERTISE\r\n- Choosing the right chart type for the data\r\n- Chart design and formatting\r\n- Data storytelling through visuals\r\n- Dashboard creation\r\n\r\n## CHART SELECTION GUIDE\r\n- **Column/Bar**: Comparing categories\r\n- **Line**: Trends over time (use for trend analysis)\r\n- **Pie/Doughnut**: Parts of a whole (use sparingly, max 5-7 slices)\r\n- **Scatter**: Correlation between variables\r\n- **Area**: Cumulative totals over time\r\n- **Combo**: Multiple data types on one chart\r\n\r\n## CRITICAL CHART RULES\r\n1. **ALWAYS use CONTIGUOUS ranges** - e.g., A1:B10, NOT A1:A10,C1:C10\r\n2. **NON-CONTIGUOUS RANGES ARE NOT SUPPORTED** - If you need columns A and D, use A1:D10 (the full block)\r\n3. For trend analysis with non-adjacent columns, include ALL columns between them\r\n4. If data columns are far apart, use the full data range (e.g., A1:G100)\r\n5. Include headers in the first row for proper labels\r\n6. For line/trend charts, ensure date/time is in the first column of the range\r\n\r\n**WARNING**: Non-contiguous ranges (e.g., \"A1:A10,C1:C10\") will only use the FIRST range!\r\nIf you need multiple distant columns, specify the full contiguous block that includes them all.\r\n\r\n## OUTPUT FORMAT\r\n**CRITICAL: You MUST use ACTION tags! Never output raw JSON!**\r\n\r\n<ACTION type=\"chart\" target=\"DATARANGE\" chartType=\"TYPE\" title=\"TITLE\" position=\"CELL\">\r\n</ACTION>\r\n\r\nExample for trend: target=\"A1:G100\" (full range), NOT \"B1:B100,G1:G100\"\r\n\r\n**WRONG (Don't do this):**\r\n[{\"action\": \"chart\", \"target\": \"A1:C58\"}]\r\ntarget=\"A1:A10,D1:D10\" (non-contiguous - NOT SUPPORTED!)\r\n\r\n**RIGHT (Always do this):**\r\n<ACTION type=\"chart\" target=\"A1:C58\" chartType=\"column\" title=\"My Chart\" position=\"F2\">\r\n</ACTION>\r\ntarget=\"A1:D10\" (contiguous block including all needed columns)\r\n\r\nAlways explain why you chose this chart type and what story it tells.`,\r\n\r\n    [TASK_TYPES.ANALYSIS]: `You are an Excel Data Analyst. Your specialty is extracting insights from data.\r\n\r\n## YOUR EXPERTISE\r\n- Statistical analysis (mean, median, mode, std dev)\r\n- Trend identification\r\n- Outlier detection\r\n- Data quality assessment\r\n- Pattern recognition\r\n- Comparative analysis\r\n\r\n## ANALYSIS APPROACH\r\n1. First, understand the data structure\r\n2. Identify key metrics and dimensions\r\n3. Look for patterns, trends, anomalies\r\n4. Provide actionable insights\r\n5. Suggest visualizations if helpful\r\n\r\n## OUTPUT FORMAT\r\nProvide your analysis in clear sections:\r\n- **Overview**: What the data represents\r\n- **Key Findings**: Most important insights\r\n- **Statistics**: Relevant numbers\r\n- **Recommendations**: Suggested actions\r\n\r\nIf formulas or charts would help, include them in ACTION tags.`,\r\n\r\n    [TASK_TYPES.FORMAT]: `You are an Excel Formatting Expert. Your specialty is making data visually clear and professional.\r\n\r\n## YOUR EXPERTISE\r\n- Professional table styling\r\n- Conditional formatting rules\r\n- Color schemes and accessibility\r\n- Data presentation best practices\r\n\r\n## FORMATTING BEST PRACTICES\r\n1. Use consistent color schemes\r\n2. Headers should stand out (bold, background color)\r\n3. Align numbers right, text left\r\n4. Use borders sparingly\r\n5. Consider colorblind-friendly palettes\r\n\r\n## OUTPUT FORMAT\r\n<ACTION type=\"format\" target=\"RANGE\">\r\n{\"bold\":true,\"fill\":\"#4472C4\",\"fontColor\":\"#FFFFFF\"}\r\n</ACTION>\r\n\r\nAvailable format options: bold, italic, fill, fontColor, fontSize, numberFormat, border`,\r\n\r\n    [TASK_TYPES.VALIDATION]: `You are an Excel Data Validation Expert. Your specialty is creating dropdowns and input controls.\r\n\r\n## YOUR EXPERTISE\r\n- Data validation rules\r\n- Dropdown lists from ranges\r\n- Input restrictions\r\n- Error messages and input prompts\r\n\r\n## VALIDATION BEST PRACTICES\r\n1. Use source ranges for dynamic dropdowns\r\n2. Provide clear error messages\r\n3. Consider dependent dropdowns for hierarchical data\r\n\r\n## OUTPUT FORMAT\r\n<ACTION type=\"validation\" target=\"CELL\" source=\"DATARANGE\">\r\n</ACTION>\r\n\r\nThe source should be the range containing the list values.`,\r\n\r\n    [TASK_TYPES.DATA_ENTRY]: `You are an Excel Data Entry Assistant. Your specialty is efficiently populating cells.\r\n\r\n## YOUR EXPERTISE\r\n- Bulk data entry\r\n- Pattern-based filling\r\n- Data transformation\r\n- Autofill sequences\r\n\r\n## REPLACING FORMULA RESULTS WITH VALUES\r\nIf user asks to \"replace original with updated values\" or \"copy values back\":\r\nUse copyValues action (NOT values action):\r\n<ACTION type=\"copyValues\" target=\"A2\" source=\"F2:F51\">\r\n</ACTION>\r\n\r\nThis copies only the calculated values (not formulas) from source to target.\r\n\r\n## OUTPUT FORMAT FOR NEW DATA\r\n<ACTION type=\"values\" target=\"RANGE\">\r\n[[\"value1\",\"value2\"],[\"value3\",\"value4\"]]\r\n</ACTION>\r\n\r\nValues should be a 2D array matching the target range dimensions.`,\r\n\r\n    [TASK_TYPES.GENERAL]: `You are Excel Copilot, a versatile Excel assistant.\r\n\r\n## YOUR CAPABILITIES\r\n- Create formulas and functions\r\n- Build charts and visualizations\r\n- Analyze data and provide insights\r\n- Format cells and tables\r\n- Set up data validation\r\n- Automate repetitive tasks\r\n\r\nDetermine what the user needs and provide the most helpful response.`\r\n};\r\n\r\n/**\r\n * Gets the task-specific system prompt\r\n * @param {string} taskType - Detected task type\r\n * @param {Object} corrections - User corrections to incorporate\r\n * @returns {string} Complete system prompt\r\n */\r\nfunction getTaskSpecificPrompt(taskType, corrections = {}) {\r\n    const basePrompt = TASK_PROMPTS[taskType] || TASK_PROMPTS[TASK_TYPES.GENERAL];\r\n    \r\n    // Add corrections context if any\r\n    let correctionsContext = \"\";\r\n    if (Object.keys(corrections).length > 0) {\r\n        correctionsContext = \"\\n\\n## USER PREFERENCES (from past corrections)\\n\";\r\n        for (const [key, value] of Object.entries(corrections)) {\r\n            correctionsContext += `- ${key}: ${value}\\n`;\r\n        }\r\n        correctionsContext += \"\\nAlways apply these preferences unless explicitly told otherwise.\";\r\n    }\r\n    \r\n    return basePrompt + correctionsContext + getCommonRules();\r\n}\r\n\r\n/**\r\n * Common rules appended to all prompts\r\n */\r\nfunction getCommonRules() {\r\n    return `\r\n\r\n## CRITICAL OUTPUT FORMAT RULES\r\n**YOU MUST USE ACTION TAGS - NEVER OUTPUT RAW JSON OR PLAIN TEXT FOR ACTIONS!**\r\n\r\nWRONG: [{\"action\": \"chart\", \"target\": \"A1:C58\"}]\r\nWRONG: {\"type\": \"formula\", \"target\": \"A2\"}\r\nRIGHT: <ACTION type=\"chart\" target=\"A1:C58\" chartType=\"column\" title=\"Chart\" position=\"F2\"></ACTION>\r\n\r\n## CRITICAL RULES\r\n1. **CHECK THE COLUMN STRUCTURE TABLE** - Find the exact column letter for each header name\r\n2. **Data starts at row 2** (row 1 is headers)\r\n3. Always verify column letters before creating formulas\r\n4. Use the exact cell references from the data context\r\n\r\n## ACTION TYPES REFERENCE\r\n- formula: <ACTION type=\"formula\" target=\"CELL\">=FORMULA</ACTION>\r\n- values: <ACTION type=\"values\" target=\"RANGE\">[[\"val\"]]</ACTION>\r\n- format: <ACTION type=\"format\" target=\"RANGE\">{\"bold\":true}</ACTION>\r\n- conditionalFormat: <ACTION type=\"conditionalFormat\" target=\"RANGE\">{\"type\":\"cellValue\",\"operator\":\"GreaterThan\",\"value\":\"40\",\"fill\":\"#FFFF00\"}</ACTION>\r\n- chart: <ACTION type=\"chart\" target=\"RANGE\" chartType=\"TYPE\" title=\"TITLE\" position=\"CELL\"></ACTION>\r\n- validation: <ACTION type=\"validation\" target=\"CELL\" source=\"RANGE\"></ACTION>\r\n- sort: <ACTION type=\"sort\" target=\"DATARANGE\">{\"column\":1,\"ascending\":true}</ACTION>\r\n- filter: <ACTION type=\"filter\" target=\"DATARANGE\">{\"column\":2,\"values\":[\"Mumbai\"]}</ACTION>\r\n- clearFilter: <ACTION type=\"clearFilter\" target=\"DATARANGE\"></ACTION>\r\n- removeDuplicates: <ACTION type=\"removeDuplicates\" target=\"DATARANGE\">{\"columns\":[0,1,2]}</ACTION>\r\n- copy: <ACTION type=\"copy\" target=\"DESTINATION\" source=\"SOURCE\"></ACTION>\r\n- copyValues: <ACTION type=\"copyValues\" target=\"DESTINATION\" source=\"SOURCE\"></ACTION>\r\n\r\n## CONDITIONAL FORMATTING\r\n**CRITICAL: For multiple conditions on the same range, use a SINGLE ACTION with an ARRAY of rules!**\r\n\r\nSingle condition:\r\n<ACTION type=\"conditionalFormat\" target=\"C2:C51\">\r\n{\"type\":\"cellValue\",\"operator\":\"GreaterThan\",\"value\":\"40\",\"fill\":\"#FFFF00\"}\r\n</ACTION>\r\n\r\n**Multiple conditions (CORRECT WAY - use array):**\r\n<ACTION type=\"conditionalFormat\" target=\"E2:E51\">\r\n[\r\n  {\"type\":\"cellValue\",\"operator\":\"GreaterThan\",\"value\":\"70\",\"fill\":\"#00FF00\"},\r\n  {\"type\":\"cellValue\",\"operator\":\"Between\",\"value\":\"40\",\"value2\":\"70\",\"fill\":\"#FFFF00\"},\r\n  {\"type\":\"cellValue\",\"operator\":\"LessThan\",\"value\":\"40\",\"fill\":\"#FF0000\"}\r\n]\r\n</ACTION>\r\n\r\nTo REMOVE/CLEAR conditional formatting:\r\n<ACTION type=\"clearFormat\" target=\"C2:C51\">\r\n</ACTION>\r\n\r\nOperators: \"GreaterThan\", \"LessThan\", \"EqualTo\", \"NotEqualTo\", \"GreaterThanOrEqual\", \"LessThanOrEqual\", \"Between\"\r\nColors: Use hex codes like \"#FFFF00\" (yellow), \"#FF0000\" (red), \"#00FF00\" (green)\r\n**Note:** For \"Between\" operator, use both \"value\" and \"value2\" properties\r\n\r\n## SORTING DATA\r\nTo sort data, use the sort action type (NOT formulas like SORT()):\r\n<ACTION type=\"sort\" target=\"A1:L51\">\r\n{\"column\":1,\"ascending\":true}\r\n</ACTION>\r\n\r\n- target: The full data range including headers (e.g., A1:L51)\r\n- column: 0-based index of the column to sort by (0=first column, 1=second, etc.)\r\n- ascending: true for A-Z/smallest first, false for Z-A/largest first\r\n\r\n## FILTERING DATA\r\nTo apply AutoFilter and filter by specific values:\r\n<ACTION type=\"filter\" target=\"A1:L51\">\r\n{\"column\":2,\"values\":[\"Mumbai\",\"Delhi\"]}\r\n</ACTION>\r\n\r\n- target: The full data range including headers (e.g., A1:L51)\r\n- column: 0-based index of the column to filter by (0=first column, 1=second, etc.)\r\n- values: Array of values to show (all other values will be hidden)\r\n\r\nTo REMOVE/CLEAR all filters and show all data:\r\n<ACTION type=\"clearFilter\" target=\"A1:L51\">\r\n</ACTION>\r\n\r\n**Note:** Use clearFilter when user says \"remove filter\", \"clear filter\", \"show all data\", or \"remove filtering\".\r\n\r\n## COPYING DATA\r\nTo copy formulas and formatting from one range to another:\r\n<ACTION type=\"copy\" target=\"A52\" source=\"A1:L51\">\r\n</ACTION>\r\n\r\nTo copy ONLY VALUES (no formulas) - useful for replacing original data with cleaned values:\r\n<ACTION type=\"copyValues\" target=\"A2\" source=\"F2:F51\">\r\n</ACTION>\r\n\r\n- source: The range to copy FROM\r\n- target: The starting cell to paste TO (top-left corner of destination)\r\n- Use \"copyValues\" when replacing original data with formula results (e.g., after TRIM, UPPER, etc.)\r\n\r\n## REMOVING DUPLICATES\r\nTo remove duplicate rows from a range:\r\n<ACTION type=\"removeDuplicates\" target=\"A1:E86\">\r\n{\"columns\":[0,1,2,3,4]}\r\n</ACTION>\r\n\r\n- target: The data range including headers\r\n- columns: Array of 0-based column indices to check for duplicates (e.g., [0,1,2] checks first 3 columns)\r\n- Keeps the first occurrence of each unique row\r\n- Removes all subsequent duplicates\r\n\r\n## CREATING SHEETS\r\nTo create a new sheet:\r\n<ACTION type=\"sheet\" target=\"SheetName\">\r\n</ACTION>\r\n\r\n- target: The name of the new sheet to create\r\n- data: (optional) JSON array of values to populate the sheet\r\n\r\nExample: Create a sheet named \"Summary\":\r\n<ACTION type=\"sheet\" target=\"Summary\">\r\n</ACTION>`;\r\n}\r\n\r\n// ============================================================================\r\n// Function Calling - Direct Excel Operations\r\n// ============================================================================\r\nconst EXCEL_FUNCTIONS = {\r\n    // Aggregation functions\r\n    SUM: {\r\n        description: \"Add numbers in a range\",\r\n        signature: \"SUM(range)\",\r\n        example: \"=SUM(A1:A10)\"\r\n    },\r\n    AVERAGE: {\r\n        description: \"Calculate average of numbers\",\r\n        signature: \"AVERAGE(range)\",\r\n        example: \"=AVERAGE(B2:B100)\"\r\n    },\r\n    COUNT: {\r\n        description: \"Count cells with numbers\",\r\n        signature: \"COUNT(range)\",\r\n        example: \"=COUNT(C1:C50)\"\r\n    },\r\n    COUNTA: {\r\n        description: \"Count non-empty cells\",\r\n        signature: \"COUNTA(range)\",\r\n        example: \"=COUNTA(A:A)\"\r\n    },\r\n    MAX: {\r\n        description: \"Find maximum value\",\r\n        signature: \"MAX(range)\",\r\n        example: \"=MAX(D2:D100)\"\r\n    },\r\n    MIN: {\r\n        description: \"Find minimum value\",\r\n        signature: \"MIN(range)\",\r\n        example: \"=MIN(D2:D100)\"\r\n    },\r\n    \r\n    // Lookup functions\r\n    VLOOKUP: {\r\n        description: \"Vertical lookup\",\r\n        signature: \"VLOOKUP(lookup_value, table_array, col_index, [range_lookup])\",\r\n        example: \"=VLOOKUP(A2, Sheet2!A:D, 3, FALSE)\"\r\n    },\r\n    XLOOKUP: {\r\n        description: \"Modern flexible lookup\",\r\n        signature: \"XLOOKUP(lookup_value, lookup_array, return_array, [if_not_found])\",\r\n        example: \"=XLOOKUP(A2, B:B, C:C, \\\"Not found\\\")\"\r\n    },\r\n    INDEX: {\r\n        description: \"Return value at position\",\r\n        signature: \"INDEX(array, row_num, [col_num])\",\r\n        example: \"=INDEX(A1:C10, 5, 2)\"\r\n    },\r\n    MATCH: {\r\n        description: \"Find position of value\",\r\n        signature: \"MATCH(lookup_value, lookup_array, [match_type])\",\r\n        example: \"=MATCH(\\\"Apple\\\", A:A, 0)\"\r\n    },\r\n    \r\n    // Conditional functions\r\n    IF: {\r\n        description: \"Conditional logic\",\r\n        signature: \"IF(condition, value_if_true, value_if_false)\",\r\n        example: \"=IF(A1>100, \\\"High\\\", \\\"Low\\\")\"\r\n    },\r\n    SUMIF: {\r\n        description: \"Sum with condition\",\r\n        signature: \"SUMIF(range, criteria, [sum_range])\",\r\n        example: \"=SUMIF(A:A, \\\"Sales\\\", B:B)\"\r\n    },\r\n    COUNTIF: {\r\n        description: \"Count with condition\",\r\n        signature: \"COUNTIF(range, criteria)\",\r\n        example: \"=COUNTIF(A:A, \\\">100\\\")\"\r\n    },\r\n    SUMIFS: {\r\n        description: \"Sum with multiple conditions\",\r\n        signature: \"SUMIFS(sum_range, criteria_range1, criteria1, ...)\",\r\n        example: \"=SUMIFS(C:C, A:A, \\\"Sales\\\", B:B, \\\">2023\\\")\"\r\n    },\r\n    \r\n    // Text functions\r\n    CONCATENATE: {\r\n        description: \"Join text strings\",\r\n        signature: \"CONCATENATE(text1, text2, ...)\",\r\n        example: \"=CONCATENATE(A1, \\\" \\\", B1)\"\r\n    },\r\n    LEFT: {\r\n        description: \"Extract left characters\",\r\n        signature: \"LEFT(text, num_chars)\",\r\n        example: \"=LEFT(A1, 3)\"\r\n    },\r\n    RIGHT: {\r\n        description: \"Extract right characters\",\r\n        signature: \"RIGHT(text, num_chars)\",\r\n        example: \"=RIGHT(A1, 4)\"\r\n    },\r\n    MID: {\r\n        description: \"Extract middle characters\",\r\n        signature: \"MID(text, start_num, num_chars)\",\r\n        example: \"=MID(A1, 2, 5)\"\r\n    },\r\n    TRIM: {\r\n        description: \"Remove extra spaces\",\r\n        signature: \"TRIM(text)\",\r\n        example: \"=TRIM(A1)\"\r\n    },\r\n    UPPER: {\r\n        description: \"Convert to uppercase\",\r\n        signature: \"UPPER(text)\",\r\n        example: \"=UPPER(A1)\"\r\n    },\r\n    LOWER: {\r\n        description: \"Convert to lowercase\",\r\n        signature: \"LOWER(text)\",\r\n        example: \"=LOWER(A1)\"\r\n    },\r\n    \r\n    // Date functions\r\n    TODAY: {\r\n        description: \"Current date\",\r\n        signature: \"TODAY()\",\r\n        example: \"=TODAY()\"\r\n    },\r\n    NOW: {\r\n        description: \"Current date and time\",\r\n        signature: \"NOW()\",\r\n        example: \"=NOW()\"\r\n    },\r\n    YEAR: {\r\n        description: \"Extract year from date\",\r\n        signature: \"YEAR(date)\",\r\n        example: \"=YEAR(A1)\"\r\n    },\r\n    MONTH: {\r\n        description: \"Extract month from date\",\r\n        signature: \"MONTH(date)\",\r\n        example: \"=MONTH(A1)\"\r\n    },\r\n    DAY: {\r\n        description: \"Extract day from date\",\r\n        signature: \"DAY(date)\",\r\n        example: \"=DAY(A1)\"\r\n    },\r\n    DATEDIF: {\r\n        description: \"Difference between dates\",\r\n        signature: \"DATEDIF(start_date, end_date, unit)\",\r\n        example: \"=DATEDIF(A1, B1, \\\"D\\\")\"\r\n    },\r\n    \r\n    // Error handling\r\n    IFERROR: {\r\n        description: \"Handle errors gracefully\",\r\n        signature: \"IFERROR(value, value_if_error)\",\r\n        example: \"=IFERROR(A1/B1, 0)\"\r\n    },\r\n    IFNA: {\r\n        description: \"Handle #N/A errors\",\r\n        signature: \"IFNA(value, value_if_na)\",\r\n        example: \"=IFNA(VLOOKUP(...), \\\"Not found\\\")\"\r\n    }\r\n};\r\n\r\n/**\r\n * Generates function calling context for the AI\r\n * @returns {string} Function definitions for AI context\r\n */\r\nfunction getFunctionCallingContext() {\r\n    let context = \"\\n\\n## AVAILABLE EXCEL FUNCTIONS\\n\";\r\n    context += \"You can use these functions directly. Here are the most common ones:\\n\\n\";\r\n    \r\n    const categories = {\r\n        \"Aggregation\": [\"SUM\", \"AVERAGE\", \"COUNT\", \"COUNTA\", \"MAX\", \"MIN\"],\r\n        \"Lookup\": [\"VLOOKUP\", \"XLOOKUP\", \"INDEX\", \"MATCH\"],\r\n        \"Conditional\": [\"IF\", \"SUMIF\", \"COUNTIF\", \"SUMIFS\"],\r\n        \"Text\": [\"CONCATENATE\", \"LEFT\", \"RIGHT\", \"MID\", \"TRIM\"],\r\n        \"Date\": [\"TODAY\", \"NOW\", \"YEAR\", \"MONTH\", \"DAY\"],\r\n        \"Error Handling\": [\"IFERROR\", \"IFNA\"]\r\n    };\r\n    \r\n    for (const [category, funcs] of Object.entries(categories)) {\r\n        context += `### ${category}\\n`;\r\n        for (const func of funcs) {\r\n            const def = EXCEL_FUNCTIONS[func];\r\n            if (def) {\r\n                context += `- **${func}**: ${def.description}\\n`;\r\n                context += `  Syntax: \\`${def.signature}\\`\\n`;\r\n            }\r\n        }\r\n        context += \"\\n\";\r\n    }\r\n    \r\n    return context;\r\n}\r\n\r\n/**\r\n * Parses function calls from AI response and converts to actions\r\n * @param {string} response - AI response text\r\n * @returns {Object[]} Parsed function calls as actions\r\n */\r\nfunction parseFunctionCalls(response) {\r\n    const functionCalls = [];\r\n    \r\n    // Pattern: CALL_FUNCTION(name, target, args)\r\n    const callPattern = /CALL_FUNCTION\\s*\\(\\s*\"?(\\w+)\"?\\s*,\\s*\"?([A-Z]+\\d+(?::[A-Z]+\\d+)?)\"?\\s*(?:,\\s*(.+?))?\\s*\\)/gi;\r\n    \r\n    let match;\r\n    while ((match = callPattern.exec(response)) !== null) {\r\n        const funcName = match[1].toUpperCase();\r\n        const target = match[2];\r\n        const args = match[3] ? match[3].trim() : \"\";\r\n        \r\n        if (EXCEL_FUNCTIONS[funcName]) {\r\n            functionCalls.push({\r\n                type: \"formula\",\r\n                target: target,\r\n                data: `=${funcName}(${args})`\r\n            });\r\n        }\r\n    }\r\n    \r\n    return functionCalls;\r\n}\r\n\r\n// ============================================================================\r\n// RAG - Pattern Knowledge Base\r\n// ============================================================================\r\nconst FORMULA_PATTERNS = [\r\n    // Aggregation patterns\r\n    {\r\n        id: \"sum_column\",\r\n        keywords: [\"sum\", \"total\", \"add up\", \"add all\"],\r\n        pattern: \"=SUM({range})\",\r\n        description: \"Sum all values in a column\",\r\n        example: \"=SUM(B2:B100)\"\r\n    },\r\n    {\r\n        id: \"average_column\",\r\n        keywords: [\"average\", \"mean\", \"avg\"],\r\n        pattern: \"=AVERAGE({range})\",\r\n        description: \"Calculate average of values\",\r\n        example: \"=AVERAGE(C2:C100)\"\r\n    },\r\n    {\r\n        id: \"count_values\",\r\n        keywords: [\"count\", \"how many\", \"number of\"],\r\n        pattern: \"=COUNTA({range})\",\r\n        description: \"Count non-empty cells\",\r\n        example: \"=COUNTA(A2:A100)\"\r\n    },\r\n    \r\n    // Conditional patterns\r\n    {\r\n        id: \"sumif_category\",\r\n        keywords: [\"sum by\", \"total for\", \"sum where\", \"sum if\"],\r\n        pattern: \"=SUMIF({criteria_range}, \\\"{criteria}\\\", {sum_range})\",\r\n        description: \"Sum values matching a condition\",\r\n        example: \"=SUMIF(A:A, \\\"Sales\\\", B:B)\"\r\n    },\r\n    {\r\n        id: \"countif_condition\",\r\n        keywords: [\"count where\", \"count if\", \"how many have\"],\r\n        pattern: \"=COUNTIF({range}, \\\"{criteria}\\\")\",\r\n        description: \"Count cells matching condition\",\r\n        example: \"=COUNTIF(A:A, \\\"Complete\\\")\"\r\n    },\r\n    {\r\n        id: \"if_condition\",\r\n        keywords: [\"if then\", \"when\", \"check if\", \"condition\"],\r\n        pattern: \"=IF({condition}, \\\"{true_value}\\\", \\\"{false_value}\\\")\",\r\n        description: \"Return different values based on condition\",\r\n        example: \"=IF(A1>100, \\\"High\\\", \\\"Low\\\")\"\r\n    },\r\n    \r\n    // Lookup patterns\r\n    {\r\n        id: \"vlookup_basic\",\r\n        keywords: [\"lookup\", \"find\", \"get value\", \"vlookup\"],\r\n        pattern: \"=VLOOKUP({lookup_value}, {table}, {col_index}, FALSE)\",\r\n        description: \"Look up a value in a table\",\r\n        example: \"=VLOOKUP(A2, Products!A:C, 2, FALSE)\"\r\n    },\r\n    {\r\n        id: \"xlookup_modern\",\r\n        keywords: [\"xlookup\", \"modern lookup\", \"flexible lookup\"],\r\n        pattern: \"=XLOOKUP({lookup_value}, {lookup_array}, {return_array}, \\\"Not found\\\")\",\r\n        description: \"Modern flexible lookup\",\r\n        example: \"=XLOOKUP(A2, B:B, C:C, \\\"Not found\\\")\"\r\n    },\r\n    {\r\n        id: \"index_match\",\r\n        keywords: [\"index match\", \"two-way lookup\", \"flexible lookup\"],\r\n        pattern: \"=INDEX({return_range}, MATCH({lookup_value}, {lookup_range}, 0))\",\r\n        description: \"Flexible lookup using INDEX/MATCH\",\r\n        example: \"=INDEX(C:C, MATCH(A2, B:B, 0))\"\r\n    },\r\n    \r\n    // Percentage patterns\r\n    {\r\n        id: \"percentage\",\r\n        keywords: [\"percentage\", \"percent\", \"%\", \"ratio\"],\r\n        pattern: \"={value}/{total}\",\r\n        description: \"Calculate percentage\",\r\n        example: \"=B2/SUM(B:B)\"\r\n    },\r\n    {\r\n        id: \"percentage_change\",\r\n        keywords: [\"change\", \"growth\", \"increase\", \"decrease\"],\r\n        pattern: \"=({new_value}-{old_value})/{old_value}\",\r\n        description: \"Calculate percentage change\",\r\n        example: \"=(B2-A2)/A2\"\r\n    },\r\n    \r\n    // Text patterns\r\n    {\r\n        id: \"concat_text\",\r\n        keywords: [\"combine\", \"join\", \"concatenate\", \"merge text\"],\r\n        pattern: \"=CONCATENATE({text1}, \\\" \\\", {text2})\",\r\n        description: \"Join text values\",\r\n        example: \"=CONCATENATE(A1, \\\" \\\", B1)\"\r\n    },\r\n    {\r\n        id: \"extract_text\",\r\n        keywords: [\"extract\", \"get part\", \"substring\"],\r\n        pattern: \"=MID({text}, {start}, {length})\",\r\n        description: \"Extract part of text\",\r\n        example: \"=MID(A1, 1, 5)\"\r\n    },\r\n    \r\n    // Date patterns\r\n    {\r\n        id: \"date_diff\",\r\n        keywords: [\"days between\", \"date difference\", \"how long\"],\r\n        pattern: \"=DATEDIF({start_date}, {end_date}, \\\"D\\\")\",\r\n        description: \"Calculate days between dates\",\r\n        example: \"=DATEDIF(A1, B1, \\\"D\\\")\"\r\n    },\r\n    {\r\n        id: \"current_date\",\r\n        keywords: [\"today\", \"current date\", \"now\"],\r\n        pattern: \"=TODAY()\",\r\n        description: \"Get current date\",\r\n        example: \"=TODAY()\"\r\n    },\r\n    \r\n    // Error handling patterns\r\n    {\r\n        id: \"safe_divide\",\r\n        keywords: [\"divide\", \"safe division\", \"avoid error\"],\r\n        pattern: \"=IFERROR({numerator}/{denominator}, 0)\",\r\n        description: \"Safe division avoiding #DIV/0!\",\r\n        example: \"=IFERROR(A1/B1, 0)\"\r\n    },\r\n    {\r\n        id: \"safe_lookup\",\r\n        keywords: [\"safe lookup\", \"handle not found\"],\r\n        pattern: \"=IFERROR(VLOOKUP({value}, {range}, {col}, FALSE), \\\"Not found\\\")\",\r\n        description: \"Lookup with error handling\",\r\n        example: \"=IFERROR(VLOOKUP(A1, B:C, 2, FALSE), \\\"Not found\\\")\"\r\n    }\r\n];\r\n\r\n/**\r\n * Searches for relevant patterns based on user query\r\n * @param {string} query - User's request\r\n * @param {number} limit - Max patterns to return\r\n * @returns {Object[]} Matching patterns\r\n */\r\nfunction searchPatterns(query, limit = 5) {\r\n    const lower = query.toLowerCase();\r\n    const scored = [];\r\n    \r\n    for (const pattern of FORMULA_PATTERNS) {\r\n        let score = 0;\r\n        \r\n        // Check keyword matches\r\n        for (const keyword of pattern.keywords) {\r\n            if (lower.includes(keyword)) {\r\n                score += 10;\r\n            }\r\n        }\r\n        \r\n        // Check description match\r\n        if (pattern.description.toLowerCase().split(\" \").some(w => lower.includes(w))) {\r\n            score += 5;\r\n        }\r\n        \r\n        if (score > 0) {\r\n            scored.push({ ...pattern, score });\r\n        }\r\n    }\r\n    \r\n    // Sort by score and return top matches\r\n    return scored\r\n        .sort((a, b) => b.score - a.score)\r\n        .slice(0, limit);\r\n}\r\n\r\n/**\r\n * Gets RAG context for the AI based on user query\r\n * @param {string} query - User's request\r\n * @returns {string} RAG context with relevant patterns\r\n */\r\nfunction getRAGContext(query) {\r\n    const patterns = searchPatterns(query);\r\n    \r\n    if (patterns.length === 0) {\r\n        return \"\";\r\n    }\r\n    \r\n    let context = \"\\n\\n## RELEVANT FORMULA PATTERNS\\n\";\r\n    context += \"Based on your request, here are some useful patterns:\\n\\n\";\r\n    \r\n    for (const pattern of patterns) {\r\n        context += `### ${pattern.description}\\n`;\r\n        context += `Pattern: \\`${pattern.pattern}\\`\\n`;\r\n        context += `Example: \\`${pattern.example}\\`\\n\\n`;\r\n    }\r\n    \r\n    return context;\r\n}\r\n\r\n/**\r\n * Adds a custom pattern to the knowledge base\r\n * @param {Object} pattern - Pattern to add\r\n */\r\n/**\r\n * Safely writes to localStorage with size limit and error handling\r\n * @param {string} key - Storage key\r\n * @param {Array} data - Data to store\r\n * @param {number} maxItems - Maximum items to keep\r\n * @returns {boolean} True if successful\r\n */\r\nfunction safeLocalStorageWrite(key, data, maxItems) {\r\n    try {\r\n        // Enforce bounded history - drop oldest items if exceeds max\r\n        let trimmedData = data;\r\n        if (Array.isArray(data) && data.length > maxItems) {\r\n            trimmedData = data.slice(-maxItems);\r\n        }\r\n        \r\n        localStorage.setItem(key, JSON.stringify(trimmedData));\r\n        return true;\r\n    } catch (e) {\r\n        // Quota exceeded or other storage error\r\n        console.warn(`localStorage write failed for ${key}:`, e.message);\r\n        \r\n        // Try to clear old data and retry with smaller dataset\r\n        try {\r\n            const reducedData = Array.isArray(data) ? data.slice(-Math.floor(maxItems / 2)) : data;\r\n            localStorage.setItem(key, JSON.stringify(reducedData));\r\n            console.warn(`Reduced ${key} storage to ${reducedData.length} items due to quota`);\r\n            return true;\r\n        } catch (retryError) {\r\n            console.error(`Failed to write to localStorage even after reduction:`, retryError);\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Safely reads from localStorage with schema version check\r\n * @param {string} key - Storage key\r\n * @param {*} defaultValue - Default value if not found\r\n * @returns {*} Stored value or default\r\n */\r\nfunction safeLocalStorageRead(key, defaultValue = []) {\r\n    try {\r\n        const stored = localStorage.getItem(key);\r\n        if (!stored) return defaultValue;\r\n        return JSON.parse(stored);\r\n    } catch (e) {\r\n        console.warn(`localStorage read failed for ${key}:`, e.message);\r\n        return defaultValue;\r\n    }\r\n}\r\n\r\nfunction addCustomPattern(pattern) {\r\n    const stored = safeLocalStorageRead(AI_CONFIG.PATTERNS_KEY, []);\r\n    stored.push({\r\n        ...pattern,\r\n        id: `custom_${Date.now()}`,\r\n        custom: true\r\n    });\r\n    \r\n    safeLocalStorageWrite(AI_CONFIG.PATTERNS_KEY, stored, AI_CONFIG.MAX_PATTERNS);\r\n}\r\n\r\n/**\r\n * Gets all patterns including custom ones\r\n * @returns {Object[]} All patterns\r\n */\r\nfunction getAllPatterns() {\r\n    const custom = JSON.parse(localStorage.getItem(AI_CONFIG.PATTERNS_KEY) || \"[]\");\r\n    return [...FORMULA_PATTERNS, ...custom];\r\n}\r\n\r\n// ============================================================================\r\n// Multi-Step Reasoning\r\n// ============================================================================\r\nconst REASONING_STEPS = {\r\n    ANALYZE: \"analyze\",\r\n    PLAN: \"plan\",\r\n    EXECUTE: \"execute\",\r\n    VERIFY: \"verify\"\r\n};\r\n\r\n/**\r\n * Determines if a task requires multi-step reasoning\r\n * @param {string} prompt - User's request\r\n * @returns {boolean} True if complex task\r\n */\r\nfunction requiresMultiStep(prompt) {\r\n    const complexIndicators = [\r\n        \"and then\", \"after that\", \"multiple\", \"several\", \"all columns\",\r\n        \"each row\", \"entire\", \"whole\", \"complex\", \"advanced\",\r\n        \"step by step\", \"breakdown\", \"analyze and\", \"create and\"\r\n    ];\r\n    \r\n    const lower = prompt.toLowerCase();\r\n    return complexIndicators.some(ind => lower.includes(ind)) || prompt.length > 200;\r\n}\r\n\r\n/**\r\n * Breaks down a complex task into steps\r\n * @param {string} prompt - User's request\r\n * @param {Object} dataContext - Current Excel data context\r\n * @returns {Object[]} Array of steps\r\n */\r\nfunction decomposeTask(prompt, dataContext) {\r\n    const steps = [];\r\n    const lower = prompt.toLowerCase();\r\n    \r\n    // Step 1: Always analyze first\r\n    steps.push({\r\n        step: REASONING_STEPS.ANALYZE,\r\n        description: \"Understand the data structure and user intent\",\r\n        prompt: `First, analyze the data:\r\n- What columns are available?\r\n- What is the data type of each column?\r\n- What is the user trying to achieve?`\r\n    });\r\n    \r\n    // Step 2: Plan based on task type\r\n    const taskType = detectTaskType(prompt);\r\n    \r\n    if (taskType === TASK_TYPES.FORMULA) {\r\n        steps.push({\r\n            step: REASONING_STEPS.PLAN,\r\n            description: \"Determine the formula approach\",\r\n            prompt: `Plan the formula:\r\n- Which Excel function(s) are needed?\r\n- What are the exact cell references?\r\n- Are there any edge cases to handle?`\r\n        });\r\n    } else if (taskType === TASK_TYPES.CHART) {\r\n        steps.push({\r\n            step: REASONING_STEPS.PLAN,\r\n            description: \"Design the visualization\",\r\n            prompt: `Plan the chart:\r\n- What chart type best represents this data?\r\n- What should be on each axis?\r\n- What title and labels are needed?`\r\n        });\r\n    } else if (taskType === TASK_TYPES.ANALYSIS) {\r\n        steps.push({\r\n            step: REASONING_STEPS.PLAN,\r\n            description: \"Plan the analysis approach\",\r\n            prompt: `Plan the analysis:\r\n- What metrics should be calculated?\r\n- What patterns should be looked for?\r\n- What insights would be valuable?`\r\n        });\r\n    }\r\n    \r\n    // Step 3: Execute\r\n    steps.push({\r\n        step: REASONING_STEPS.EXECUTE,\r\n        description: \"Generate the solution\",\r\n        prompt: `Now execute the plan:\r\n- Create the necessary ACTION tags\r\n- Use exact cell references from the data\r\n- Provide clear explanations`\r\n    });\r\n    \r\n    // Step 4: Verify (for complex tasks)\r\n    if (lower.includes(\"verify\") || lower.includes(\"check\") || prompt.length > 300) {\r\n        steps.push({\r\n            step: REASONING_STEPS.VERIFY,\r\n            description: \"Verify the solution\",\r\n            prompt: `Verify the solution:\r\n- Are all cell references correct?\r\n- Does the formula handle edge cases?\r\n- Is the output format appropriate?`\r\n        });\r\n    }\r\n    \r\n    return steps;\r\n}\r\n\r\n/**\r\n * Generates a multi-step reasoning prompt\r\n * @param {string} userPrompt - Original user request\r\n * @param {Object} dataContext - Excel data context\r\n * @returns {string} Enhanced prompt with reasoning structure\r\n */\r\nfunction generateReasoningPrompt(userPrompt, dataContext) {\r\n    if (!requiresMultiStep(userPrompt)) {\r\n        return userPrompt;\r\n    }\r\n    \r\n    const steps = decomposeTask(userPrompt, dataContext);\r\n    \r\n    let enhancedPrompt = `## TASK DECOMPOSITION\r\nThis is a complex task. Please follow these steps:\r\n\r\n`;\r\n    \r\n    for (let i = 0; i < steps.length; i++) {\r\n        enhancedPrompt += `### Step ${i + 1}: ${steps[i].description}\r\n${steps[i].prompt}\r\n\r\n`;\r\n    }\r\n    \r\n    enhancedPrompt += `## ORIGINAL REQUEST\r\n${userPrompt}\r\n\r\nPlease work through each step and provide your final solution with ACTION tags.`;\r\n    \r\n    return enhancedPrompt;\r\n}\r\n\r\n// ============================================================================\r\n// Learning from Corrections\r\n// ============================================================================\r\n\r\n/**\r\n * Stores a user correction for future reference\r\n * @param {string} original - What AI said/did\r\n * @param {string} correction - What user corrected to\r\n * @param {string} context - Additional context\r\n */\r\nfunction storeCorrection(original, correction, context = \"\") {\r\n    const corrections = getStoredCorrections();\r\n    \r\n    // Parse the correction to extract the key insight\r\n    const insight = parseCorrection(original, correction);\r\n    \r\n    if (insight) {\r\n        corrections.push({\r\n            id: Date.now(),\r\n            original,\r\n            correction,\r\n            insight,\r\n            context,\r\n            timestamp: new Date().toISOString()\r\n        });\r\n        \r\n        // Use safe write with bounded history\r\n        safeLocalStorageWrite(AI_CONFIG.CORRECTIONS_KEY, corrections, AI_CONFIG.MAX_CORRECTIONS);\r\n    }\r\n}\r\n\r\n/**\r\n * Gets stored corrections\r\n * @returns {Object[]} Array of corrections\r\n */\r\nfunction getStoredCorrections() {\r\n    return safeLocalStorageRead(AI_CONFIG.CORRECTIONS_KEY, []);\r\n}\r\n\r\n/**\r\n * Parses a correction to extract the key insight\r\n * @param {string} original - Original text\r\n * @param {string} correction - Correction text\r\n * @returns {Object|null} Parsed insight\r\n */\r\nfunction parseCorrection(original, correction) {\r\n    const lower = correction.toLowerCase();\r\n    \r\n    // Column corrections: \"no, column E not C\" or \"use column E instead\"\r\n    const colMatch = lower.match(/column\\s+([a-z])\\s+(?:not|instead of|rather than)\\s+([a-z])/i);\r\n    if (colMatch) {\r\n        return {\r\n            type: \"column_preference\",\r\n            wrong: colMatch[2].toUpperCase(),\r\n            correct: colMatch[1].toUpperCase(),\r\n            rule: `Use column ${colMatch[1].toUpperCase()} instead of ${colMatch[2].toUpperCase()}`\r\n        };\r\n    }\r\n    \r\n    // Cell reference corrections: \"should be E2 not C2\"\r\n    const cellMatch = lower.match(/(?:should be|use)\\s+([a-z]+\\d+)\\s+(?:not|instead of)\\s+([a-z]+\\d+)/i);\r\n    if (cellMatch) {\r\n        return {\r\n            type: \"cell_preference\",\r\n            wrong: cellMatch[2].toUpperCase(),\r\n            correct: cellMatch[1].toUpperCase(),\r\n            rule: `Use ${cellMatch[1].toUpperCase()} instead of ${cellMatch[2].toUpperCase()}`\r\n        };\r\n    }\r\n    \r\n    // Header name corrections: \"the column is called X not Y\"\r\n    const headerMatch = lower.match(/(?:column is called|header is|named)\\s+[\"']?([^\"']+)[\"']?\\s+(?:not|instead of)\\s+[\"']?([^\"']+)[\"']?/i);\r\n    if (headerMatch) {\r\n        return {\r\n            type: \"header_preference\",\r\n            wrong: headerMatch[2].trim(),\r\n            correct: headerMatch[1].trim(),\r\n            rule: `The column \"${headerMatch[1].trim()}\" should be used (not \"${headerMatch[2].trim()}\")`\r\n        };\r\n    }\r\n    \r\n    // Format preferences: \"use currency format\" or \"format as percentage\"\r\n    const formatMatch = lower.match(/(?:use|format as|should be)\\s+(currency|percentage|date|number|text)/i);\r\n    if (formatMatch) {\r\n        return {\r\n            type: \"format_preference\",\r\n            format: formatMatch[1].toLowerCase(),\r\n            rule: `Format values as ${formatMatch[1].toLowerCase()}`\r\n        };\r\n    }\r\n    \r\n    // Chart preferences: \"use bar chart not pie\"\r\n    const chartMatch = lower.match(/(?:use|prefer)\\s+(bar|line|pie|column|scatter)\\s+(?:chart|graph)/i);\r\n    if (chartMatch) {\r\n        return {\r\n            type: \"chart_preference\",\r\n            chartType: chartMatch[1].toLowerCase(),\r\n            rule: `Prefer ${chartMatch[1].toLowerCase()} charts`\r\n        };\r\n    }\r\n    \r\n    // General preference\r\n    return {\r\n        type: \"general\",\r\n        rule: correction\r\n    };\r\n}\r\n\r\n/**\r\n * Detects if user message is a correction\r\n * @param {string} message - User's message\r\n * @returns {boolean} True if it's a correction\r\n */\r\nfunction isCorrection(message) {\r\n    const correctionIndicators = [\r\n        \"no,\", \"not\", \"wrong\", \"incorrect\", \"should be\", \"instead\",\r\n        \"actually\", \"i meant\", \"that's not\", \"use column\", \"the column is\"\r\n    ];\r\n    \r\n    const lower = message.toLowerCase().trim();\r\n    return correctionIndicators.some(ind => lower.startsWith(ind) || lower.includes(ind));\r\n}\r\n\r\n/**\r\n * Gets correction context for AI prompt\r\n * @returns {Object} Corrections organized by type\r\n */\r\nfunction getCorrectionContext() {\r\n    const corrections = getStoredCorrections();\r\n    const context = {};\r\n    \r\n    // Group by type and get most recent\r\n    for (const corr of corrections) {\r\n        if (corr.insight) {\r\n            const key = corr.insight.type;\r\n            if (!context[key]) {\r\n                context[key] = [];\r\n            }\r\n            context[key].push(corr.insight.rule);\r\n        }\r\n    }\r\n    \r\n    // Deduplicate and format\r\n    const formatted = {};\r\n    for (const [type, rules] of Object.entries(context)) {\r\n        formatted[type] = [...new Set(rules)].slice(-5).join(\"; \");\r\n    }\r\n    \r\n    return formatted;\r\n}\r\n\r\n/**\r\n * Clears all stored corrections\r\n */\r\nfunction clearCorrections() {\r\n    localStorage.removeItem(AI_CONFIG.CORRECTIONS_KEY);\r\n}\r\n\r\n// ============================================================================\r\n// Main AI Engine Interface\r\n// ============================================================================\r\n\r\n/**\r\n * Enhances a user prompt with all AI features\r\n * @param {string} userPrompt - Original user prompt\r\n * @param {Object} dataContext - Excel data context\r\n * @returns {Object} Enhanced prompt and system prompt\r\n */\r\nfunction enhancePrompt(userPrompt, dataContext) {\r\n    // Detect task type\r\n    const taskType = detectTaskType(userPrompt);\r\n    \r\n    // Check if this is a correction\r\n    const isCorrectionMsg = isCorrection(userPrompt);\r\n    \r\n    // Get corrections context\r\n    const corrections = getCorrectionContext();\r\n    \r\n    // Get task-specific system prompt\r\n    let systemPrompt = getTaskSpecificPrompt(taskType, corrections);\r\n    \r\n    // Add function calling context for formula tasks\r\n    if (taskType === TASK_TYPES.FORMULA) {\r\n        systemPrompt += getFunctionCallingContext();\r\n    }\r\n    \r\n    // Get RAG context\r\n    const ragContext = getRAGContext(userPrompt);\r\n    \r\n    // Apply multi-step reasoning if needed\r\n    let enhancedUserPrompt = userPrompt;\r\n    if (!isCorrectionMsg && requiresMultiStep(userPrompt)) {\r\n        enhancedUserPrompt = generateReasoningPrompt(userPrompt, dataContext);\r\n    }\r\n    \r\n    // Add RAG context to user prompt\r\n    if (ragContext) {\r\n        enhancedUserPrompt = ragContext + \"\\n\\n\" + enhancedUserPrompt;\r\n    }\r\n    \r\n    return {\r\n        systemPrompt,\r\n        userPrompt: enhancedUserPrompt,\r\n        taskType,\r\n        isCorrection: isCorrectionMsg,\r\n        hasMultiStep: requiresMultiStep(userPrompt)\r\n    };\r\n}\r\n\r\n/**\r\n * Extracts text from Gemini API response with robust traversal\r\n * Handles multiple candidates and parts, safety filters, and errors\r\n * @param {Object} data - Raw API response data\r\n * @returns {Object} { text: string, error: string|null, blocked: boolean }\r\n */\r\nfunction extractResponseText(data) {\r\n    // Check for safety/error fields first\r\n    if (data?.promptFeedback?.blockReason) {\r\n        return {\r\n            text: \"\",\r\n            error: `Request blocked: ${data.promptFeedback.blockReason}`,\r\n            blocked: true\r\n        };\r\n    }\r\n    \r\n    // Check if candidates exist\r\n    if (!data?.candidates || data.candidates.length === 0) {\r\n        return {\r\n            text: \"\",\r\n            error: \"AI returned no content\",\r\n            blocked: false\r\n        };\r\n    }\r\n    \r\n    // Iterate over candidates, prefer those with content\r\n    const allTextParts = [];\r\n    \r\n    for (const candidate of data.candidates) {\r\n        // Check for finish reason issues\r\n        if (candidate.finishReason === \"SAFETY\") {\r\n            return {\r\n                text: \"\",\r\n                error: \"Response blocked due to safety filters\",\r\n                blocked: true\r\n            };\r\n        }\r\n        \r\n        if (candidate.finishReason === \"RECITATION\") {\r\n            return {\r\n                text: \"\",\r\n                error: \"Response blocked due to recitation concerns\",\r\n                blocked: true\r\n            };\r\n        }\r\n        \r\n        // Extract text from all parts\r\n        if (candidate.content?.parts) {\r\n            for (const part of candidate.content.parts) {\r\n                if (part.text) {\r\n                    allTextParts.push(part.text);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Join all text segments\r\n    const combinedText = allTextParts.join(\"\\n\");\r\n    \r\n    if (!combinedText) {\r\n        return {\r\n            text: \"\",\r\n            error: \"AI response contained no text\",\r\n            blocked: false\r\n        };\r\n    }\r\n    \r\n    return {\r\n        text: combinedText,\r\n        error: null,\r\n        blocked: false\r\n    };\r\n}\r\n\r\n/**\r\n * Processes AI response and extracts any function calls\r\n * @param {string} response - AI response\r\n * @returns {Object} Processed response with actions\r\n */\r\nfunction processResponse(response) {\r\n    // Parse any function calls\r\n    const functionCalls = parseFunctionCalls(response);\r\n    \r\n    // Clean response (remove function call syntax)\r\n    const cleanedResponse = response.replace(/CALL_FUNCTION\\s*\\([^)]+\\)/gi, \"\");\r\n    \r\n    return {\r\n        response: cleanedResponse,\r\n        additionalActions: functionCalls\r\n    };\r\n}\r\n\r\n/**\r\n * Handles a user correction\r\n * @param {string} userMessage - User's correction message\r\n * @param {string} previousAIResponse - What AI said before\r\n */\r\nfunction handleCorrection(userMessage, previousAIResponse) {\r\n    if (isCorrection(userMessage)) {\r\n        storeCorrection(previousAIResponse, userMessage);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// ============================================================================\r\n// Exports\r\n// ============================================================================\r\nexport {\r\n    // Task detection\r\n    detectTaskType,\r\n    TASK_TYPES,\r\n    \r\n    // Prompts\r\n    getTaskSpecificPrompt,\r\n    enhancePrompt,\r\n    \r\n    // Function calling\r\n    EXCEL_FUNCTIONS,\r\n    getFunctionCallingContext,\r\n    parseFunctionCalls,\r\n    \r\n    // RAG\r\n    searchPatterns,\r\n    getRAGContext,\r\n    addCustomPattern,\r\n    getAllPatterns,\r\n    FORMULA_PATTERNS,\r\n    \r\n    // Multi-step reasoning\r\n    requiresMultiStep,\r\n    decomposeTask,\r\n    generateReasoningPrompt,\r\n    \r\n    // Corrections\r\n    isCorrection,\r\n    storeCorrection,\r\n    getStoredCorrections,\r\n    getCorrectionContext,\r\n    clearCorrections,\r\n    handleCorrection,\r\n    \r\n    // Response processing\r\n    extractResponseText,\r\n    processResponse,\r\n    \r\n    // Storage utilities\r\n    safeLocalStorageWrite,\r\n    safeLocalStorageRead\r\n};\r\n","/**\r\n * Excel Data Module\r\n * Handles Excel data access and context building\r\n */\r\n\r\n/* global Excel */\r\n\r\n// ============================================================================\r\n// Column Letter Helpers\r\n// ============================================================================\r\n\r\n/**\r\n * Converts a zero-based column index to Excel column letter(s)\r\n * Supports multi-letter columns (A, Z, AA, AB, etc.)\r\n * @param {number} index - Zero-based column index\r\n * @returns {string} Column letter(s)\r\n */\r\nfunction colIndexToLetter(index) {\r\n    let letter = \"\";\r\n    while (index >= 0) {\r\n        letter = String.fromCharCode((index % 26) + 65) + letter;\r\n        index = Math.floor(index / 26) - 1;\r\n    }\r\n    return letter;\r\n}\r\n\r\n/**\r\n * Converts Excel column letter(s) to zero-based index\r\n * Supports multi-letter columns (A, Z, AA, AB, etc.)\r\n * @param {string} col - Column letter(s) like \"A\", \"Z\", \"AA\", \"AB\"\r\n * @returns {number} Zero-based column index\r\n */\r\nfunction colLetterToIndex(col) {\r\n    let index = 0;\r\n    const upper = col.toUpperCase();\r\n    for (let i = 0; i < upper.length; i++) {\r\n        index = index * 26 + (upper.charCodeAt(i) - 64);\r\n    }\r\n    return index - 1; // Convert to zero-based\r\n}\r\n\r\n// ============================================================================\r\n// Data Reading\r\n// ============================================================================\r\n\r\n/**\r\n * Reads Excel data from the workbook\r\n * @param {Object} state - Application state object\r\n * @param {Function} updateContextInfo - Callback to update UI context info\r\n * @param {Function} logDiagnostic - Optional callback for diagnostic logging\r\n * @returns {Promise<void>}\r\n */\r\nasync function readExcelData(state, updateContextInfo, logDiagnostic) {\r\n    const log = logDiagnostic || (() => {});\r\n    \r\n    try {\r\n        await Excel.run(async (ctx) => {\r\n            const sheets = ctx.workbook.worksheets;\r\n            sheets.load(\"items\");\r\n            await ctx.sync();\r\n            \r\n            // Read sheets based on scope setting\r\n            const allSheetsData = [];\r\n            const shouldReadAllSheets = state.worksheetScope === \"all\";\r\n            \r\n            // Get active sheet first\r\n            const activeSheet = ctx.workbook.worksheets.getActiveWorksheet();\r\n            activeSheet.load(\"name\");\r\n            await ctx.sync();\r\n            \r\n            const activeSheetName = activeSheet.name;\r\n            \r\n            // Determine which sheets to read\r\n            const sheetsToRead = shouldReadAllSheets \r\n                ? sheets.items.slice(0, 10) // All sheets (max 10)\r\n                : [sheets.items.find(s => s.name === activeSheetName) || sheets.items[0]];\r\n            \r\n            for (const sheet of sheetsToRead) {\r\n                try {\r\n                    const usedRange = sheet.getUsedRange();\r\n                    sheet.load(\"name\");\r\n                    usedRange.load([\"address\", \"values\", \"rowCount\", \"columnCount\", \"columnIndex\", \"rowIndex\"]);\r\n                    await ctx.sync();\r\n                    \r\n                    const sheetName = sheet.name;\r\n                    const values = usedRange.values;\r\n                    const startCol = usedRange.columnIndex;\r\n                    const startRow = usedRange.rowIndex;\r\n                    const rowCount = usedRange.rowCount;\r\n                    const colCount = usedRange.columnCount;\r\n                    \r\n                    // Handle empty sheets - skip if no data\r\n                    if (rowCount === 0 || !values || values.length === 0) {\r\n                        log(`Sheet \"${sheetName}\" has no data, skipping`);\r\n                        continue;\r\n                    }\r\n                    \r\n                    // Detect headers (first row) with guard\r\n                    const headers = values.length > 0 ? (values[0] || []) : [];\r\n                    \r\n                    // Validate headers - check if first row looks like headers\r\n                    const headerValidation = validateHeaders(headers);\r\n                    \r\n                    // Build column mapping\r\n                    const columnMap = [];\r\n                    for (let c = 0; c < colCount; c++) {\r\n                        const colLetter = colIndexToLetter(startCol + c);\r\n                        let headerName;\r\n                        if (headerValidation.isValid && headers[c]) {\r\n                            headerName = headers[c];\r\n                        } else {\r\n                            // Use generic column names if headers don't look valid\r\n                            headerName = `Column ${colLetter}`;\r\n                        }\r\n                        columnMap.push({\r\n                            letter: colLetter,\r\n                            index: c,\r\n                            header: headerName\r\n                        });\r\n                    }\r\n                    \r\n                    allSheetsData.push({\r\n                        sheetName,\r\n                        address: usedRange.address,\r\n                        values,\r\n                        headers: headerValidation.isValid ? headers : columnMap.map(c => c.header),\r\n                        columnMap,\r\n                        startRow: startRow + 1,\r\n                        startCol: colIndexToLetter(startCol),\r\n                        rowCount,\r\n                        colCount,\r\n                        dataStartRow: startRow + 2,\r\n                        headerValidation\r\n                    });\r\n                    \r\n                    log(`Read sheet \"${sheetName}\": ${rowCount} rows  ${colCount} cols`);\r\n                } catch (e) {\r\n                    // Sheet might be empty, log and skip it\r\n                    const sheetName = sheet.name || \"Unknown\";\r\n                    console.warn(`Skipping sheet ${sheetName}:`, e);\r\n                    log(`Failed to read sheet \"${sheetName}\": ${e.message}`);\r\n                }\r\n            }\r\n            \r\n            // Handle case where no sheets have usable data\r\n            if (allSheetsData.length === 0) {\r\n                state.currentData = null;\r\n                state.allSheetsData = [];\r\n                updateContextInfo(\"No usable data found in any sheet\");\r\n                log(\"No usable data found in any sheet\");\r\n                return;\r\n            }\r\n            \r\n            // Set current data to active sheet\r\n            const activeSheetData = allSheetsData.find(s => s.sheetName === activeSheetName);\r\n            state.currentData = activeSheetData || allSheetsData[0] || null;\r\n            state.allSheetsData = shouldReadAllSheets ? allSheetsData : [];\r\n            \r\n            if (state.currentData) {\r\n                const scopeText = shouldReadAllSheets ? ` (${allSheetsData.length} sheets)` : \"\";\r\n                updateContextInfo(`${state.currentData.sheetName}: ${state.currentData.rowCount} rows  ${state.currentData.colCount} cols${scopeText}`);\r\n            } else {\r\n                updateContextInfo(\"No data\");\r\n            }\r\n        });\r\n    } catch (e) {\r\n        // Log the actual error for debugging\r\n        console.error(\"Failed to read Excel data:\", e);\r\n        const errorReason = e.message || \"Unknown error\";\r\n        updateContextInfo(`Failed to read data: ${errorReason}`);\r\n        state.currentData = null;\r\n        state.allSheetsData = [];\r\n        log(`readExcelData error: ${errorReason}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Validates if the first row looks like headers\r\n * @param {Array} headers - First row values\r\n * @returns {Object} Validation result with isValid flag and reason\r\n */\r\nfunction validateHeaders(headers) {\r\n    if (!headers || headers.length === 0) {\r\n        return { isValid: false, reason: \"Empty headers\" };\r\n    }\r\n    \r\n    // Count how many cells look like headers (strings, not numbers)\r\n    let stringCount = 0;\r\n    let numberCount = 0;\r\n    let emptyCount = 0;\r\n    \r\n    for (const cell of headers) {\r\n        if (cell === null || cell === undefined || cell === \"\") {\r\n            emptyCount++;\r\n        } else if (typeof cell === \"string\") {\r\n            stringCount++;\r\n        } else if (typeof cell === \"number\") {\r\n            numberCount++;\r\n        }\r\n    }\r\n    \r\n    const total = headers.length;\r\n    const stringRatio = stringCount / total;\r\n    \r\n    // Headers are valid if mostly strings (>50%)\r\n    if (stringRatio >= 0.5) {\r\n        return { isValid: true, reason: \"Mostly string values\" };\r\n    }\r\n    \r\n    // If mostly numbers, probably not headers\r\n    if (numberCount > stringCount) {\r\n        return { isValid: false, reason: \"First row appears to be data (mostly numbers)\" };\r\n    }\r\n    \r\n    return { isValid: true, reason: \"Default assumption\" };\r\n}\r\n\r\n/**\r\n * Builds data context string for AI prompts\r\n * @param {Object} state - Application state with currentData and allSheetsData\r\n * @returns {string} Formatted data context\r\n */\r\nfunction buildDataContext(state) {\r\n    if (!state.currentData) {\r\n        return \"ERROR: No Excel data available.\";\r\n    }\r\n    \r\n    const { sheetName, values, columnMap, rowCount, colCount, dataStartRow, address, headerValidation } = state.currentData;\r\n    \r\n    let context = `## EXCEL WORKBOOK DATA\\n\\n`;\r\n    \r\n    // List all sheets in workbook\r\n    if (state.allSheetsData && state.allSheetsData.length > 1) {\r\n        context += `**Available Sheets:** ${state.allSheetsData.map(s => s.sheetName).join(\", \")}\\n`;\r\n        context += `**Active Sheet:** ${sheetName}\\n\\n`;\r\n    } else {\r\n        context += `**Sheet:** ${sheetName}\\n`;\r\n    }\r\n    \r\n    context += `**Data Range:** ${address}\\n`;\r\n    context += `**Total Rows:** ${rowCount} (including header)\\n`;\r\n    context += `**Total Columns:** ${colCount}\\n`;\r\n    \r\n    // Add header validation note if headers look suspicious\r\n    if (headerValidation && !headerValidation.isValid) {\r\n        context += `**Note:** ${headerValidation.reason} - using generic column names\\n`;\r\n    }\r\n    context += `\\n`;\r\n    \r\n    // Column structure - CRITICAL for AI to understand\r\n    context += `## COLUMN STRUCTURE\\n`;\r\n    context += `| Column Letter | Header Name | Sample Values |\\n`;\r\n    context += `|---------------|-------------|---------------|\\n`;\r\n    \r\n    for (const col of columnMap) {\r\n        // Get sample values from first few data rows\r\n        const samples = [];\r\n        for (let r = 1; r < Math.min(4, values.length); r++) {\r\n            const val = values[r]?.[col.index];\r\n            if (val !== null && val !== undefined && val !== \"\") {\r\n                samples.push(String(val).substring(0, 20));\r\n            }\r\n        }\r\n        context += `| ${col.letter} | ${col.header} | ${samples.join(\", \")} |\\n`;\r\n    }\r\n    \r\n    context += `\\n## DATA PREVIEW (First 30 rows)\\n\\n`;\r\n    \r\n    // Header row\r\n    context += `| Row |`;\r\n    for (const col of columnMap) {\r\n        context += ` ${col.letter}: ${col.header} |`;\r\n    }\r\n    context += `\\n|-----|`;\r\n    for (let c = 0; c < colCount; c++) {\r\n        context += `------------|`;\r\n    }\r\n    context += `\\n`;\r\n    \r\n    // Data rows\r\n    const maxRows = Math.min(30, values.length);\r\n    for (let r = 0; r < maxRows; r++) {\r\n        const rowNum = state.currentData.startRow + r;\r\n        context += `| ${rowNum} |`;\r\n        for (let c = 0; c < colCount; c++) {\r\n            let val = values[r]?.[c];\r\n            if (val === null || val === undefined) val = \"\";\r\n            val = String(val).substring(0, 25);\r\n            context += ` ${val} |`;\r\n        }\r\n        context += `\\n`;\r\n    }\r\n    \r\n    if (rowCount > 30) {\r\n        context += `\\n... and ${rowCount - 30} more rows\\n`;\r\n    }\r\n    \r\n    // Add unique values for key columns (for dropdowns)\r\n    context += `\\n## UNIQUE VALUES IN EACH COLUMN (for dropdowns)\\n`;\r\n    for (const col of columnMap) {\r\n        const uniqueVals = new Set();\r\n        for (let r = 1; r < values.length; r++) {\r\n            const val = values[r]?.[col.index];\r\n            if (val !== null && val !== undefined && val !== \"\") {\r\n                uniqueVals.add(val);\r\n            }\r\n        }\r\n        if (uniqueVals.size > 0 && uniqueVals.size <= 50) {\r\n            context += `**${col.letter} (${col.header}):** ${Array.from(uniqueVals).slice(0, 20).join(\", \")}`;\r\n            if (uniqueVals.size > 20) context += ` ... (${uniqueVals.size} total)`;\r\n            context += `\\n`;\r\n        }\r\n    }\r\n    \r\n    // Add information about other sheets\r\n    if (state.allSheetsData && state.allSheetsData.length > 1) {\r\n        context += `\\n## OTHER SHEETS IN WORKBOOK\\n`;\r\n        for (const sheet of state.allSheetsData) {\r\n            if (sheet.sheetName === sheetName) continue; // Skip current sheet\r\n            \r\n            context += `\\n### ${sheet.sheetName}\\n`;\r\n            context += `- Columns: ${sheet.headers.join(\", \")}\\n`;\r\n            context += `- Rows: ${sheet.rowCount}\\n`;\r\n            \r\n            // Show first few rows as sample\r\n            if (sheet.values.length > 1) {\r\n                context += `- Sample data (first 3 rows):\\n`;\r\n                for (let r = 0; r < Math.min(3, sheet.values.length); r++) {\r\n                    const row = sheet.values[r];\r\n                    context += `  ${r === 0 ? \"Headers\" : `Row ${r}`}: ${row.slice(0, 5).join(\" | \")}\\n`;\r\n                }\r\n            }\r\n        }\r\n        context += `\\n**Note:** You can reference data from any sheet using sheet name (e.g., DeptManagers!A2:B10)\\n`;\r\n    }\r\n    \r\n    return context;\r\n}\r\n\r\n/**\r\n * Sets up selection change listener for auto-refresh\r\n * @param {Function} onSelectionChange - Callback when selection changes\r\n * @param {Function} logDiagnostic - Optional callback for diagnostic logging\r\n * @param {Function} showToast - Optional callback to show toast messages\r\n * @returns {Promise<Object|null>} Event handler reference or null\r\n */\r\nasync function setupSelectionListener(onSelectionChange, logDiagnostic, showToast) {\r\n    const log = logDiagnostic || (() => {});\r\n    const toast = showToast || (() => {});\r\n    \r\n    try {\r\n        let handler = null;\r\n        await Excel.run(async (ctx) => {\r\n            const worksheet = ctx.workbook.worksheets.getActiveWorksheet();\r\n            handler = worksheet.onSelectionChanged.add(onSelectionChange);\r\n            await ctx.sync();\r\n            log(\"Selection listener attached successfully\");\r\n        });\r\n        return handler;\r\n    } catch (e) {\r\n        console.warn(\"Could not attach selection listener:\", e);\r\n        log(`Selection listener failed: ${e.message}`);\r\n        toast(\"Selection auto-refresh unavailable\");\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Removes a selection change listener\r\n * @param {Object} handler - Event handler to remove\r\n * @returns {Promise<void>}\r\n */\r\nasync function removeSelectionListener(handler) {\r\n    if (!handler) return;\r\n    \r\n    try {\r\n        await Excel.run(async (ctx) => {\r\n            handler.remove();\r\n            await ctx.sync();\r\n        });\r\n    } catch (e) {\r\n        console.warn(\"Could not remove selection listener:\", e);\r\n    }\r\n}\r\n\r\n// Export for ES modules\r\nexport {\r\n    colIndexToLetter,\r\n    colLetterToIndex,\r\n    readExcelData,\r\n    validateHeaders,\r\n    buildDataContext,\r\n    setupSelectionListener,\r\n    removeSelectionListener\r\n};\r\n","/**\r\n * Diagnostics Module\r\n * Provides logging and debug functionality for the add-in\r\n */\r\n\r\n// ============================================================================\r\n// Configuration\r\n// ============================================================================\r\n\r\nconst DIAG_CONFIG = {\r\n    MAX_LOGS: 100,\r\n    STORAGE_KEY: \"excel_copilot_debug_mode\"\r\n};\r\n\r\n// ============================================================================\r\n// State\r\n// ============================================================================\r\n\r\nlet logs = [];\r\nlet debugMode = false;\r\nlet updateCallback = null;\r\n\r\n// ============================================================================\r\n// Initialization\r\n// ============================================================================\r\n\r\n/**\r\n * Initializes the diagnostics system\r\n * @param {Function} onUpdate - Callback when logs are updated\r\n */\r\nfunction initDiagnostics(onUpdate) {\r\n    updateCallback = onUpdate;\r\n    \r\n    // Load debug mode preference\r\n    try {\r\n        debugMode = localStorage.getItem(DIAG_CONFIG.STORAGE_KEY) === \"true\";\r\n    } catch (e) {\r\n        debugMode = false;\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// Logging\r\n// ============================================================================\r\n\r\n/**\r\n * Adds a log entry\r\n * @param {string} message - Log message\r\n * @param {string} level - Log level: \"info\", \"warn\", \"error\", \"debug\"\r\n * @param {Object} data - Optional additional data\r\n */\r\nfunction log(message, level = \"info\", data = null) {\r\n    const entry = {\r\n        id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),\r\n        timestamp: Date.now(),\r\n        level,\r\n        message,\r\n        data\r\n    };\r\n\r\n    logs.unshift(entry);\r\n    \r\n    // Enforce max limit\r\n    if (logs.length > DIAG_CONFIG.MAX_LOGS) {\r\n        logs = logs.slice(0, DIAG_CONFIG.MAX_LOGS);\r\n    }\r\n    \r\n    // Console output based on level\r\n    if (level === \"error\") {\r\n        console.error(`[Copilot] ${message}`, data || \"\");\r\n    } else if (level === \"warn\") {\r\n        console.warn(`[Copilot] ${message}`, data || \"\");\r\n    } else if (debugMode || level !== \"debug\") {\r\n        console.log(`[Copilot] ${message}`, data || \"\");\r\n    }\r\n    \r\n    // Notify UI\r\n    if (updateCallback) {\r\n        updateCallback(logs);\r\n    }\r\n}\r\n\r\n/**\r\n * Logs an info message\r\n * @param {string} message - Log message\r\n * @param {Object} data - Optional additional data\r\n */\r\nfunction logInfo(message, data = null) {\r\n    log(message, \"info\", data);\r\n}\r\n\r\n/**\r\n * Logs a warning message\r\n * @param {string} message - Log message\r\n * @param {Object} data - Optional additional data\r\n */\r\nfunction logWarn(message, data = null) {\r\n    log(message, \"warn\", data);\r\n}\r\n\r\n/**\r\n * Logs an error message\r\n * @param {string} message - Log message\r\n * @param {Object} data - Optional additional data\r\n */\r\nfunction logError(message, data = null) {\r\n    log(message, \"error\", data);\r\n}\r\n\r\n/**\r\n * Logs a debug message (only shown in debug mode)\r\n * @param {string} message - Log message\r\n * @param {Object} data - Optional additional data\r\n */\r\nfunction logDebug(message, data = null) {\r\n    log(message, \"debug\", data);\r\n}\r\n\r\n// ============================================================================\r\n// Log Management\r\n// ============================================================================\r\n\r\n/**\r\n * Gets all logs\r\n * @returns {Array} Array of log entries\r\n */\r\nfunction getLogs() {\r\n    return [...logs];\r\n}\r\n\r\n/**\r\n * Gets recent logs\r\n * @param {number} count - Number of logs to return\r\n * @returns {Array} Array of recent log entries\r\n */\r\nfunction getRecentLogs(count = 20) {\r\n    return logs.slice(0, count);\r\n}\r\n\r\n/**\r\n * Clears all logs\r\n */\r\nfunction clearLogs() {\r\n    logs = [];\r\n    if (updateCallback) {\r\n        updateCallback(logs);\r\n    }\r\n}\r\n\r\n/**\r\n * Filters logs by level\r\n * @param {string} level - Level to filter by\r\n * @returns {Array} Filtered log entries\r\n */\r\nfunction filterLogsByLevel(level) {\r\n    return logs.filter(entry => entry.level === level);\r\n}\r\n\r\n// ============================================================================\r\n// Debug Mode\r\n// ============================================================================\r\n\r\n/**\r\n * Enables debug mode\r\n */\r\nfunction enableDebugMode() {\r\n    debugMode = true;\r\n    try {\r\n        localStorage.setItem(DIAG_CONFIG.STORAGE_KEY, \"true\");\r\n    } catch (e) {\r\n        // Storage not available\r\n    }\r\n    logInfo(\"Debug mode enabled\");\r\n}\r\n\r\n/**\r\n * Disables debug mode\r\n */\r\nfunction disableDebugMode() {\r\n    debugMode = false;\r\n    try {\r\n        localStorage.setItem(DIAG_CONFIG.STORAGE_KEY, \"false\");\r\n    } catch (e) {\r\n        // Storage not available\r\n    }\r\n    logInfo(\"Debug mode disabled\");\r\n}\r\n\r\n/**\r\n * Toggles debug mode\r\n * @returns {boolean} New debug mode state\r\n */\r\nfunction toggleDebugMode() {\r\n    if (debugMode) {\r\n        disableDebugMode();\r\n    } else {\r\n        enableDebugMode();\r\n    }\r\n    return debugMode;\r\n}\r\n\r\n/**\r\n * Checks if debug mode is enabled\r\n * @returns {boolean} Debug mode state\r\n */\r\nfunction isDebugMode() {\r\n    return debugMode;\r\n}\r\n\r\n// ============================================================================\r\n// Formatting\r\n// ============================================================================\r\n\r\n/**\r\n * Formats a timestamp as relative time\r\n * @param {number} timestamp - Unix timestamp\r\n * @returns {string} Formatted time string\r\n */\r\nfunction formatLogTime(timestamp) {\r\n    const now = Date.now();\r\n    const diff = now - timestamp;\r\n    \r\n    if (diff < 1000) return \"just now\";\r\n    if (diff < 60000) return `${Math.floor(diff / 1000)}s ago`;\r\n    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\r\n    \r\n    const date = new Date(timestamp);\r\n    return date.toLocaleTimeString();\r\n}\r\n\r\n/**\r\n * Renders a single log entry as HTML\r\n * @param {Object} entry - Log entry\r\n * @returns {string} HTML string\r\n */\r\nfunction renderLogEntry(entry) {\r\n    const levelIcons = {\r\n        info: \"\",\r\n        warn: \"\",\r\n        error: \"\",\r\n        debug: \"\"\r\n    };\r\n    \r\n    const levelClasses = {\r\n        info: \"log-info\",\r\n        warn: \"log-warn\",\r\n        error: \"log-error\",\r\n        debug: \"log-debug\"\r\n    };\r\n    \r\n    const icon = levelIcons[entry.level] || \"\";\r\n    const levelClass = levelClasses[entry.level] || \"\";\r\n    const timeStr = formatLogTime(entry.timestamp);\r\n    \r\n    let dataStr = \"\";\r\n    if (entry.data && debugMode) {\r\n        try {\r\n            dataStr = `<pre class=\"log-data\">${JSON.stringify(entry.data, null, 2)}</pre>`;\r\n        } catch (e) {\r\n            dataStr = `<pre class=\"log-data\">${String(entry.data)}</pre>`;\r\n        }\r\n    }\r\n    \r\n    return `\r\n        <div class=\"log-entry ${levelClass}\" data-id=\"${entry.id}\">\r\n            <span class=\"log-icon\">${icon}</span>\r\n            <span class=\"log-message\">${escapeHtml(entry.message)}</span>\r\n            <span class=\"log-time\">${timeStr}</span>\r\n            ${dataStr}\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Renders the diagnostics panel content\r\n * @param {Array} entries - Log entries to display\r\n * @returns {string} HTML string\r\n */\r\nfunction renderDiagnosticsPanel(entries) {\r\n    if (!entries || entries.length === 0) {\r\n        return '<div class=\"log-empty\">No logs yet</div>';\r\n    }\r\n    \r\n    return entries.map(entry => renderLogEntry(entry)).join(\"\");\r\n}\r\n\r\n/**\r\n * Escapes HTML special characters\r\n * @param {string} text - Text to escape\r\n * @returns {string} Escaped text\r\n */\r\nfunction escapeHtml(text) {\r\n    const div = document.createElement(\"div\");\r\n    div.textContent = text;\r\n    return div.innerHTML;\r\n}\r\n\r\n// ============================================================================\r\n// Exports\r\n// ============================================================================\r\n\r\nexport {\r\n    initDiagnostics,\r\n    log,\r\n    logInfo,\r\n    logWarn,\r\n    logError,\r\n    logDebug,\r\n    getLogs,\r\n    getRecentLogs,\r\n    clearLogs,\r\n    filterLogsByLevel,\r\n    enableDebugMode,\r\n    disableDebugMode,\r\n    toggleDebugMode,\r\n    isDebugMode,\r\n    formatLogTime,\r\n    renderLogEntry,\r\n    renderDiagnosticsPanel\r\n};\r\n","/*\n * Excel AI Copilot - Accurate Data Understanding\n * Enhanced with: Task-specific prompts, Function calling, RAG, Multi-step reasoning, Learning\n */\n\n/* global document, Excel, Office, fetch, localStorage */\n\n// Version number - increment with each update\nconst VERSION = \"3.1.1\";\n\nimport {\n    detectTaskType,\n    TASK_TYPES,\n    enhancePrompt,\n    isCorrection,\n    handleCorrection,\n    processResponse,\n    extractResponseText,\n    getRAGContext,\n    getCorrectionContext,\n    clearCorrections\n} from \"./ai-engine.js\";\n\nimport {\n    colIndexToLetter,\n    colLetterToIndex,\n    buildDataContext as buildDataContextFromModule,\n    setupSelectionListener as setupSelectionListenerFromModule,\n    removeSelectionListener,\n    validateHeaders\n} from \"./excel-data.js\";\n\nimport {\n    setDiagnosticLogger,\n    executeAction as executeActionFromModule,\n    adjustFormulaReferences\n} from \"./action-executor.js\";\n\nimport {\n    initDiagnostics,\n    logInfo,\n    logWarn,\n    logError,\n    logDebug,\n    getLogs,\n    clearLogs,\n    toggleDebugMode,\n    isDebugMode,\n    renderDiagnosticsPanel\n} from \"./diagnostics.js\";\n\nconst CONFIG = {\n    GEMINI_MODEL: \"gemini-2.0-flash\",\n    API_ENDPOINT: \"https://generativelanguage.googleapis.com/v1beta/models/\",\n    STORAGE_KEY: \"excel_copilot_api_key\",\n    THEME_KEY: \"excel_copilot_theme\",\n    MAX_HISTORY: 10,\n    MAX_RETRIES: 3,\n    RETRY_DELAY: 1000,\n    VERSION: VERSION\n};\n\nconst state = {\n    apiKey: \"\",\n    pendingActions: [],\n    currentData: null,\n    allSheetsData: [],       // Data from all sheets in workbook\n    conversationHistory: [],\n    isFirstMessage: true,\n    lastAIResponse: \"\",      // Track last AI response for corrections\n    currentTaskType: null,   // Track current task type\n    worksheetScope: \"single\", // \"single\" or \"all\" - controls multi-sheet access\n    selectionHandler: null,  // Reference to selection change event handler\n    // Preview state\n    preview: {\n        selections: [],      // boolean[] - selection state for each action\n        expandedIndex: -1,   // number - index of expanded action (-1 if none)\n        highlightedIndex: -1 // number - index of highlighted action (-1 if none)\n    },\n    // History state for undo functionality\n    history: {\n        entries: [],         // HistoryEntry[] - all history entries, newest first\n        panelVisible: false, // boolean - whether history panel is shown\n        maxEntries: 20       // number - maximum entries to retain\n    },\n    // Diagnostics state\n    logs: [],                // Diagnostic log entries\n    diagnosticsPanelVisible: false\n};\n\n// ============================================================================\n// Initialize\n// ============================================================================\nOffice.onReady((info) => {\n    if (info.host === Office.HostType.Excel) {\n        initApp();\n    }\n});\n\nfunction initApp() {\n    // Initialize diagnostics system\n    initDiagnostics((logs) => {\n        state.logs = logs;\n        if (state.diagnosticsPanelVisible) {\n            updateDiagnosticsPanel();\n        }\n    });\n    \n    // Set up diagnostic logger for action executor\n    setDiagnosticLogger((msg) => logDebug(msg));\n    \n    logInfo(\"Excel Copilot initializing\", { version: VERSION });\n    \n    // Comment 8: Load API key with de-obfuscation\n    // Note: Key is stored with basic obfuscation for backward compatibility\n    try {\n        const stored = localStorage.getItem(CONFIG.STORAGE_KEY) || \"\";\n        if (stored) {\n            // Try to decode (new format) or use as-is (old format)\n            try {\n                state.apiKey = atob(stored);\n            } catch (e) {\n                // Old format - use as-is\n                state.apiKey = stored;\n            }\n        }\n    } catch (e) {\n        state.apiKey = \"\";\n        logWarn(\"Could not load API key\");\n    }\n    \n    // Update version badge and add click handler\n    const versionBadge = document.getElementById(\"versionBadge\");\n    if (versionBadge) {\n        versionBadge.textContent = `v${VERSION}`;\n        versionBadge.style.cursor = \"pointer\";\n        versionBadge.addEventListener(\"click\", checkForUpdates);\n    }\n    \n    // Load saved theme\n    const savedTheme = localStorage.getItem(CONFIG.THEME_KEY);\n    if (savedTheme) {\n        document.documentElement.setAttribute('data-theme', savedTheme);\n    }\n    \n    // Load saved worksheet scope preference\n    const savedScope = localStorage.getItem(\"excel_copilot_worksheet_scope\");\n    if (savedScope) {\n        state.worksheetScope = savedScope;\n    }\n    bindEvents();\n    initModeButtons();\n    readExcelData().then(() => {\n        logInfo(\"Initial data load complete\");\n    });\n}\n\nfunction bindEvents() {\n    const sendBtn = document.getElementById(\"sendBtn\");\n    const input = document.getElementById(\"promptInput\");\n    \n    sendBtn?.addEventListener(\"click\", handleSend);\n    input?.addEventListener(\"keydown\", (e) => {\n        if (e.key === \"Enter\" && !e.shiftKey) {\n            e.preventDefault();\n            handleSend();\n        }\n    });\n    input?.addEventListener(\"input\", () => {\n        sendBtn.disabled = !input.value.trim();\n        input.style.height = \"auto\";\n        input.style.height = Math.min(input.scrollHeight, 120) + \"px\";\n    });\n    \n    document.getElementById(\"applyBtn\")?.addEventListener(\"click\", handleApply);\n    \n    document.getElementById(\"refreshBtn\")?.addEventListener(\"click\", async () => {\n        const btn = document.getElementById(\"refreshBtn\");\n        btn.classList.add(\"loading\");\n        await readExcelData();\n        btn.classList.remove(\"loading\");\n        toast(\"Refreshed\");\n    });\n    \n    document.getElementById(\"settingsBtn\")?.addEventListener(\"click\", () => {\n        document.getElementById(\"apiKeyInput\").value = state.apiKey;\n        // Set worksheet scope radio button\n        document.getElementById(state.worksheetScope === \"all\" ? \"scopeAll\" : \"scopeSingle\").checked = true;\n        document.getElementById(\"modal\").classList.add(\"open\");\n    });\n    \n    document.getElementById(\"closeModal\")?.addEventListener(\"click\", closeModal);\n    document.getElementById(\"cancelBtn\")?.addEventListener(\"click\", closeModal);\n    document.getElementById(\"saveBtn\")?.addEventListener(\"click\", async () => {\n        state.apiKey = document.getElementById(\"apiKeyInput\").value.trim();\n        \n        // Comment 8: Store API key with minimal obfuscation\n        // Note: For better security, consider not persisting at all\n        if (state.apiKey) {\n            // Simple base64 encoding (not true encryption, but prevents casual viewing)\n            const obfuscated = btoa(state.apiKey);\n            localStorage.setItem(CONFIG.STORAGE_KEY, obfuscated);\n        } else {\n            localStorage.removeItem(CONFIG.STORAGE_KEY);\n        }\n        \n        // Save worksheet scope preference\n        const selectedScope = document.querySelector('input[name=\"worksheetScope\"]:checked')?.value || \"single\";\n        const scopeChanged = state.worksheetScope !== selectedScope;\n        state.worksheetScope = selectedScope;\n        localStorage.setItem(\"excel_copilot_worksheet_scope\", selectedScope);\n        \n        // Comment 6: Re-attach selection listener and refresh data when scope changes\n        if (scopeChanged) {\n            await reattachSelectionListener();\n        }\n        \n        // Refresh data to apply new scope\n        await readExcelData();\n        \n        closeModal();\n        toast(\"Saved\");\n        logInfo(\"Settings saved\", { scope: selectedScope });\n    });\n    \n    // Comment 8: Add \"Remove API key\" functionality\n    document.getElementById(\"removeApiKeyBtn\")?.addEventListener(\"click\", () => {\n        state.apiKey = \"\";\n        localStorage.removeItem(CONFIG.STORAGE_KEY);\n        document.getElementById(\"apiKeyInput\").value = \"\";\n        toast(\"API key removed\");\n        logInfo(\"API key removed\");\n    });\n    \n    document.getElementById(\"modal\")?.addEventListener(\"click\", (e) => {\n        if (e.target.id === \"modal\") closeModal();\n    });\n    \n    // Clear learned preferences button\n    document.getElementById(\"clearPrefsBtn\")?.addEventListener(\"click\", () => {\n        clearLearnedCorrections();\n    });\n    \n    document.getElementById(\"clearBtn\")?.addEventListener(\"click\", clearChat);\n    \n    // History and Undo buttons\n    document.getElementById(\"historyBtn\")?.addEventListener(\"click\", toggleHistoryPanel);\n    document.getElementById(\"undoBtn\")?.addEventListener(\"click\", performUndo);\n    \n    // Comment 10: Diagnostics panel buttons\n    document.getElementById(\"diagnosticsBtn\")?.addEventListener(\"click\", toggleDiagnosticsPanel);\n    document.getElementById(\"clearLogsBtn\")?.addEventListener(\"click\", () => {\n        clearLogs();\n        updateDiagnosticsPanel();\n        toast(\"Logs cleared\");\n    });\n    document.getElementById(\"toggleDebugBtn\")?.addEventListener(\"click\", () => {\n        const newState = toggleDebugMode();\n        toast(newState ? \"Debug mode enabled\" : \"Debug mode disabled\");\n        updateDebugModeCheckbox();\n    });\n    document.getElementById(\"debugModeCheckbox\")?.addEventListener(\"change\", (e) => {\n        if (e.target.checked) {\n            toggleDebugMode();\n        } else {\n            toggleDebugMode();\n        }\n    });\n    \n    // Update buttons\n    document.getElementById(\"checkUpdateBtn\")?.addEventListener(\"click\", checkForUpdatesInSettings);\n    document.getElementById(\"updateNowBtn\")?.addEventListener(\"click\", performUpdate);\n    \n    // Update current version text when settings opens\n    document.getElementById(\"settingsBtn\")?.addEventListener(\"click\", () => {\n        const versionText = document.getElementById(\"currentVersionText\");\n        if (versionText) versionText.textContent = `v${VERSION}`;\n    });\n    \n    // Theme toggle\n    document.getElementById(\"themeBtn\")?.addEventListener(\"click\", toggleTheme);\n    \n    // Mode switch buttons\n    document.getElementById(\"editModeBtn\")?.addEventListener(\"click\", () => setMode(\"edit\"));\n    document.getElementById(\"readOnlyModeBtn\")?.addEventListener(\"click\", () => setMode(\"readonly\"));\n    \n    // Keyboard shortcuts\n    document.addEventListener(\"keydown\", handleKeyboardShortcuts);\n    \n    document.querySelectorAll(\"[data-prompt]\").forEach(el => {\n        el.addEventListener(\"click\", () => {\n            document.getElementById(\"promptInput\").value = el.dataset.prompt;\n            document.getElementById(\"sendBtn\").disabled = false;\n            handleSend();\n        });\n    });\n    \n    document.getElementById(\"togglePwd\")?.addEventListener(\"click\", () => {\n        const inp = document.getElementById(\"apiKeyInput\");\n        inp.type = inp.type === \"password\" ? \"text\" : \"password\";\n    });\n    \n    setupSelectionListener();\n}\n\nfunction closeModal() {\n    document.getElementById(\"modal\").classList.remove(\"open\");\n}\n\nasync function setupSelectionListener() {\n    try {\n        // Remove existing handler if any (Comment 6)\n        if (state.selectionHandler) {\n            await removeSelectionListener(state.selectionHandler);\n            state.selectionHandler = null;\n        }\n        \n        await Excel.run(async (ctx) => {\n            const worksheet = ctx.workbook.worksheets.getActiveWorksheet();\n            state.selectionHandler = worksheet.onSelectionChanged.add(readExcelData);\n            await ctx.sync();\n            logDebug(\"Selection listener attached\");\n        });\n    } catch (e) {\n        // Log warning instead of silently ignoring (Comment 1)\n        console.warn(\"Could not attach selection listener:\", e);\n        logWarn(`Selection listener failed: ${e.message}`);\n        toast(\"Selection auto-refresh unavailable\");\n    }\n}\n\n/**\n * Re-attaches selection listener (called when worksheet scope changes)\n */\nasync function reattachSelectionListener() {\n    await setupSelectionListener();\n}\n\n// ============================================================================\n// Read Excel Data with Column Headers\n// Note: colIndexToLetter and colLetterToIndex are imported from excel-data.js\n// ============================================================================\nasync function readExcelData() {\n    const infoEl = document.getElementById(\"contextInfo\");\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheets = ctx.workbook.worksheets;\n            sheets.load(\"items\");\n            await ctx.sync();\n            \n            // Read sheets based on scope setting\n            const allSheetsData = [];\n            const shouldReadAllSheets = state.worksheetScope === \"all\";\n            \n            // Get active sheet first\n            const activeSheet = ctx.workbook.worksheets.getActiveWorksheet();\n            activeSheet.load(\"name\");\n            await ctx.sync();\n            \n            const activeSheetName = activeSheet.name;\n            \n            // Determine which sheets to read\n            const sheetsToRead = shouldReadAllSheets \n                ? sheets.items.slice(0, 10) // All sheets (max 10)\n                : [sheets.items.find(s => s.name === activeSheetName) || sheets.items[0]]; // Just active sheet\n            \n            for (const sheet of sheetsToRead) {\n                try {\n                    const usedRange = sheet.getUsedRange();\n                    sheet.load(\"name\");\n                    usedRange.load([\"address\", \"values\", \"rowCount\", \"columnCount\", \"columnIndex\", \"rowIndex\"]);\n                    await ctx.sync();\n                    \n                    const sheetName = sheet.name;\n                    const values = usedRange.values;\n                    const startCol = usedRange.columnIndex;\n                    const startRow = usedRange.rowIndex;\n                    const rowCount = usedRange.rowCount;\n                    const colCount = usedRange.columnCount;\n                    \n                    // Comment 2: Handle empty sheets\n                    if (rowCount === 0 || !values || values.length === 0) {\n                        logDebug(`Sheet \"${sheetName}\" has no data, skipping`);\n                        continue;\n                    }\n                    \n                    // Comment 2: Guard for empty values array before reading headers\n                    if (values.length === 0) {\n                        logDebug(`Sheet \"${sheetName}\" has empty values array, skipping`);\n                        continue;\n                    }\n                    \n                    // Detect headers (first row) with validation (Comment 2)\n                    const headers = values[0] || [];\n                    const headerValidation = validateHeaders(headers);\n                    \n                    // Build column mapping with validated headers\n                    const columnMap = [];\n                    for (let c = 0; c < colCount; c++) {\n                        const colLetter = colIndexToLetter(startCol + c);\n                        let headerName;\n                        if (headerValidation.isValid && headers[c]) {\n                            headerName = headers[c];\n                        } else {\n                            // Use generic column names if headers don't look valid\n                            headerName = `Column ${colLetter}`;\n                        }\n                        columnMap.push({\n                            letter: colLetter,\n                            index: c,\n                            header: headerName\n                        });\n                    }\n                    \n                    allSheetsData.push({\n                        sheetName,\n                        address: usedRange.address,\n                        values,\n                        headers: headerValidation.isValid ? headers : columnMap.map(c => c.header),\n                        columnMap,\n                        startRow: startRow + 1,\n                        startCol: colIndexToLetter(startCol),\n                        rowCount,\n                        colCount,\n                        dataStartRow: startRow + 2,\n                        headerValidation\n                    });\n                } catch (e) {\n                    // Sheet might be empty, log and skip it (Comment 1)\n                    const sheetName = sheet.name || \"Unknown\";\n                    console.warn(`Skipping sheet ${sheetName}:`, e);\n                    logWarn(`Failed to read sheet \"${sheetName}\": ${e.message}`);\n                }\n            }\n            \n            // Comment 2: Handle case where no sheets have usable data\n            if (allSheetsData.length === 0) {\n                state.currentData = null;\n                state.allSheetsData = [];\n                infoEl.textContent = \"No usable data found in any sheet\";\n                logWarn(\"No usable data found in any sheet\");\n                return;\n            }\n            \n            // Set current data to active sheet\n            const activeSheetData = allSheetsData.find(s => s.sheetName === activeSheetName);\n            state.currentData = activeSheetData || allSheetsData[0] || null;\n            state.allSheetsData = shouldReadAllSheets ? allSheetsData : [];\n            \n            if (state.currentData) {\n                const scopeText = shouldReadAllSheets ? ` (${allSheetsData.length} sheets)` : \"\";\n                infoEl.textContent = `${state.currentData.sheetName}: ${state.currentData.rowCount} rows  ${state.currentData.colCount} cols${scopeText}`;\n            } else {\n                infoEl.textContent = \"No data\";\n            }\n        });\n    } catch (e) {\n        // Comment 1: Log actual error and show meaningful message\n        console.error(\"Failed to read Excel data:\", e);\n        const errorReason = e.message || \"Unknown error\";\n        infoEl.textContent = `Failed to read data: ${errorReason.substring(0, 50)}`;\n        state.currentData = null;\n        state.allSheetsData = [];\n        logError(`readExcelData error: ${errorReason}`);\n    }\n}\n\n// ============================================================================\n// Chat UI\n// ============================================================================\nfunction showChat() {\n    if (state.isFirstMessage) {\n        document.getElementById(\"welcome\").style.display = \"none\";\n        document.getElementById(\"chat\").style.display = \"flex\";\n        state.isFirstMessage = false;\n    }\n}\n\nfunction addMessage(role, content, type = \"\") {\n    showChat();\n    const chat = document.getElementById(\"chat\");\n    const msg = document.createElement(\"div\");\n    msg.className = `msg ${role} ${type}`;\n    msg.innerHTML = `\n        <div class=\"msg-avatar\">${role === \"user\" ? \"U\" : \"AI\"}</div>\n        <div class=\"msg-body\">${formatText(content)}</div>\n    `;\n    chat.appendChild(msg);\n    \n    // Smooth scroll to bottom\n    setTimeout(() => {\n        chat.scrollTo({\n            top: chat.scrollHeight,\n            behavior: 'smooth'\n        });\n    }, 100);\n}\n\nfunction formatText(text) {\n    return text\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/```(\\w*)\\n?([\\s\\S]*?)```/g, '<pre>$2</pre>')\n        .replace(/`([^`]+)`/g, '<code>$1</code>')\n        .replace(/\\*\\*([^*]+)\\*\\*/g, '<b>$1</b>')\n        .replace(/\\n/g, '<br>');\n}\n\nfunction showTyping() {\n    showChat();\n    const chat = document.getElementById(\"chat\");\n    const el = document.createElement(\"div\");\n    el.className = \"msg ai\";\n    el.id = \"typing\";\n    el.innerHTML = `<div class=\"msg-avatar\">AI</div><div class=\"msg-body\"><span class=\"dot\"></span><span class=\"dot\"></span><span class=\"dot\"></span></div>`;\n    chat.appendChild(el);\n    chat.scrollTop = chat.scrollHeight;\n}\n\nfunction hideTyping() {\n    document.getElementById(\"typing\")?.remove();\n}\n\n// ============================================================================\n// Loading Skeleton\n// ============================================================================\n\nfunction showLoadingSkeleton() {\n    showChat();\n    const chat = document.getElementById(\"chat\");\n    const el = document.createElement(\"div\");\n    el.className = \"skeleton-msg\";\n    el.id = \"loading-skeleton\";\n    el.innerHTML = `\n        <div class=\"skeleton skeleton-avatar\"></div>\n        <div class=\"skeleton-content\">\n            <div class=\"skeleton skeleton-line\" style=\"width: 90%\"></div>\n            <div class=\"skeleton skeleton-line\" style=\"width: 75%\"></div>\n            <div class=\"skeleton skeleton-line\" style=\"width: 60%\"></div>\n        </div>\n    `;\n    chat.appendChild(el);\n    chat.scrollTop = chat.scrollHeight;\n}\n\nfunction hideLoadingSkeleton() {\n    document.getElementById(\"loading-skeleton\")?.remove();\n}\n\n// ============================================================================\n// Smart Suggestions\n// ============================================================================\n\nfunction generateSmartSuggestions() {\n    const suggestions = [];\n    const data = state.currentData;\n    \n    if (!data) return suggestions;\n    \n    // Based on data characteristics\n    if (data.rowCount > 5) {\n        suggestions.push({ icon: '', text: 'Summarize this data', prompt: 'Summarize this data and give me key statistics' });\n    }\n    \n    // Check for numeric columns\n    const hasNumbers = data.values.some(row => row.some(cell => typeof cell === 'number'));\n    if (hasNumbers) {\n        suggestions.push({ icon: '', text: 'Add totals', prompt: 'Add SUM formulas for all numeric columns' });\n        suggestions.push({ icon: '', text: 'Create chart', prompt: 'Create a chart to visualize this data' });\n    }\n    \n    // Check for potential duplicates\n    if (data.rowCount > 10) {\n        suggestions.push({ icon: '', text: 'Find duplicates', prompt: 'Check for duplicate values in this data' });\n    }\n    \n    // Check column headers for common patterns\n    const headers = data.headers.map(h => String(h).toLowerCase());\n    if (headers.some(h => h.includes('date') || h.includes('time'))) {\n        suggestions.push({ icon: '', text: 'Sort by date', prompt: 'Sort this data by date column' });\n    }\n    if (headers.some(h => h.includes('price') || h.includes('amount') || h.includes('cost'))) {\n        suggestions.push({ icon: '', text: 'Calculate totals', prompt: 'Calculate the total of all monetary values' });\n    }\n    if (headers.some(h => h.includes('email'))) {\n        suggestions.push({ icon: '', text: 'Validate emails', prompt: 'Check if all email addresses are valid' });\n    }\n    \n    return suggestions.slice(0, 4); // Max 4 suggestions\n}\n\nfunction showSmartSuggestions() {\n    const container = document.getElementById(\"smartSuggestions\");\n    if (!container) return;\n    \n    const suggestions = generateSmartSuggestions();\n    \n    if (suggestions.length === 0) {\n        container.style.display = \"none\";\n        return;\n    }\n    \n    container.innerHTML = suggestions.map(s => `\n        <button class=\"smart-suggestion\" data-prompt=\"${s.prompt}\">\n            <span>${s.icon}</span> ${s.text}\n        </button>\n    `).join('');\n    \n    container.style.display = \"flex\";\n    \n    // Bind click events\n    container.querySelectorAll(\".smart-suggestion\").forEach(btn => {\n        btn.addEventListener(\"click\", () => {\n            document.getElementById(\"promptInput\").value = btn.dataset.prompt;\n            document.getElementById(\"sendBtn\").disabled = false;\n            container.style.display = \"none\";\n            handleSend();\n        });\n    });\n}\n\nfunction hideSmartSuggestions() {\n    const container = document.getElementById(\"smartSuggestions\");\n    if (container) container.style.display = \"none\";\n}\n\n// ============================================================================\n// Formula Explanation\n// ============================================================================\n\nfunction explainFormula(formula) {\n    const explanations = {\n        'SUM': 'Adds all numbers in a range',\n        'AVERAGE': 'Calculates the average of numbers',\n        'COUNT': 'Counts cells with numbers',\n        'COUNTA': 'Counts non-empty cells',\n        'MAX': 'Returns the largest value',\n        'MIN': 'Returns the smallest value',\n        'IF': 'Returns one value if true, another if false',\n        'VLOOKUP': 'Looks up a value in the first column and returns a value in the same row',\n        'XLOOKUP': 'Searches a range and returns a matching item',\n        'INDEX': 'Returns a value at a given position',\n        'MATCH': 'Returns the position of a value in a range',\n        'CONCATENATE': 'Joins text strings together',\n        'LEFT': 'Returns characters from the start of text',\n        'RIGHT': 'Returns characters from the end of text',\n        'MID': 'Returns characters from the middle of text',\n        'LEN': 'Returns the length of text',\n        'TRIM': 'Removes extra spaces from text',\n        'UPPER': 'Converts text to uppercase',\n        'LOWER': 'Converts text to lowercase',\n        'ROUND': 'Rounds a number to specified digits',\n        'SUMIF': 'Adds cells that meet a condition',\n        'COUNTIF': 'Counts cells that meet a condition',\n        'IFERROR': 'Returns a value if there is an error',\n        'TODAY': 'Returns the current date',\n        'NOW': 'Returns the current date and time',\n        'YEAR': 'Returns the year from a date',\n        'MONTH': 'Returns the month from a date',\n        'DAY': 'Returns the day from a date'\n    };\n    \n    // Extract function name from formula\n    const match = formula.match(/=?([A-Z]+)\\(/i);\n    if (match) {\n        const funcName = match[1].toUpperCase();\n        return explanations[funcName] || `${funcName} function`;\n    }\n    return 'Excel formula';\n}\n\nfunction clearChat() {\n    state.conversationHistory = [];\n    state.pendingActions = [];\n    state.isFirstMessage = true;\n    state.lastAIResponse = \"\";\n    state.currentTaskType = null;\n    state.preview.selections = [];\n    state.preview.expandedIndex = -1;\n    document.getElementById(\"chat\").innerHTML = \"\";\n    document.getElementById(\"chat\").style.display = \"none\";\n    document.getElementById(\"welcome\").style.display = \"flex\";\n    document.getElementById(\"applyBtn\").disabled = true;\n    hidePreviewPanel();\n    hideTaskTypeIndicator();\n    toast(\"Cleared\");\n}\n\n/**\n * Clears learned corrections (accessible via settings or command)\n */\nfunction clearLearnedCorrections() {\n    clearCorrections();\n    toast(\"Learned preferences cleared\");\n}\n\nfunction toast(msg) {\n    const t = document.getElementById(\"toast\");\n    t.textContent = msg;\n    t.classList.add(\"show\");\n    setTimeout(() => t.classList.remove(\"show\"), 2000);\n}\n\n/**\n * Checks for updates by fetching the deployed version\n */\nasync function checkForUpdates() {\n    const versionBadge = document.getElementById(\"versionBadge\");\n    const originalText = versionBadge.textContent;\n    \n    try {\n        versionBadge.textContent = \"Checking...\";\n        \n        // Fetch the deployed taskpane.js with cache-busting\n        const response = await fetch(`https://tankuday21.github.io/GeminiForExcel/taskpane.js?t=${Date.now()}`);\n        const code = await response.text();\n        \n        // Extract version from the deployed code (handles both minified pe=\"x.x.x\" and source const VERSION = \"x.x.x\")\n        const versionMatch = code.match(/(?:pe=\"|const VERSION\\s*=\\s*\")(\\d+\\.\\d+\\.\\d+)\"/);\n        \n        if (versionMatch) {\n            const deployedVersion = versionMatch[1];\n            const currentVersion = VERSION;\n            \n            if (deployedVersion === currentVersion) {\n                toast(\" You're on the latest version!\");\n                versionBadge.textContent = originalText;\n            } else {\n                toast(`Update available: v${deployedVersion}`);\n                versionBadge.textContent = `v${currentVersion}  v${deployedVersion}`;\n                versionBadge.style.color = \"#ff9800\";\n                \n                // Reset after 5 seconds\n                setTimeout(() => {\n                    versionBadge.textContent = originalText;\n                    versionBadge.style.color = \"\";\n                }, 5000);\n            }\n        } else {\n            throw new Error(\"Could not parse version\");\n        }\n    } catch (error) {\n        console.error(\"Update check failed:\", error);\n        toast(\"Failed to check for updates\");\n        versionBadge.textContent = originalText;\n    }\n}\n\n// Store latest available version for update\nlet latestAvailableVersion = null;\n\n/**\n * Checks for updates from the settings modal\n */\nasync function checkForUpdatesInSettings() {\n    const checkBtn = document.getElementById(\"checkUpdateBtn\");\n    const updateBtn = document.getElementById(\"updateNowBtn\");\n    const statusEl = document.getElementById(\"updateStatus\");\n    \n    const originalBtnText = checkBtn.innerHTML;\n    \n    try {\n        checkBtn.innerHTML = `<svg class=\"spin\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"14\" height=\"14\"><path d=\"M21 12a9 9 0 11-6.219-8.56\"/></svg> Checking...`;\n        checkBtn.disabled = true;\n        statusEl.className = \"hint update-checking\";\n        statusEl.textContent = \"Checking for updates...\";\n        \n        // Fetch the deployed taskpane.js with cache-busting\n        const response = await fetch(`https://tankuday21.github.io/GeminiForExcel/taskpane.js?t=${Date.now()}`);\n        const code = await response.text();\n        \n        // Extract version from the deployed code (handles both minified pe=\"x.x.x\" and source const VERSION = \"x.x.x\")\n        const versionMatch = code.match(/(?:pe=\"|const VERSION\\s*=\\s*\")(\\d+\\.\\d+\\.\\d+)\"/);\n        \n        if (versionMatch) {\n            const deployedVersion = versionMatch[1];\n            const currentVersion = VERSION;\n            \n            if (deployedVersion === currentVersion) {\n                statusEl.className = \"hint\";\n                statusEl.innerHTML = ` You're on the latest version (<strong>v${currentVersion}</strong>)`;\n                updateBtn.style.display = \"none\";\n                latestAvailableVersion = null;\n                toast(\"You're up to date!\");\n            } else {\n                latestAvailableVersion = deployedVersion;\n                statusEl.className = \"hint update-available\";\n                statusEl.innerHTML = `Update available! <strong>v${currentVersion}</strong>  <strong>v${deployedVersion}</strong>`;\n                updateBtn.style.display = \"inline-flex\";\n                toast(`Update available: v${deployedVersion}`);\n                logInfo(`Update available: ${currentVersion} -> ${deployedVersion}`);\n            }\n        } else {\n            throw new Error(\"Could not parse version\");\n        }\n    } catch (error) {\n        console.error(\"Update check failed:\", error);\n        statusEl.className = \"hint\";\n        statusEl.textContent = `Failed to check for updates. Current: v${VERSION}`;\n        updateBtn.style.display = \"none\";\n        toast(\"Update check failed\");\n        logError(`Update check failed: ${error.message}`);\n    } finally {\n        checkBtn.innerHTML = originalBtnText;\n        checkBtn.disabled = false;\n    }\n}\n\n/**\n * Performs the update by reloading the add-in\n */\nasync function performUpdate() {\n    const updateBtn = document.getElementById(\"updateNowBtn\");\n    const statusEl = document.getElementById(\"updateStatus\");\n    \n    updateBtn.innerHTML = `<svg class=\"spin\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"14\" height=\"14\"><path d=\"M21 12a9 9 0 11-6.219-8.56\"/></svg> Updating...`;\n    updateBtn.disabled = true;\n    \n    try {\n        // Clear Office cache if possible\n        statusEl.textContent = \"Clearing cache and reloading...\";\n        \n        // Log the update attempt\n        logInfo(`Updating to v${latestAvailableVersion}`);\n        \n        // Clear any cached data\n        if ('caches' in window) {\n            const cacheNames = await caches.keys();\n            await Promise.all(cacheNames.map(name => caches.delete(name)));\n        }\n        \n        // Force reload the page to get the latest version\n        // The add-in will reload from the server with the new version\n        toast(\"Reloading add-in...\");\n        \n        // Small delay to show the toast\n        setTimeout(() => {\n            window.location.reload(true);\n        }, 500);\n        \n    } catch (error) {\n        console.error(\"Update failed:\", error);\n        statusEl.textContent = `Update failed: ${error.message}`;\n        updateBtn.innerHTML = `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" width=\"14\" height=\"14\"><path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\"/></svg> Retry Update`;\n        updateBtn.disabled = false;\n        toast(\"Update failed\");\n        logError(`Update failed: ${error.message}`);\n    }\n}\n\n// ============================================================================\n// AI Communication\n// ============================================================================\nasync function handleSend() {\n    const input = document.getElementById(\"promptInput\");\n    const prompt = input.value.trim();\n    if (!prompt) return;\n    \n    if (!state.apiKey) {\n        document.getElementById(\"settingsBtn\").click();\n        toast(\"Enter API key\");\n        return;\n    }\n    \n    // Comment 1: Separate readExcelData from AI call with specific error handling\n    try {\n        await readExcelData();\n    } catch (dataError) {\n        console.error(\"Failed to read Excel data:\", dataError);\n        logError(`Data read failed: ${dataError.message}`);\n        addMessage(\"ai\", \"Could not load Excel data. Please ensure the workbook is open and the sheet has a used range.\", \"error\");\n        toast(\"Data read failed\");\n        return; // Short-circuit before AI call\n    }\n    \n    // Check if we have data to work with\n    if (!state.currentData) {\n        addMessage(\"ai\", \"No Excel data available. Please ensure your workbook has data in the active sheet.\", \"error\");\n        return;\n    }\n    \n    // Clear conversation history in read-only mode to ensure fresh data context\n    if (state.mode === \"readonly\") {\n        state.conversationHistory = [];\n    }\n    \n    // Detect task type and show indicator\n    const taskType = detectTaskType(prompt);\n    const isCorrectionMsg = isCorrection(prompt);\n    \n    // Add user message with task type badge\n    addMessage(\"user\", prompt, isCorrectionMsg ? \"correction\" : \"\");\n    \n    // Show task type indicator\n    if (!isCorrectionMsg) {\n        showTaskTypeIndicator(taskType);\n    }\n    \n    input.value = \"\";\n    input.style.height = \"auto\";\n    document.getElementById(\"sendBtn\").disabled = true;\n    \n    showTyping();\n    showLoadingSkeleton();\n    \n    try {\n        const response = await callAI(prompt);\n        hideTyping();\n        hideLoadingSkeleton();\n        hideTaskTypeIndicator();\n        \n        // In read-only mode, don't parse actions - just show the response\n        let { message, actions } = parseResponse(response);\n        \n        if (state.mode === \"readonly\") {\n            // Strip out ACTION tags in read-only mode\n            actions = [];\n            message = response.replace(/<ACTION[\\s\\S]*?<\\/ACTION>/g, \"\").trim();\n        }\n        \n        state.pendingActions = actions;\n        \n        // Add task type badge to AI response\n        const taskBadge = getTaskTypeBadge(state.currentTaskType);\n        const enhancedMessage = taskBadge + message;\n        \n        addMessage(\"ai\", enhancedMessage, actions.length ? \"has-action\" : \"\");\n        \n        if (actions.length) {\n            // Initialize preview state and show preview panel\n            state.preview.selections = actions.map(() => true);\n            state.preview.expandedIndex = -1;\n            showPreviewPanel();\n        } else {\n            hidePreviewPanel();\n        }\n        \n        state.conversationHistory.push(\n            { role: \"user\", parts: [{ text: prompt }] },\n            { role: \"model\", parts: [{ text: response }] }\n        );\n        \n        if (state.conversationHistory.length > CONFIG.MAX_HISTORY * 2) {\n            state.conversationHistory = state.conversationHistory.slice(-CONFIG.MAX_HISTORY * 2);\n        }\n    } catch (err) {\n        hideTyping();\n        hideLoadingSkeleton();\n        hideTaskTypeIndicator();\n        addMessage(\"ai\", getErrorMessage(err), \"error\");\n    }\n}\n\n/**\n * Shows task type indicator during processing\n */\nfunction showTaskTypeIndicator(taskType) {\n    const labels = {\n        [TASK_TYPES.FORMULA]: \" Formula Mode\",\n        [TASK_TYPES.CHART]: \" Chart Mode\",\n        [TASK_TYPES.ANALYSIS]: \" Analysis Mode\",\n        [TASK_TYPES.FORMAT]: \" Format Mode\",\n        [TASK_TYPES.DATA_ENTRY]: \" Data Entry Mode\",\n        [TASK_TYPES.VALIDATION]: \" Validation Mode\",\n        [TASK_TYPES.GENERAL]: \" General Mode\"\n    };\n    \n    const indicator = document.getElementById(\"taskTypeIndicator\");\n    if (indicator) {\n        indicator.textContent = labels[taskType] || labels[TASK_TYPES.GENERAL];\n        indicator.className = `task-indicator ${taskType}`;\n        indicator.style.display = \"block\";\n    }\n}\n\n/**\n * Hides task type indicator\n */\nfunction hideTaskTypeIndicator() {\n    const indicator = document.getElementById(\"taskTypeIndicator\");\n    if (indicator) {\n        indicator.style.display = \"none\";\n    }\n}\n\n/**\n * Gets a badge string for the task type\n */\nfunction getTaskTypeBadge(taskType) {\n    const badges = {\n        [TASK_TYPES.FORMULA]: \"**[Formula]** \",\n        [TASK_TYPES.CHART]: \"**[Chart]** \",\n        [TASK_TYPES.ANALYSIS]: \"**[Analysis]** \",\n        [TASK_TYPES.FORMAT]: \"**[Format]** \",\n        [TASK_TYPES.DATA_ENTRY]: \"**[Data]** \",\n        [TASK_TYPES.VALIDATION]: \"**[Validation]** \",\n        [TASK_TYPES.GENERAL]: \"\"\n    };\n    return badges[taskType] || \"\";\n}\n\nasync function callAI(userPrompt) {\n    const dataContext = buildDataContext();\n    \n    // Use AI engine to enhance the prompt with task-specific context\n    const enhanced = enhancePrompt(userPrompt, state.currentData);\n    state.currentTaskType = enhanced.taskType;\n    \n    // Handle corrections - learn from user feedback\n    if (enhanced.isCorrection && state.lastAIResponse) {\n        handleCorrection(userPrompt, state.lastAIResponse);\n    }\n    \n    // Build the enhanced system prompt - modify for read-only mode\n    let systemPrompt = enhanced.systemPrompt;\n    \n    if (state.mode === \"readonly\") {\n        systemPrompt = getReadOnlySystemPrompt();\n    }\n    \n    // Build the enhanced user message\n    const fullUserMessage = `${dataContext}\\n\\n---\\nUSER REQUEST: ${enhanced.userPrompt}`;\n    \n    const contents = [...state.conversationHistory];\n    contents.push({ role: \"user\", parts: [{ text: fullUserMessage }] });\n    \n    // Use retry logic for transient errors\n    const response = await withRetry(async () => {\n        const res = await fetch(\n            `${CONFIG.API_ENDPOINT}${CONFIG.GEMINI_MODEL}:generateContent?key=${state.apiKey}`,\n            {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({\n                    systemInstruction: { parts: [{ text: systemPrompt }] },\n                    contents,\n                    generationConfig: { temperature: 0.1, maxOutputTokens: 4096 }\n                })\n            }\n        );\n        \n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\n        \n        const data = await res.json();\n        \n        // Comment 5: Use robust response extraction\n        const extracted = extractResponseText(data);\n        \n        if (extracted.error) {\n            logWarn(`AI response issue: ${extracted.error}`);\n            if (extracted.blocked) {\n                throw new Error(extracted.error);\n            }\n            // Show toast for empty responses\n            toast(extracted.error);\n            return extracted.error;\n        }\n        \n        if (!extracted.text) {\n            logWarn(\"AI returned no content\");\n            toast(\"AI returned no content\");\n            return \"No response from AI\";\n        }\n        \n        return extracted.text;\n    });\n    \n    // Store response for potential correction learning\n    state.lastAIResponse = response;\n    \n    // Process response for any function calls\n    const processed = processResponse(response);\n    \n    return processed.response;\n}\n\n/**\n * Gets the system prompt for read-only mode\n * In this mode, AI analyzes data and gives direct answers without formulas/actions\n */\nfunction getReadOnlySystemPrompt() {\n    return `You are Excel Copilot in READ-ONLY mode. You are a data analyst assistant.\n\n## YOUR ROLE\n- Analyze the Excel data provided and give DIRECT ANSWERS\n- Do NOT provide formulas or ACTION tags\n- Do NOT suggest modifications to the spreadsheet\n- Calculate and compute answers yourself from the data provided\n- Give clear, concise answers with the actual values/numbers\n\n## CRITICAL ACCURACY RULES\n1. **COUNT CAREFULLY**: When counting occurrences, examine EVERY cell in the data preview\n2. **CASE SENSITIVITY**: \"d\" and \"D\" are different - count only exact matches unless told otherwise\n3. **EMPTY CELLS**: Ignore empty/null cells in counts\n4. **VERIFY YOUR COUNT**: Double-check your answer before responding\n5. **BE PRECISE**: If you count 5 occurrences, say exactly 5, not approximately\n\n## EXAMPLES\n- \"How many times does 'd' appear?\"  Examine each cell, count lowercase 'd' only  \"There are exactly 5 occurrences of 'd'\"\n- \"What is the total of column B?\"  Add all numbers in column B  \"The total is 1,234\"\n- \"How many rows have value X?\"  Count rows where value equals X  \"There are 15 rows with value X\"\n\n## IMPORTANT\n- You have access to ALL the data in the DATA PREVIEW section\n- Count EVERY occurrence manually from the data shown\n- Be EXACT with your counts - accuracy is critical\n- Do NOT use ACTION tags - just provide text answers`;\n}\n\nfunction buildDataContext() {\n    if (!state.currentData) {\n        return \"ERROR: No Excel data available.\";\n    }\n    \n    const { sheetName, values, columnMap, rowCount, colCount, dataStartRow, address } = state.currentData;\n    \n    let context = `## EXCEL WORKBOOK DATA\\n\\n`;\n    \n    // List all sheets in workbook\n    if (state.allSheetsData && state.allSheetsData.length > 1) {\n        context += `**Available Sheets:** ${state.allSheetsData.map(s => s.sheetName).join(\", \")}\\n`;\n        context += `**Active Sheet:** ${sheetName}\\n\\n`;\n    } else {\n        context += `**Sheet:** ${sheetName}\\n`;\n    }\n    \n    context += `**Data Range:** ${address}\\n`;\n    context += `**Total Rows:** ${rowCount} (including header)\\n`;\n    context += `**Total Columns:** ${colCount}\\n\\n`;\n    \n    // Column structure - CRITICAL for AI to understand\n    context += `## COLUMN STRUCTURE\\n`;\n    context += `| Column Letter | Header Name | Sample Values |\\n`;\n    context += `|---------------|-------------|---------------|\\n`;\n    \n    for (const col of columnMap) {\n        // Get sample values from first few data rows\n        const samples = [];\n        for (let r = 1; r < Math.min(4, values.length); r++) {\n            const val = values[r]?.[col.index];\n            if (val !== null && val !== undefined && val !== \"\") {\n                samples.push(String(val).substring(0, 20));\n            }\n        }\n        context += `| ${col.letter} | ${col.header} | ${samples.join(\", \")} |\\n`;\n    }\n    \n    context += `\\n## DATA PREVIEW (First 30 rows)\\n\\n`;\n    \n    // Header row\n    context += `| Row |`;\n    for (const col of columnMap) {\n        context += ` ${col.letter}: ${col.header} |`;\n    }\n    context += `\\n|-----|`;\n    for (let c = 0; c < colCount; c++) {\n        context += `------------|`;\n    }\n    context += `\\n`;\n    \n    // Data rows\n    const maxRows = Math.min(30, values.length);\n    for (let r = 0; r < maxRows; r++) {\n        const rowNum = state.currentData.startRow + r;\n        context += `| ${rowNum} |`;\n        for (let c = 0; c < colCount; c++) {\n            let val = values[r]?.[c];\n            if (val === null || val === undefined) val = \"\";\n            val = String(val).substring(0, 25);\n            context += ` ${val} |`;\n        }\n        context += `\\n`;\n    }\n    \n    if (rowCount > 30) {\n        context += `\\n... and ${rowCount - 30} more rows\\n`;\n    }\n    \n    // Add unique values for key columns (for dropdowns)\n    context += `\\n## UNIQUE VALUES IN EACH COLUMN (for dropdowns)\\n`;\n    for (const col of columnMap) {\n        const uniqueVals = new Set();\n        for (let r = 1; r < values.length; r++) {\n            const val = values[r]?.[col.index];\n            if (val !== null && val !== undefined && val !== \"\") {\n                uniqueVals.add(val);\n            }\n        }\n        if (uniqueVals.size > 0 && uniqueVals.size <= 50) {\n            context += `**${col.letter} (${col.header}):** ${Array.from(uniqueVals).slice(0, 20).join(\", \")}`;\n            if (uniqueVals.size > 20) context += ` ... (${uniqueVals.size} total)`;\n            context += `\\n`;\n        }\n    }\n    \n    // Add information about other sheets\n    if (state.allSheetsData && state.allSheetsData.length > 1) {\n        context += `\\n## OTHER SHEETS IN WORKBOOK\\n`;\n        for (const sheet of state.allSheetsData) {\n            if (sheet.sheetName === sheetName) continue; // Skip current sheet\n            \n            context += `\\n### ${sheet.sheetName}\\n`;\n            context += `- Columns: ${sheet.headers.join(\", \")}\\n`;\n            context += `- Rows: ${sheet.rowCount}\\n`;\n            \n            // Show first few rows as sample\n            if (sheet.values.length > 1) {\n                context += `- Sample data (first 3 rows):\\n`;\n                for (let r = 0; r < Math.min(3, sheet.values.length); r++) {\n                    const row = sheet.values[r];\n                    context += `  ${r === 0 ? \"Headers\" : `Row ${r}`}: ${row.slice(0, 5).join(\" | \")}\\n`;\n                }\n            }\n        }\n        context += `\\n**Note:** You can reference data from any sheet using sheet name (e.g., DeptManagers!A2:B10)\\n`;\n    }\n    \n    return context;\n}\n\n// Note: getSystemPrompt is now handled by ai-engine.js via enhancePrompt()\n// This function is kept as a fallback but is no longer the primary source\nfunction getSystemPrompt() {\n    return `You are Excel Copilot, an expert Excel assistant.\nCheck COLUMN STRUCTURE first. Data starts at row 2.\nUse ACTION tags for: formula, values, format, chart, validation.`;\n}\n\nfunction parseResponse(text) {\n    const actions = [];\n    const actionRegex = /<ACTION\\s+([^>]*)>([\\s\\S]*?)<\\/ACTION>/g;\n    \n    let match;\n    while ((match = actionRegex.exec(text)) !== null) {\n        const attrs = match[1];\n        const content = match[2].trim();\n        \n        const type = attrs.match(/type=\"([^\"]+)\"/)?.[1] || \"formula\";\n        const target = attrs.match(/target=\"([^\"]+)\"/)?.[1] || \"\";\n        const source = attrs.match(/source=\"([^\"]+)\"/)?.[1] || \"\";\n        const chartType = attrs.match(/chartType=\"([^\"]+)\"/)?.[1] || \"column\";\n        const title = attrs.match(/title=\"([^\"]+)\"/)?.[1] || \"\";\n        const position = attrs.match(/position=\"([^\"]+)\"/)?.[1] || \"H2\";\n        \n        actions.push({ type, target, source, chartType, title, position, data: content });\n    }\n    \n    const message = text.replace(/<ACTION[\\s\\S]*?<\\/ACTION>/g, \"\").trim();\n    return { message: message || \"Ready to apply.\", actions };\n}\n\n// ============================================================================\n// Preview Panel Functions\n// ============================================================================\n\n/**\n * Gets the SVG icon for an action type\n * @param {string} type - Action type\n * @returns {string} SVG icon markup\n */\nfunction getActionIcon(type) {\n    const icons = {\n        formula: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 7h16M4 12h16M4 17h10\"/><text x=\"18\" y=\"18\" font-size=\"8\" fill=\"currentColor\">fx</text></svg>',\n        values: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/><path d=\"M3 9h18M9 21V9\"/></svg>',\n        format: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 20h16M6 16l6-12 6 12M8 12h8\"/></svg>',\n        chart: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M18 20V10M12 20V4M6 20v-6\"/></svg>',\n        validation: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M9 11l3 3L22 4\"/><path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\"/></svg>',\n        sort: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 6h18M3 12h12M3 18h6\"/></svg>',\n        autofill: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 5v14M5 12h14\"/></svg>'\n    };\n    return icons[type] || icons.formula;\n}\n\n/**\n * Gets a summary string for an action\n * @param {Object} action - The action to summarize\n * @returns {string} Human-readable summary\n */\nfunction getActionSummary(action) {\n    const typeLabels = {\n        formula: \"Formula\",\n        values: \"Values\",\n        format: \"Format\",\n        chart: \"Chart\",\n        validation: \"Dropdown\",\n        sort: \"Sort\",\n        autofill: \"Autofill\"\n    };\n    return typeLabels[action.type] || action.type;\n}\n\n/**\n * Gets detailed description for an action\n * @param {Object} action - The action to describe\n * @returns {string} Detailed description\n */\nfunction getActionDetails(action) {\n    switch (action.type) {\n        case \"formula\":\n            return action.data || \"No formula\";\n        case \"values\":\n            try {\n                const vals = JSON.parse(action.data);\n                return JSON.stringify(vals, null, 2);\n            } catch {\n                return action.data || \"No values\";\n            }\n        case \"format\":\n            try {\n                const fmt = JSON.parse(action.data);\n                const parts = [];\n                if (fmt.bold) parts.push(\"Bold\");\n                if (fmt.italic) parts.push(\"Italic\");\n                if (fmt.fill) parts.push(`Fill: ${fmt.fill}`);\n                if (fmt.fontColor) parts.push(`Color: ${fmt.fontColor}`);\n                if (fmt.fontSize) parts.push(`Size: ${fmt.fontSize}`);\n                if (fmt.numberFormat) parts.push(`Format: ${fmt.numberFormat}`);\n                return parts.join(\", \") || \"No formatting\";\n            } catch {\n                return action.data || \"No format data\";\n            }\n        case \"chart\":\n            return `Type: ${action.chartType}\\nData: ${action.target}\\nPosition: ${action.position}${action.title ? `\\nTitle: ${action.title}` : \"\"}`;\n        case \"validation\":\n            return `Source: ${action.source}`;\n        case \"sort\":\n            return action.data || \"Default sort\";\n        case \"autofill\":\n            return `Source: ${action.source}`;\n        default:\n            return action.data || \"No details\";\n    }\n}\n\n/**\n * Filters actions based on selection state\n * @param {Object[]} actions - All pending actions\n * @param {boolean[]} selections - Selection state for each action\n * @returns {Object[]} Only the selected actions\n */\nfunction filterSelectedActions(actions, selections) {\n    if (!actions || !selections) return [];\n    return actions.filter((_, index) => selections[index] === true);\n}\n\n/**\n * Checks if any actions are selected\n * @param {boolean[]} selections - Selection state array\n * @returns {boolean} True if at least one action is selected\n */\nfunction hasSelectedActions(selections) {\n    if (!selections || selections.length === 0) return false;\n    return selections.some(s => s === true);\n}\n\n/**\n * Renders a single preview item HTML\n */\nfunction renderPreviewItemHTML(action, index, isExpanded, isSelected, hasWarning) {\n    const icon = getActionIcon(action.type);\n    const summary = getActionSummary(action);\n    const details = getActionDetails(action);\n    const expandedClass = isExpanded ? 'expanded' : '';\n    const warningClass = hasWarning ? 'warning' : '';\n    \n    return `\n        <div class=\"preview-item ${expandedClass} ${warningClass}\" data-index=\"${index}\">\n            <input type=\"checkbox\" class=\"preview-checkbox\" ${isSelected ? 'checked' : ''} data-index=\"${index}\">\n            <div class=\"preview-icon ${action.type}\">${icon}</div>\n            <div class=\"preview-content\">\n                <div class=\"preview-summary\">\n                    ${summary}\n                    <span class=\"preview-target\">${action.target}</span>\n                    ${hasWarning ? '<svg class=\"preview-warning\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 2L1 21h22L12 2zm0 3.5L19.5 19h-15L12 5.5zM11 10v4h2v-4h-2zm0 6v2h2v-2h-2z\"/></svg>' : ''}\n                </div>\n                <div class=\"preview-details\">${details}</div>\n            </div>\n            <div class=\"preview-expand\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M6 9l6 6 6-6\"/></svg>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Shows the preview panel with pending actions\n */\nfunction showPreviewPanel() {\n    const panel = document.getElementById(\"previewPanel\");\n    const list = document.getElementById(\"previewList\");\n    \n    if (!state.pendingActions.length) {\n        panel.style.display = \"none\";\n        return;\n    }\n    \n    // Initialize selections if needed (all selected by default)\n    if (state.preview.selections.length !== state.pendingActions.length) {\n        state.preview.selections = state.pendingActions.map(() => true);\n    }\n    \n    // Render preview items\n    const html = state.pendingActions.map((action, index) => {\n        const isExpanded = index === state.preview.expandedIndex;\n        const isSelected = state.preview.selections[index];\n        return renderPreviewItemHTML(action, index, isExpanded, isSelected, false);\n    }).join('');\n    \n    list.innerHTML = html;\n    panel.style.display = \"block\";\n    \n    // Bind events\n    bindPreviewEvents();\n    updateApplyButtonState();\n}\n\n/**\n * Hides the preview panel\n */\nfunction hidePreviewPanel() {\n    const panel = document.getElementById(\"previewPanel\");\n    panel.style.display = \"none\";\n    state.preview.selections = [];\n    state.preview.expandedIndex = -1;\n}\n\n/**\n * Binds event handlers to preview panel elements\n */\nfunction bindPreviewEvents() {\n    // Checkbox changes\n    document.querySelectorAll(\".preview-checkbox\").forEach(cb => {\n        cb.addEventListener(\"change\", (e) => {\n            const index = parseInt(e.target.dataset.index);\n            state.preview.selections[index] = e.target.checked;\n            updateApplyButtonState();\n        });\n        // Stop propagation to prevent expand/collapse when clicking checkbox\n        cb.addEventListener(\"click\", (e) => e.stopPropagation());\n    });\n    \n    // Expand/collapse on item click\n    document.querySelectorAll(\".preview-item\").forEach(item => {\n        item.addEventListener(\"click\", (e) => {\n            if (e.target.classList.contains(\"preview-checkbox\")) return;\n            const index = parseInt(item.dataset.index);\n            toggleExpand(index);\n        });\n        \n        // Hover highlighting\n        item.addEventListener(\"mouseenter\", () => {\n            const index = parseInt(item.dataset.index);\n            highlightRange(state.pendingActions[index]?.target);\n        });\n        \n        item.addEventListener(\"mouseleave\", () => {\n            clearHighlight();\n        });\n    });\n    \n    // Select all button\n    document.getElementById(\"selectAllBtn\")?.addEventListener(\"click\", toggleSelectAll);\n}\n\n/**\n * Toggles expand/collapse for a preview item\n */\nfunction toggleExpand(index) {\n    state.preview.expandedIndex = state.preview.expandedIndex === index ? -1 : index;\n    showPreviewPanel(); // Re-render\n}\n\n/**\n * Toggles select all / deselect all\n */\nfunction toggleSelectAll() {\n    const allSelected = state.preview.selections.every(s => s);\n    state.preview.selections = state.preview.selections.map(() => !allSelected);\n    showPreviewPanel(); // Re-render\n}\n\n/**\n * Updates the Apply button state based on selections\n */\nfunction updateApplyButtonState() {\n    const applyBtn = document.getElementById(\"applyBtn\");\n    const hasSelected = hasSelectedActions(state.preview.selections);\n    const isReadOnly = state.mode === \"readonly\";\n    applyBtn.disabled = !hasSelected || isReadOnly;\n    \n    // Update button text to indicate read-only mode\n    if (isReadOnly) {\n        applyBtn.textContent = \"Read-Only Mode\";\n    } else {\n        applyBtn.textContent = \"Apply Changes\";\n    }\n}\n\n/**\n * Highlights a range in Excel\n */\nasync function highlightRange(rangeAddress) {\n    if (!rangeAddress) return;\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheet = ctx.workbook.worksheets.getActiveWorksheet();\n            const range = sheet.getRange(rangeAddress);\n            range.select();\n            await ctx.sync();\n        });\n    } catch (e) {\n        // Silently fail - range might be invalid\n        console.warn(\"Could not highlight range:\", rangeAddress, e);\n    }\n}\n\n/**\n * Clears any active highlighting (no-op for now, selection persists)\n */\nasync function clearHighlight() {\n    // Excel doesn't have a \"clear selection\" API\n    // The selection will change when user interacts with Excel\n}\n\n// ============================================================================\n// Theme Toggle\n// ============================================================================\n\n/**\n * Toggles between light and dark theme\n */\nfunction toggleTheme() {\n    const html = document.documentElement;\n    const currentTheme = html.getAttribute('data-theme');\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n    html.setAttribute('data-theme', newTheme);\n    localStorage.setItem(CONFIG.THEME_KEY, newTheme);\n    toast(newTheme === 'dark' ? 'Dark mode' : 'Light mode');\n}\n\n/**\n * Sets the mode (edit or readonly)\n */\nfunction setMode(mode) {\n    state.mode = mode;\n    localStorage.setItem(\"excel_copilot_mode\", mode);\n    \n    // Update button states\n    const editBtn = document.getElementById(\"editModeBtn\");\n    const readOnlyBtn = document.getElementById(\"readOnlyModeBtn\");\n    \n    if (editBtn && readOnlyBtn) {\n        editBtn.classList.toggle(\"active\", mode === \"edit\");\n        readOnlyBtn.classList.toggle(\"active\", mode === \"readonly\");\n    }\n    \n    // Update apply button\n    updateApplyButtonState();\n    \n    toast(mode === \"edit\" ? \"Edit mode\" : \"Read-only mode\");\n}\n\n/**\n * Initializes mode buttons based on saved state\n */\nfunction initModeButtons() {\n    const editBtn = document.getElementById(\"editModeBtn\");\n    const readOnlyBtn = document.getElementById(\"readOnlyModeBtn\");\n    \n    if (editBtn && readOnlyBtn) {\n        editBtn.classList.toggle(\"active\", state.mode === \"edit\");\n        readOnlyBtn.classList.toggle(\"active\", state.mode === \"readonly\");\n    }\n}\n\n// ============================================================================\n// Keyboard Shortcuts\n// ============================================================================\n\n/**\n * Handles keyboard shortcuts\n */\nfunction handleKeyboardShortcuts(e) {\n    // Ctrl+Enter or Cmd+Enter to send message\n    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\n        const input = document.getElementById(\"promptInput\");\n        if (document.activeElement === input && input.value.trim()) {\n            e.preventDefault();\n            handleSend();\n        }\n    }\n    \n    // Ctrl+Z or Cmd+Z to undo (when not in input)\n    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n        const activeEl = document.activeElement;\n        if (activeEl.tagName !== 'INPUT' && activeEl.tagName !== 'TEXTAREA') {\n            if (state.history.entries.length > 0) {\n                e.preventDefault();\n                performUndo();\n            }\n        }\n    }\n    \n    // Escape to close modal or clear input\n    if (e.key === 'Escape') {\n        const modal = document.getElementById(\"modal\");\n        if (modal.classList.contains('open')) {\n            closeModal();\n        } else {\n            const input = document.getElementById(\"promptInput\");\n            if (input.value) {\n                input.value = '';\n                document.getElementById(\"sendBtn\").disabled = true;\n            }\n        }\n    }\n    \n    // Ctrl+D or Cmd+D to toggle dark mode\n    if ((e.ctrlKey || e.metaKey) && e.key === 'd') {\n        e.preventDefault();\n        toggleTheme();\n    }\n}\n\n// ============================================================================\n// Better Error Handling\n// ============================================================================\n\n/**\n * Validates a range address\n */\nfunction isValidRange(address) {\n    if (!address) return false;\n    // Basic Excel range pattern: A1, A1:B10, Sheet1!A1:B10\n    const pattern = /^([A-Za-z_][A-Za-z0-9_]*!)?(\\$?[A-Z]+\\$?\\d+)(:\\$?[A-Z]+\\$?\\d+)?$/i;\n    return pattern.test(address);\n}\n\n/**\n * Gets a user-friendly error message\n */\nfunction getErrorMessage(error, context = '') {\n    const msg = error.message || String(error);\n    \n    // API errors\n    if (msg.includes('401') || msg.includes('403')) {\n        return 'Invalid API key. Please check your settings.';\n    }\n    if (msg.includes('429')) {\n        return 'Rate limit exceeded. Please wait a moment and try again.';\n    }\n    if (msg.includes('500') || msg.includes('502') || msg.includes('503')) {\n        return 'AI service temporarily unavailable. Retrying...';\n    }\n    if (msg.includes('network') || msg.includes('fetch')) {\n        return 'Network error. Please check your connection.';\n    }\n    \n    // Excel errors\n    if (msg.includes('InvalidReference') || msg.includes('invalid range')) {\n        return `Invalid cell reference${context ? ': ' + context : ''}. Please check the range.`;\n    }\n    if (msg.includes('RichApi')) {\n        return 'Excel error. Please try again.';\n    }\n    \n    // Generic\n    return msg.length > 100 ? msg.substring(0, 100) + '...' : msg;\n}\n\n/**\n * Retries a function with exponential backoff\n */\nasync function withRetry(fn, maxRetries = CONFIG.MAX_RETRIES) {\n    let lastError;\n    for (let i = 0; i < maxRetries; i++) {\n        try {\n            return await fn();\n        } catch (e) {\n            lastError = e;\n            const msg = e.message || '';\n            // Only retry on transient errors\n            if (msg.includes('429') || msg.includes('500') || msg.includes('502') || msg.includes('503')) {\n                const delay = CONFIG.RETRY_DELAY * Math.pow(2, i);\n                await new Promise(r => setTimeout(r, delay));\n                continue;\n            }\n            throw e;\n        }\n    }\n    throw lastError;\n}\n\n// ============================================================================\n// History and Undo Functions\n// ============================================================================\n\n/**\n * Generates a unique ID for history entries\n */\nfunction generateHistoryId() {\n    return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);\n}\n\n/**\n * Captures the current state of a range for undo\n * @param {Excel.RequestContext} ctx - Excel context\n * @param {Excel.Worksheet} sheet - Active worksheet\n * @param {string} rangeAddress - The range to capture\n * @returns {Promise<Object>} The captured undo data\n */\nasync function captureUndoData(ctx, sheet, rangeAddress) {\n    try {\n        const range = sheet.getRange(rangeAddress);\n        range.load([\"values\", \"formulas\", \"address\"]);\n        await ctx.sync();\n        \n        return {\n            values: range.values,\n            formulas: range.formulas,\n            address: range.address\n        };\n    } catch (e) {\n        console.warn(\"Could not capture undo data:\", e);\n        return null;\n    }\n}\n\n/**\n * Adds an action to history\n */\nfunction addActionToHistory(action, undoData) {\n    const entry = {\n        id: generateHistoryId(),\n        type: action.type,\n        target: action.target,\n        timestamp: Date.now(),\n        undoData: undoData\n    };\n    \n    // Prepend to history\n    state.history.entries = [entry, ...state.history.entries];\n    \n    // Enforce max limit\n    if (state.history.entries.length > state.history.maxEntries) {\n        state.history.entries = state.history.entries.slice(0, state.history.maxEntries);\n    }\n    \n    updateUndoButtonState();\n    if (state.history.panelVisible) {\n        renderHistoryPanel();\n    }\n}\n\n/**\n * Performs undo of the most recent action\n */\nasync function performUndo() {\n    if (!state.history.entries.length) {\n        toast(\"Nothing to undo\");\n        return;\n    }\n    \n    const entry = state.history.entries[0];\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheet = ctx.workbook.worksheets.getActiveWorksheet();\n            const range = sheet.getRange(entry.undoData.address);\n            \n            // Restore formulas (which also restores values for non-formula cells)\n            range.formulas = entry.undoData.formulas;\n            await ctx.sync();\n        });\n        \n        // Remove from history\n        state.history.entries = state.history.entries.slice(1);\n        \n        updateUndoButtonState();\n        if (state.history.panelVisible) {\n            renderHistoryPanel();\n        }\n        \n        toast(\"Undone\");\n        await readExcelData();\n    } catch (e) {\n        console.error(\"Undo failed:\", e);\n        toast(\"Undo failed\");\n        // Keep entry in history on failure\n    }\n}\n\n/**\n * Updates the Undo button state\n */\nfunction updateUndoButtonState() {\n    const undoBtn = document.getElementById(\"undoBtn\");\n    if (undoBtn) {\n        undoBtn.disabled = state.history.entries.length === 0;\n    }\n}\n\n/**\n * Formats a timestamp as relative time\n */\nfunction formatRelativeTime(timestamp) {\n    const now = Date.now();\n    const diff = now - timestamp;\n    \n    const seconds = Math.floor(diff / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    \n    if (seconds < 60) return 'just now';\n    if (minutes < 60) return `${minutes} min ago`;\n    if (hours < 24) return `${hours} hr ago`;\n    if (days === 1) return 'yesterday';\n    return `${days} days ago`;\n}\n\n/**\n * Renders the history panel\n */\nfunction renderHistoryPanel() {\n    const list = document.getElementById(\"historyList\");\n    if (!list) return;\n    \n    if (!state.history.entries.length) {\n        list.innerHTML = '<div class=\"history-empty\">No actions yet</div>';\n        return;\n    }\n    \n    const typeLabels = {\n        formula: \"Formula\",\n        values: \"Values\",\n        format: \"Format\",\n        chart: \"Chart\",\n        validation: \"Dropdown\",\n        sort: \"Sort\",\n        autofill: \"Autofill\"\n    };\n    \n    const html = state.history.entries.map(entry => {\n        const icon = getActionIcon(entry.type);\n        const label = typeLabels[entry.type] || entry.type;\n        const timeStr = formatRelativeTime(entry.timestamp);\n        \n        return `\n            <div class=\"history-entry\" data-id=\"${entry.id}\">\n                <div class=\"history-icon ${entry.type}\">${icon}</div>\n                <div class=\"history-content\">\n                    <span class=\"history-label\">${label}</span>\n                    <span class=\"history-target\">${entry.target}</span>\n                </div>\n                <span class=\"history-time\">${timeStr}</span>\n            </div>\n        `;\n    }).join('');\n    \n    list.innerHTML = html;\n}\n\n/**\n * Toggles history panel visibility\n */\nfunction toggleHistoryPanel() {\n    state.history.panelVisible = !state.history.panelVisible;\n    const panel = document.getElementById(\"historyPanel\");\n    const btn = document.getElementById(\"historyBtn\");\n    \n    if (panel) {\n        panel.style.display = state.history.panelVisible ? \"block\" : \"none\";\n        if (state.history.panelVisible) {\n            renderHistoryPanel();\n        }\n    }\n    \n    if (btn) {\n        btn.classList.toggle(\"active\", state.history.panelVisible);\n    }\n}\n\n// ============================================================================\n// Comment 10: Diagnostics Panel Functions\n// ============================================================================\n\n/**\n * Toggles diagnostics panel visibility\n */\nfunction toggleDiagnosticsPanel() {\n    state.diagnosticsPanelVisible = !state.diagnosticsPanelVisible;\n    const panel = document.getElementById(\"diagnosticsPanel\");\n    const btn = document.getElementById(\"diagnosticsBtn\");\n    \n    if (panel) {\n        panel.style.display = state.diagnosticsPanelVisible ? \"block\" : \"none\";\n        if (state.diagnosticsPanelVisible) {\n            updateDiagnosticsPanel();\n        }\n    }\n    \n    if (btn) {\n        btn.classList.toggle(\"active\", state.diagnosticsPanelVisible);\n    }\n}\n\n/**\n * Updates the diagnostics panel content\n */\nfunction updateDiagnosticsPanel() {\n    const list = document.getElementById(\"diagnosticsList\");\n    if (!list) return;\n    \n    const logs = getLogs();\n    list.innerHTML = renderDiagnosticsPanel(logs.slice(0, 50));\n}\n\n/**\n * Updates the debug mode checkbox state\n */\nfunction updateDebugModeCheckbox() {\n    const checkbox = document.getElementById(\"debugModeCheckbox\");\n    if (checkbox) {\n        checkbox.checked = isDebugMode();\n    }\n}\n\n// ============================================================================\n// Apply Actions\n// ============================================================================\nasync function handleApply() {\n    // Check if in read-only mode\n    if (state.mode === \"readonly\") {\n        toast(\"Read-only mode: Cannot apply changes\");\n        return;\n    }\n    \n    // Get only selected actions\n    const selectedActions = filterSelectedActions(state.pendingActions, state.preview.selections);\n    \n    if (!selectedActions.length) {\n        toast(\"Nothing to apply\");\n        return;\n    }\n    \n    const applyBtn = document.getElementById(\"applyBtn\");\n    applyBtn.disabled = true;\n    applyBtn.textContent = \"Applying...\";\n    \n    let successCount = 0;\n    let errorMsg = \"\";\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheet = ctx.workbook.worksheets.getActiveWorksheet();\n            \n            for (const action of selectedActions) {\n                try {\n                    // Capture undo data before applying (skip for charts - can't undo)\n                    let undoData = null;\n                    if (action.type !== 'chart') {\n                        undoData = await captureUndoData(ctx, sheet, action.target);\n                    }\n                    \n                    await executeAction(ctx, sheet, action);\n                    await ctx.sync();\n                    successCount++;\n                    \n                    // Add to history if we have undo data\n                    if (undoData) {\n                        addActionToHistory(action, undoData);\n                    }\n                } catch (e) {\n                    errorMsg = e.message;\n                    console.error(\"Action failed:\", e);\n                }\n            }\n        });\n        \n        if (successCount === selectedActions.length) {\n            addMessage(\"ai\", `${successCount} change${successCount > 1 ? 's' : ''} applied successfully.`, \"success\");\n            toast(\"Applied\");\n        } else if (successCount > 0) {\n            addMessage(\"ai\", `${successCount}/${selectedActions.length} changes applied. Error: ${errorMsg}`, \"error\");\n        } else {\n            addMessage(\"ai\", `Failed: ${errorMsg}`, \"error\");\n        }\n        \n        // Clear pending actions and hide preview\n        state.pendingActions = [];\n        hidePreviewPanel();\n        await readExcelData();\n    } catch (err) {\n        addMessage(\"ai\", \"Failed: \" + err.message, \"error\");\n        toast(\"Failed\");\n    }\n    \n    applyBtn.disabled = true;\n    applyBtn.textContent = \"Apply Changes\";\n}\n\nasync function executeAction(ctx, sheet, action) {\n    const { type, target, source, validationType, chartType, data } = action;\n    \n    // Sheet creation doesn't need a range\n    if (type === \"sheet\") {\n        await createSheet(ctx, target, data);\n        return;\n    }\n    \n    if (!target) throw new Error(\"No target specified\");\n    \n    const range = sheet.getRange(target);\n    range.load([\"rowCount\", \"columnCount\"]);\n    await ctx.sync();\n    \n    switch (type) {\n        case \"formula\":\n            await applyFormula(range, data);\n            break;\n            \n        case \"values\":\n            applyValues(range, data);\n            break;\n            \n        case \"format\":\n            await applyFormat(ctx, range, data);\n            break;\n            \n        case \"conditionalFormat\":\n            await applyConditionalFormat(ctx, range, data);\n            break;\n            \n        case \"clearFormat\":\n            await clearConditionalFormat(ctx, range);\n            break;\n            \n        case \"validation\":\n            await applyValidation(ctx, sheet, range, source);\n            break;\n            \n        case \"chart\":\n            await createChart(ctx, sheet, range, action);\n            break;\n            \n        case \"pivotChart\":\n            await createPivotChart(ctx, sheet, range, action);\n            break;\n            \n        case \"sort\":\n            applySort(range, data);\n            break;\n            \n        case \"autofill\":\n            if (source) {\n                const sourceRange = sheet.getRange(source);\n                sourceRange.autoFill(range, Excel.AutoFillType.fillDefault);\n            }\n            break;\n            \n        case \"copy\":\n            await applyCopy(ctx, sheet, source, target);\n            break;\n            \n        case \"copyValues\":\n            await applyCopyValues(ctx, sheet, source, target);\n            break;\n            \n        case \"sheet\":\n            await createSheet(ctx, target, data);\n            break;\n            \n        case \"filter\":\n            await applyFilter(ctx, sheet, range, data);\n            break;\n            \n        case \"clearFilter\":\n            await clearFilter(ctx, sheet);\n            break;\n            \n        case \"removeDuplicates\":\n            await removeDuplicates(ctx, range, data);\n            break;\n            \n        default:\n            if (data) range.values = [[data]];\n    }\n}\n\n/**\n * Creates a new sheet with optional name\n */\nasync function createSheet(ctx, sheetName, data) {\n    if (!sheetName) {\n        throw new Error(\"Sheet name is required\");\n    }\n    \n    const sheets = ctx.workbook.worksheets;\n    // Use add() with proper parameters - name is optional, position is optional\n    const newSheet = sheets.add();\n    newSheet.name = sheetName;\n    \n    // If data is provided, populate it\n    if (data) {\n        try {\n            const values = JSON.parse(data);\n            if (Array.isArray(values) && values.length > 0) {\n                const range = newSheet.getRange(`A1:${String.fromCharCode(64 + values[0].length)}${values.length}`);\n                range.values = values;\n            }\n        } catch (e) {\n            // Data parsing failed, just create empty sheet\n        }\n    }\n}\n\n/**\n * Copies data from source range to target range\n */\nasync function applyCopy(ctx, sheet, source, target) {\n    if (!source || !target) {\n        throw new Error(\"Copy requires both source and target ranges\");\n    }\n    \n    const sourceRange = sheet.getRange(source);\n    sourceRange.load([\"values\", \"formulas\", \"rowCount\", \"columnCount\"]);\n    await ctx.sync();\n    \n    // Get source dimensions\n    const rowCount = sourceRange.rowCount;\n    const colCount = sourceRange.columnCount;\n    \n    // If target is a single cell, resize it to match source dimensions\n    const targetCell = sheet.getRange(target);\n    const targetRange = targetCell.getResizedRange(rowCount - 1, colCount - 1);\n    \n    // Copy formulas (preserves both formulas and values)\n    targetRange.formulas = sourceRange.formulas;\n}\n\n/**\n * Copies only values (not formulas) from source range to target range\n */\nasync function applyCopyValues(ctx, sheet, source, target) {\n    if (!source || !target) {\n        throw new Error(\"Copy requires both source and target ranges\");\n    }\n    \n    const sourceRange = sheet.getRange(source);\n    sourceRange.load([\"values\", \"rowCount\", \"columnCount\"]);\n    await ctx.sync();\n    \n    // Get source dimensions\n    const rowCount = sourceRange.rowCount;\n    const colCount = sourceRange.columnCount;\n    \n    // Parse target to get the starting cell\n    // If target is already a range (e.g., \"A2:A51\"), extract just the first cell\n    const targetAddress = target.includes(\":\") ? target.split(\":\")[0] : target;\n    \n    // Get the starting cell and resize to match source\n    const targetCell = sheet.getRange(targetAddress);\n    const targetRange = targetCell.getResizedRange(rowCount - 1, colCount - 1);\n    \n    // Copy only values (converts formulas to their results)\n    targetRange.values = sourceRange.values;\n}\n\nasync function applyFormula(range, formula) {\n    const rows = range.rowCount;\n    const cols = range.columnCount;\n    \n    // For single cell, just set the formula\n    if (rows === 1 && cols === 1) {\n        range.formulas = [[formula]];\n        return;\n    }\n    \n    // For multi-row, single-column ranges, use autofill approach\n    if (rows > 1 && cols === 1) {\n        // Set formula in first cell only\n        const firstCell = range.getCell(0, 0);\n        firstCell.formulas = [[formula]];\n        \n        // Try autofill first (most efficient)\n        try {\n            firstCell.autoFill(range, Excel.AutoFillType.fillDefault);\n            return;\n        } catch (autofillError) {\n            // Autofill failed, use manual array method\n            console.warn(\"Autofill failed, using formula array:\", autofillError);\n            \n            // Build formula array manually\n            const formulas = [];\n            for (let r = 0; r < rows; r++) {\n                let f = formula;\n                if (r > 0) {\n                    // Adjust row numbers in cell references (but not absolute references)\n                    f = formula.replace(/(\\$?)([A-Z]+)(\\$?)(\\d+)/g, (match, colAbs, col, rowAbs, row) => {\n                        if (rowAbs === \"$\") return match; // Skip absolute row references\n                        const newRow = parseInt(row) + r;\n                        return `${colAbs}${col}${rowAbs}${newRow}`;\n                    });\n                }\n                formulas.push([f]);\n            }\n            \n            // Apply all formulas at once\n            range.formulas = formulas;\n            return;\n        }\n    }\n    \n    // For single-row, multi-column ranges, build the formula array\n    if (rows === 1 && cols > 1) {\n        const formulas = [[]];\n        for (let c = 0; c < cols; c++) {\n            let f = formula;\n            if (c > 0) {\n                // Comment 3: Use robust base-26 conversion for multi-letter columns\n                f = formula.replace(/(\\$?)([A-Z]+)(\\$?)(\\d+)/g, (match, colAbs, col, rowAbs, row) => {\n                    if (colAbs === \"$\") return match; // Skip absolute column references\n                    // Use colLetterToIndex and colIndexToLetter for multi-letter support\n                    const colIndex = colLetterToIndex(col);\n                    const newCol = colIndexToLetter(colIndex + c);\n                    return `${colAbs}${newCol}${rowAbs}${row}`;\n                });\n            }\n            formulas[0].push(f);\n        }\n        range.formulas = formulas;\n        return;\n    }\n    \n    // For multi-row, multi-column ranges, build 2D formula array\n    if (rows > 1 && cols > 1) {\n        const formulas = [];\n        for (let r = 0; r < rows; r++) {\n            const rowFormulas = [];\n            for (let c = 0; c < cols; c++) {\n                let f = formula;\n                // Adjust both row and column references\n                if (r > 0 || c > 0) {\n                    // Comment 3: Use robust base-26 conversion for multi-letter columns\n                    f = formula.replace(/(\\$?)([A-Z]+)(\\$?)(\\d+)/g, (match, colAbs, col, rowAbs, row) => {\n                        let newCol = col;\n                        let newRow = parseInt(row);\n                        \n                        // Adjust column if not absolute - use robust conversion\n                        if (colAbs !== \"$\" && c > 0) {\n                            const colIndex = colLetterToIndex(col);\n                            newCol = colIndexToLetter(colIndex + c);\n                        }\n                        \n                        // Adjust row if not absolute\n                        if (rowAbs !== \"$\" && r > 0) {\n                            newRow = newRow + r;\n                        }\n                        \n                        return `${colAbs}${newCol}${rowAbs}${newRow}`;\n                    });\n                }\n                rowFormulas.push(f);\n            }\n            formulas.push(rowFormulas);\n        }\n        range.formulas = formulas;\n        return;\n    }\n}\n\nfunction applyValues(range, data) {\n    let values;\n    try {\n        values = JSON.parse(data);\n        if (!Array.isArray(values)) values = [[values]];\n        if (!Array.isArray(values[0])) values = [values];\n    } catch {\n        values = [[data]];\n    }\n    range.values = values;\n}\n\nasync function applyFormat(ctx, range, data) {\n    let fmt;\n    try { fmt = JSON.parse(data); } catch { fmt = {}; }\n    \n    if (fmt.bold) range.format.font.bold = true;\n    if (fmt.italic) range.format.font.italic = true;\n    if (fmt.fill) range.format.fill.color = fmt.fill;\n    if (fmt.fontColor) range.format.font.color = fmt.fontColor;\n    if (fmt.fontSize) range.format.font.size = fmt.fontSize;\n    if (fmt.numberFormat) range.numberFormat = [[fmt.numberFormat]];\n    if (fmt.border) {\n        range.format.borders.getItem(\"EdgeTop\").style = \"Continuous\";\n        range.format.borders.getItem(\"EdgeBottom\").style = \"Continuous\";\n        range.format.borders.getItem(\"EdgeLeft\").style = \"Continuous\";\n        range.format.borders.getItem(\"EdgeRight\").style = \"Continuous\";\n    }\n}\n\n/**\n * Applies conditional formatting to a range\n * Supports multiple rules in a single action\n */\nasync function applyConditionalFormat(ctx, range, data) {\n    let rules;\n    try { \n        const parsed = JSON.parse(data);\n        // Support both single rule and array of rules\n        rules = Array.isArray(parsed) ? parsed : [parsed];\n    } catch { \n        rules = []; \n    }\n    \n    // Clear existing conditional formats only once\n    range.conditionalFormats.clearAll();\n    await ctx.sync();\n    \n    // Add each conditional format rule\n    for (const rule of rules) {\n        if (rule.type === \"cellValue\" && rule.operator && rule.value) {\n            const cf = range.conditionalFormats.add(Excel.ConditionalFormatType.cellValue);\n            cf.cellValue.format.fill.color = rule.fill || \"#FFFF00\";\n            \n            // Handle different operators\n            let operator = rule.operator;\n            if (operator === \"GreaterThan\") operator = Excel.ConditionalCellValueOperator.greaterThan;\n            else if (operator === \"LessThan\") operator = Excel.ConditionalCellValueOperator.lessThan;\n            else if (operator === \"EqualTo\") operator = Excel.ConditionalCellValueOperator.equalTo;\n            else if (operator === \"GreaterThanOrEqual\") operator = Excel.ConditionalCellValueOperator.greaterThanOrEqual;\n            else if (operator === \"LessThanOrEqual\") operator = Excel.ConditionalCellValueOperator.lessThanOrEqual;\n            else if (operator === \"Between\") operator = Excel.ConditionalCellValueOperator.between;\n            \n            cf.cellValue.rule = {\n                formula1: String(rule.value),\n                formula2: rule.value2 ? String(rule.value2) : undefined,\n                operator: operator\n            };\n        }\n    }\n}\n\n/**\n * Clears all conditional formatting from a range\n */\nasync function clearConditionalFormat(ctx, range) {\n    range.conditionalFormats.clearAll();\n    await ctx.sync();\n}\n\nasync function applyValidation(ctx, sheet, range, source) {\n    if (source) {\n        // Clear any existing validation first\n        range.dataValidation.clear();\n        await ctx.sync();\n        \n        // Get the source range to extract unique values\n        const sourceRange = sheet.getRange(source);\n        sourceRange.load(\"values\");\n        await ctx.sync();\n        \n        // Extract unique non-empty values\n        const uniqueValues = [];\n        const seen = new Set();\n        for (const row of sourceRange.values) {\n            const val = row[0];\n            if (val !== null && val !== undefined && val !== \"\" && !seen.has(val)) {\n                seen.add(val);\n                uniqueValues.push(String(val));\n            }\n        }\n        \n        // Create comma-separated list for validation\n        const listSource = uniqueValues.join(\",\");\n        \n        // Set the validation rule with explicit list\n        range.dataValidation.rule = {\n            list: {\n                inCellDropDown: true,\n                source: listSource\n            }\n        };\n    }\n}\n\nasync function createChart(ctx, sheet, dataRange, action) {\n    const { chartType, data } = action;\n    const ct = (chartType || \"column\").toLowerCase();\n    \n    // Load data to analyze it\n    dataRange.load([\"values\", \"rowCount\", \"columnCount\", \"rowIndex\", \"columnIndex\"]);\n    await ctx.sync();\n    \n    const values = dataRange.values;\n    const headers = values[0];\n    const rowCount = dataRange.rowCount;\n    \n    // Parse additional options from data if provided\n    let title = \"Chart\";\n    let position = \"H2\";\n    \n    // Try to extract title and position from action attributes or data\n    if (action.title) title = action.title;\n    if (action.position) position = action.position;\n    \n    // SMART DETECTION: If data has many rows with text categories, aggregate it\n    let shouldAggregate = false;\n    let categoryCol = -1;\n    let valueCol = -1;\n    \n    // Check if we have a text column (categories) and need to count/sum\n    if (rowCount > 10 && headers.length >= 2) {\n        // Find first text column (likely category)\n        for (let c = 0; c < headers.length; c++) {\n            const sample = values.slice(1, Math.min(6, values.length)).map(r => r[c]);\n            const hasText = sample.some(v => typeof v === \"string\" && v.length > 0);\n            const hasRepeats = new Set(sample).size < sample.length;\n            if (hasText && hasRepeats) {\n                categoryCol = c;\n                break;\n            }\n        }\n        \n        // Find meaningful numeric column (not IDs)\n        for (let c = 0; c < headers.length; c++) {\n            if (c === categoryCol) continue;\n            \n            const header = String(headers[c] || \"\").toLowerCase();\n            const sample = values.slice(1, Math.min(10, values.length)).map(r => r[c]);\n            const hasNumbers = sample.every(v => typeof v === \"number\" || !isNaN(parseFloat(v)));\n            \n            if (!hasNumbers) continue;\n            \n            // Skip if it looks like an ID column (sequential, unique, or has \"id\" in name)\n            const isID = header.includes(\"id\") || header.includes(\"no\") || header.includes(\"number\");\n            const numericSample = sample.map(v => parseFloat(v)).filter(v => !isNaN(v));\n            const isSequential = numericSample.length > 3 && \n                numericSample.every((v, i) => i === 0 || v > numericSample[i-1]);\n            const isUnique = new Set(numericSample).size === numericSample.length;\n            \n            // Skip ID-like columns\n            if (isID || (isSequential && isUnique)) continue;\n            \n            // This looks like a meaningful numeric column\n            valueCol = c;\n            break;\n        }\n        \n        shouldAggregate = categoryCol !== -1;\n    }\n    \n    // If we should aggregate, do it\n    if (shouldAggregate) {\n        const aggregated = {};\n        for (let r = 1; r < values.length; r++) {\n            const key = String(values[r][categoryCol] || \"\").trim();\n            if (!key) continue;\n            if (!aggregated[key]) aggregated[key] = { count: 0, sum: 0 };\n            aggregated[key].count++;\n            if (valueCol !== -1) {\n                const val = parseFloat(values[r][valueCol]);\n                if (!isNaN(val)) aggregated[key].sum += val;\n            }\n        }\n        \n        // Create aggregated data\n        const aggData = Object.entries(aggregated)\n            .map(([key, data]) => [key, valueCol !== -1 ? data.sum : data.count])\n            .sort((a, b) => b[1] - a[1]);\n        \n        // Write aggregated data below original\n        const aggStartRow = dataRange.rowIndex + rowCount + 2;\n        const aggValues = [[headers[categoryCol] || \"Category\", valueCol !== -1 ? headers[valueCol] : \"Count\"], ...aggData];\n        const aggRange = sheet.getRangeByIndexes(aggStartRow, dataRange.columnIndex, aggValues.length, 2);\n        aggRange.values = aggValues;\n        await ctx.sync();\n        \n        // Use aggregated data for chart\n        dataRange = aggRange;\n    }\n    \n    // Determine chart type\n    let type = Excel.ChartType.columnClustered;\n    \n    if (ct.includes(\"line\")) {\n        type = Excel.ChartType.line;\n    } else if (ct.includes(\"pie\")) {\n        type = Excel.ChartType.pie;\n    } else if (ct.includes(\"doughnut\") || ct.includes(\"donut\")) {\n        type = Excel.ChartType.doughnut;\n    } else if (ct.includes(\"bar\")) {\n        type = Excel.ChartType.barClustered;\n    } else if (ct.includes(\"area\")) {\n        type = Excel.ChartType.area;\n    } else if (ct.includes(\"scatter\") || ct.includes(\"xy\")) {\n        type = Excel.ChartType.xyscatter;\n    } else if (ct.includes(\"radar\") || ct.includes(\"spider\")) {\n        type = Excel.ChartType.radar;\n    } else if (ct.includes(\"stacked\")) {\n        if (ct.includes(\"bar\")) {\n            type = Excel.ChartType.barStacked;\n        } else {\n            type = Excel.ChartType.columnStacked;\n        }\n    }\n    \n    // Handle the data range - check if it's a valid contiguous range\n    let chartDataRange = dataRange;\n    const targetAddress = action.target;\n    \n    // Comment 4: Check if target contains comma (non-contiguous) - not supported directly\n    if (targetAddress && targetAddress.includes(\",\")) {\n        // Log warning and show user feedback\n        console.warn(\"Non-contiguous ranges not fully supported for charts, using first range only\");\n        logWarn(`Chart: Non-contiguous range \"${targetAddress}\" - using first range only`);\n        toast(\"Non-contiguous ranges not supported for charts; only the first range was used\");\n        \n        // For non-contiguous ranges, we need to use the first range\n        const ranges = targetAddress.split(\",\").map(r => r.trim());\n        chartDataRange = sheet.getRange(ranges[0]);\n    }\n    \n    // Create the chart\n    const chart = sheet.charts.add(type, chartDataRange, Excel.ChartSeriesBy.auto);\n    \n    // Calculate end position (chart size roughly 8 cols x 15 rows)\n    const startCol = position.match(/[A-Z]+/)?.[0] || \"H\";\n    const startRow = parseInt(position.match(/\\d+/)?.[0] || \"2\");\n    const endCol = String.fromCharCode(startCol.charCodeAt(0) + 8);\n    const endRow = startRow + 15;\n    const endPosition = `${endCol}${endRow}`;\n    \n    chart.setPosition(position, endPosition);\n    \n    // Set title\n    chart.title.text = title;\n    chart.title.visible = true;\n    \n    // Style the chart\n    chart.legend.visible = true;\n    chart.legend.position = Excel.ChartLegendPosition.bottom;\n    \n    // For pie charts, show data labels\n    if (ct.includes(\"pie\") || ct.includes(\"doughnut\")) {\n        chart.legend.position = Excel.ChartLegendPosition.right;\n    }\n    \n    // For line/trend charts, improve readability\n    if (ct.includes(\"line\") || ct.includes(\"trend\")) {\n        chart.legend.position = Excel.ChartLegendPosition.bottom;\n    }\n}\n\n/**\n * Creates a pivot chart by aggregating data intelligently\n */\nasync function createPivotChart(ctx, sheet, range, action) {\n    range.load([\"values\", \"rowIndex\", \"columnIndex\", \"rowCount\"]);\n    await ctx.sync();\n    \n    const values = range.values;\n    const headers = values[0];\n    \n    // Parse options\n    let options = { groupBy: null, aggregate: null, aggregateFunc: \"sum\", chartType: \"column\", title: \"Pivot Chart\", position: \"H2\" };\n    if (action.data) {\n        try { options = { ...options, ...JSON.parse(action.data) }; } catch (e) {}\n    }\n    if (action.chartType) options.chartType = action.chartType;\n    if (action.title) options.title = action.title;\n    if (action.position) options.position = action.position;\n    \n    // Find columns - be more flexible with matching\n    let groupByIdx = -1;\n    for (let i = 0; i < headers.length; i++) {\n        const header = String(headers[i]).toLowerCase().trim();\n        const searchTerm = String(options.groupBy || \"\").toLowerCase().trim();\n        if (header === searchTerm || header.includes(searchTerm) || searchTerm.includes(header)) {\n            groupByIdx = i;\n            break;\n        }\n    }\n    \n    if (groupByIdx === -1) {\n        console.error(\"Available headers:\", headers);\n        throw new Error(`Column \"${options.groupBy}\" not found. Available: ${headers.join(\", \")}`);\n    }\n    \n    let aggregateIdx = -1;\n    if (options.aggregate) {\n        for (let i = 0; i < headers.length; i++) {\n            const header = String(headers[i]).toLowerCase().trim();\n            const searchTerm = String(options.aggregate).toLowerCase().trim();\n            if (header === searchTerm || header.includes(searchTerm) || searchTerm.includes(header)) {\n                aggregateIdx = i;\n                break;\n            }\n        }\n    }\n    \n    // Aggregate data\n    const aggregated = {};\n    for (let r = 1; r < values.length; r++) {\n        const groupValue = values[r][groupByIdx];\n        const key = String(groupValue || \"\").trim();\n        if (!key || key === \"null\" || key === \"undefined\") continue;\n        \n        if (!aggregated[key]) aggregated[key] = { count: 0, sum: 0, values: [] };\n        aggregated[key].count++;\n        \n        if (aggregateIdx !== -1) {\n            const val = parseFloat(values[r][aggregateIdx]);\n            if (!isNaN(val)) {\n                aggregated[key].sum += val;\n                aggregated[key].values.push(val);\n            }\n        }\n    }\n    \n    // Calculate final values\n    const chartData = [];\n    for (const [key, data] of Object.entries(aggregated)) {\n        let value;\n        const func = (options.aggregateFunc || \"count\").toLowerCase();\n        switch (func) {\n            case \"count\": \n                value = data.count; \n                break;\n            case \"average\": \n            case \"avg\": \n                value = data.values.length > 0 ? data.sum / data.values.length : data.count; \n                break;\n            case \"max\": \n                value = data.values.length > 0 ? Math.max(...data.values) : data.count; \n                break;\n            case \"min\": \n                value = data.values.length > 0 ? Math.min(...data.values) : data.count; \n                break;\n            case \"sum\":\n            default: \n                value = data.values.length > 0 ? data.sum : data.count; \n                break;\n        }\n        chartData.push([key, value]);\n    }\n    chartData.sort((a, b) => b[1] - a[1]);\n    \n    // Write aggregated data\n    const chartStartRow = range.rowIndex + range.rowCount + 2;\n    const chartValues = [[options.groupBy || \"Category\", options.aggregate || \"Value\"], ...chartData];\n    const chartDataRange = sheet.getRangeByIndexes(chartStartRow, range.columnIndex, chartValues.length, 2);\n    chartDataRange.values = chartValues;\n    await ctx.sync();\n    \n    // Create chart\n    let type = Excel.ChartType.columnClustered;\n    const ct = options.chartType.toLowerCase();\n    if (ct.includes(\"pie\")) type = Excel.ChartType.pie;\n    else if (ct.includes(\"bar\")) type = Excel.ChartType.barClustered;\n    else if (ct.includes(\"line\")) type = Excel.ChartType.line;\n    \n    const chart = sheet.charts.add(type, chartDataRange, Excel.ChartSeriesBy.columns);\n    const position = options.position || \"H2\";\n    const startCol = position.match(/[A-Z]+/)?.[0] || \"H\";\n    const startRow = parseInt(position.match(/\\d+/)?.[0] || \"2\");\n    chart.setPosition(position, `${String.fromCharCode(startCol.charCodeAt(0) + 8)}${startRow + 15}`);\n    chart.title.text = options.title;\n    chart.legend.visible = true;\n    chart.legend.position = ct.includes(\"pie\") ? Excel.ChartLegendPosition.right : Excel.ChartLegendPosition.bottom;\n    await ctx.sync();\n}\n\nfunction applySort(range, data) {\n    let opts = {};\n    \n    // Parse data - can be JSON or simple format\n    if (typeof data === \"string\") {\n        try {\n            opts = JSON.parse(data);\n        } catch {\n            // Try to parse simple format like \"column:1,ascending:true\"\n            const parts = data.split(\",\");\n            for (const part of parts) {\n                const [key, value] = part.split(\":\").map(s => s.trim());\n                if (key === \"column\") opts.column = parseInt(value) || 0;\n                if (key === \"ascending\") opts.ascending = value !== \"false\";\n                if (key === \"hasHeaders\") opts.hasHeaders = value === \"true\";\n            }\n        }\n    } else {\n        opts = data || {};\n    }\n    \n    // Default to first column, ascending, with headers\n    const columnIndex = opts.column || 0;\n    const ascending = opts.ascending !== false;\n    const hasHeaders = opts.hasHeaders !== false; // Default to true (has headers)\n    \n    range.sort.apply(\n        [{ \n            key: columnIndex, \n            ascending: ascending \n        }],\n        false, // matchCase\n        hasHeaders, // hasHeaders - true means first row is header and won't be sorted\n        Excel.SortOrientation.rows\n    );\n}\n\n/**\n * Applies AutoFilter to a range\n * @param {Object} ctx - Excel context\n * @param {Object} sheet - Excel worksheet\n * @param {Object} range - Excel range\n * @param {string} data - Filter criteria as JSON string\n */\nasync function applyFilter(ctx, sheet, range, data) {\n    let filterOpts = {};\n    \n    // Parse filter options\n    if (typeof data === \"string\") {\n        try {\n            filterOpts = JSON.parse(data);\n        } catch {\n            throw new Error(\"Invalid filter data format\");\n        }\n    } else {\n        filterOpts = data || {};\n    }\n    \n    // Try to clear any existing autofilter (ignore errors if none exists)\n    try {\n        sheet.autoFilter.clearCriteria();\n        await ctx.sync();\n    } catch (e) {\n        // No existing filter, continue\n    }\n    \n    // Apply AutoFilter to the range\n    sheet.autoFilter.apply(range);\n    await ctx.sync();\n    \n    // If specific column filters are provided, apply them\n    if (filterOpts.column !== undefined && filterOpts.values) {\n        // Get the filter criteria for the specified column\n        const criteria = {\n            filterOn: Excel.FilterOn.values,\n            values: filterOpts.values\n        };\n        \n        // Apply the filter criteria to the column\n        sheet.autoFilter.apply(range, filterOpts.column, criteria);\n        await ctx.sync();\n    }\n}\n\n/**\n * Clears all filters from the worksheet\n * @param {Object} ctx - Excel context\n * @param {Object} sheet - Excel worksheet\n */\nasync function clearFilter(ctx, sheet) {\n    try {\n        sheet.autoFilter.clearCriteria();\n        await ctx.sync();\n    } catch (e) {\n        // No filter to clear, ignore\n    }\n}\n\n/**\n * Removes duplicate rows from a range\n * @param {Object} ctx - Excel context\n * @param {Object} range - Excel range\n * @param {string} data - JSON string with columns array\n */\nasync function removeDuplicates(ctx, range, data) {\n    // Load the range data and address\n    range.load([\"values\", \"rowCount\", \"columnCount\", \"address\"]);\n    await ctx.sync();\n    \n    const values = range.values;\n    const rowCount = range.rowCount;\n    const colCount = range.columnCount;\n    const rangeAddress = range.address;\n    \n    // Parse options (which columns to check for duplicates)\n    let options = { columns: [] };\n    if (data) {\n        try {\n            options = JSON.parse(data);\n        } catch (e) {\n            // Default to all columns\n            options.columns = Array.from({ length: colCount }, (_, i) => i);\n        }\n    }\n    \n    // If no columns specified, use all columns\n    if (!options.columns || options.columns.length === 0) {\n        options.columns = Array.from({ length: colCount }, (_, i) => i);\n    }\n    \n    // Find unique rows (keep first occurrence)\n    const seen = new Set();\n    const uniqueRows = [];\n    \n    for (let r = 0; r < rowCount; r++) {\n        const row = values[r];\n        \n        // Create a key from the specified columns\n        const key = options.columns.map(colIdx => {\n            const val = row[colIdx];\n            return val === null || val === undefined ? \"\" : String(val);\n        }).join(\"|\");\n        \n        if (!seen.has(key)) {\n            seen.add(key);\n            uniqueRows.push(row);\n        }\n    }\n    \n    // Clear the original range\n    range.clear(Excel.ClearApplyTo.contents);\n    await ctx.sync();\n    \n    // Write back only unique rows\n    if (uniqueRows.length > 0) {\n        // Get the sheet and create a new range reference from the original address\n        const sheet = range.worksheet;\n        const address = rangeAddress.split(\"!\")[1] || rangeAddress; // Remove sheet name if present\n        const startCell = address.split(\":\")[0]; // Get starting cell (e.g., \"A1\")\n        \n        // Create a new range from the start cell\n        const targetCell = sheet.getRange(startCell);\n        const newRange = targetCell.getResizedRange(uniqueRows.length - 1, colCount - 1);\n        newRange.values = uniqueRows;\n    }\n}\n\nexport { handleSend, handleApply, readExcelData, clearChat };\n","// Imports\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\n// Module\nvar code = \"<!DOCTYPE html> <html lang=\\\"en\\\"> <head> <meta charset=\\\"UTF-8\\\"> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no\\\"> <title>Excel Copilot</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1/hosted/office.js\\\"><\" + \"/script> <link href=\\\"\" + ___HTML_LOADER_IMPORT_0___ + \"\\\" rel=\\\"stylesheet\\\"> </head> <body> <div class=\\\"app\\\"> <header class=\\\"header\\\"> <div class=\\\"brand\\\"> <svg class=\\\"logo\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"> <path d=\\\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\\\"/> </svg> <span>Copilot</span> <span class=\\\"version-badge\\\" id=\\\"versionBadge\\\" title=\\\"Click to check for updates\\\">v2.9.4</span> </div> <div class=\\\"header-actions\\\"> <button class=\\\"icon-btn\\\" id=\\\"themeBtn\\\" title=\\\"Toggle Dark Mode\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <path d=\\\"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z\\\"/> </svg> </button> <button class=\\\"icon-btn\\\" id=\\\"historyBtn\\\" title=\\\"History\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"10\\\"/><path d=\\\"M12 6v6l4 2\\\"/> </svg> </button> <button class=\\\"icon-btn\\\" id=\\\"diagnosticsBtn\\\" title=\\\"Diagnostics\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <path d=\\\"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z\\\"/> <path d=\\\"M14 2v6h6M16 13H8M16 17H8M10 9H8\\\"/> </svg> </button> <button class=\\\"icon-btn\\\" id=\\\"clearBtn\\\" title=\\\"Clear\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <path d=\\\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\\\"/> </svg> </button> <button class=\\\"icon-btn\\\" id=\\\"settingsBtn\\\" title=\\\"Settings\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"3\\\"/><path d=\\\"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z\\\"/> </svg> </button> </div> </header> <main class=\\\"main\\\"> <div id=\\\"welcome\\\" class=\\\"welcome\\\"> <div class=\\\"welcome-icon\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"> <path d=\\\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\\\"/> </svg> </div> <h1>Excel Copilot</h1> <p>Your AI assistant for Excel. Select cells and ask me anything.</p> <div class=\\\"suggestions\\\"> <button data-prompt=\\\"Analyze this data and give me key insights\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\\\"/></svg> Analyze data </button> <button data-prompt=\\\"Create a SUM formula for the selected cells\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M4 7h16M4 12h16M4 17h10\\\"/></svg> Create formula </button> <button data-prompt=\\\"Create a chart to visualize this data\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M18 20V10M12 20V4M6 20v-6\\\"/></svg> Create chart </button> <button data-prompt=\\\"Format this as a professional table with headers\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><rect x=\\\"3\\\" y=\\\"3\\\" width=\\\"18\\\" height=\\\"18\\\" rx=\\\"2\\\"/><path d=\\\"M3 9h18M9 21V9\\\"/></svg> Format table </button> </div> </div> <div id=\\\"chat\\\" class=\\\"chat\\\"></div> <div id=\\\"previewPanel\\\" class=\\\"preview-panel\\\" style=\\\"display:none\\\"> <div class=\\\"preview-header\\\"> <span class=\\\"preview-title\\\">Pending Changes</span> <button class=\\\"icon-btn-sm\\\" id=\\\"selectAllBtn\\\" title=\\\"Select All\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M9 11l3 3L22 4\\\"/><path d=\\\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\\\"/></svg> </button> </div> <div id=\\\"previewList\\\" class=\\\"preview-list\\\"></div> </div> <div id=\\\"historyPanel\\\" class=\\\"history-panel\\\" style=\\\"display:none\\\"> <div class=\\\"history-header\\\"> <span class=\\\"history-title\\\">Action History</span> </div> <div id=\\\"historyList\\\" class=\\\"history-list\\\"></div> </div> <div id=\\\"diagnosticsPanel\\\" class=\\\"diagnostics-panel\\\" style=\\\"display:none\\\"> <div class=\\\"diagnostics-header\\\"> <span class=\\\"diagnostics-title\\\">Diagnostics</span> <div class=\\\"diagnostics-actions\\\"> <button class=\\\"icon-btn-sm\\\" id=\\\"clearLogsBtn\\\" title=\\\"Clear Logs\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <path d=\\\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\\\"/> </svg> </button> <button class=\\\"icon-btn-sm\\\" id=\\\"toggleDebugBtn\\\" title=\\\"Toggle Debug Mode\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <path d=\\\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\\\"/> </svg> </button> </div> </div> <div id=\\\"diagnosticsList\\\" class=\\\"diagnostics-list\\\"></div> </div> </main> <div class=\\\"context-bar\\\"> <span class=\\\"context-label\\\">Data:</span> <span class=\\\"context-info\\\" id=\\\"contextInfo\\\">No selection</span> <div class=\\\"mode-toggle-compact\\\"> <button class=\\\"mode-icon-sm active\\\" id=\\\"editModeBtn\\\" data-mode=\\\"edit\\\" title=\\\"Edit Mode\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7\\\"/><path d=\\\"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z\\\"/></svg> </button> <button class=\\\"mode-icon-sm\\\" id=\\\"readOnlyModeBtn\\\" data-mode=\\\"readonly\\\" title=\\\"Read-Only Mode\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\\\"/><circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"3\\\"/></svg> </button> </div> <button class=\\\"icon-btn-sm\\\" id=\\\"refreshBtn\\\" title=\\\"Refresh\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M23 4v6h-6M1 20v-6h6\\\"/><path d=\\\"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15\\\"/></svg> </button> </div> <div class=\\\"input-area\\\"> <div class=\\\"input-box\\\"> <textarea id=\\\"promptInput\\\" placeholder=\\\"Ask me anything...\\\" rows=\\\"1\\\"></textarea> <button class=\\\"send-btn\\\" id=\\\"sendBtn\\\" disabled=\\\"disabled\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"><path d=\\\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\\\"/></svg> </button> </div> <div class=\\\"action-buttons\\\"> <button class=\\\"undo-btn\\\" id=\\\"undoBtn\\\" disabled=\\\"disabled\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M3 10h10a5 5 0 015 5v2M3 10l6 6M3 10l6-6\\\"/></svg> Undo </button> <button class=\\\"apply-btn\\\" id=\\\"applyBtn\\\" disabled=\\\"disabled\\\">Apply Changes</button> </div> </div> </div> <div class=\\\"modal\\\" id=\\\"modal\\\"> <div class=\\\"modal-box\\\"> <div class=\\\"modal-header\\\"> <h2>Settings</h2> <button class=\\\"icon-btn\\\" id=\\\"closeModal\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M18 6L6 18M6 6l12 12\\\"/></svg> </button> </div> <div class=\\\"modal-body\\\"> <label>Gemini API Key</label> <div class=\\\"input-row\\\"> <input type=\\\"password\\\" id=\\\"apiKeyInput\\\" placeholder=\\\"Enter your API key\\\"> <button class=\\\"icon-btn\\\" id=\\\"togglePwd\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\\\"/><circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"3\\\"/></svg> </button> </div> <p class=\\\"hint\\\">Get your free key at <a href=\\\"https://aistudio.google.com/apikey\\\" target=\\\"_blank\\\">Google AI Studio</a></p> <div class=\\\"settings-section\\\"> <label>Worksheet Scope</label> <div class=\\\"mode-toggle\\\"> <label class=\\\"mode-label\\\"> <input type=\\\"radio\\\" name=\\\"worksheetScope\\\" value=\\\"single\\\" id=\\\"scopeSingle\\\" checked=\\\"checked\\\"> <span>Active Sheet Only</span> </label> <label class=\\\"mode-label\\\"> <input type=\\\"radio\\\" name=\\\"worksheetScope\\\" value=\\\"all\\\" id=\\\"scopeAll\\\"> <span>All Sheets</span> </label> </div> <p class=\\\"hint\\\">Active Sheet Only: AI sees only the current sheet. All Sheets: AI can access all sheets in the workbook.</p> </div> <div class=\\\"settings-section\\\"> <label>AI Learning</label> <p class=\\\"hint\\\">The AI learns from your corrections to improve future suggestions.</p> <button class=\\\"btn-secondary\\\" id=\\\"clearPrefsBtn\\\">Clear Learned Preferences</button> </div> <div class=\\\"settings-section\\\"> <label>Security</label> <p class=\\\"hint\\\">API keys are stored with basic obfuscation. For maximum security, remove the key when not in use.</p> <button class=\\\"btn-secondary btn-danger\\\" id=\\\"removeApiKeyBtn\\\">Remove API Key</button> </div> <div class=\\\"settings-section\\\"> <label>Diagnostics</label> <p class=\\\"hint\\\">Enable debug mode to see detailed logs and troubleshoot issues.</p> <label class=\\\"mode-label\\\"> <input type=\\\"checkbox\\\" id=\\\"debugModeCheckbox\\\"> <span>Enable Debug Mode</span> </label> </div> <div class=\\\"settings-section\\\"> <label>Updates</label> <p class=\\\"hint\\\" id=\\\"updateStatus\\\">Current version: <span id=\\\"currentVersionText\\\">v3.1.0</span></p> <button class=\\\"btn-secondary btn-update\\\" id=\\\"checkUpdateBtn\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" width=\\\"14\\\" height=\\\"14\\\"> <path d=\\\"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9\\\"/> </svg> Check for Updates </button> <button class=\\\"btn-secondary btn-update btn-success\\\" id=\\\"updateNowBtn\\\" style=\\\"display:none\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" width=\\\"14\\\" height=\\\"14\\\"> <path d=\\\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\\\"/> </svg> Update Now </button> </div> </div> <div class=\\\"modal-footer\\\"> <button class=\\\"btn-cancel\\\" id=\\\"cancelBtn\\\">Cancel</button> <button class=\\\"btn-save\\\" id=\\\"saveBtn\\\">Save</button> </div> </div> </div> <div class=\\\"toast\\\" id=\\\"toast\\\"></div> </body> </html> \";\n// Exports\nexport default code;"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","g","globalThis","this","Function","e","window","o","obj","prop","Object","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","tagName","toUpperCase","src","scripts","getElementsByTagName","length","i","test","Error","replace","p","b","baseURI","self","href","AI_CONFIG","TASK_TYPES","TASK_KEYWORDS","_defineProperty","detectTaskType","prompt","lower","toLowerCase","_i","_Object$entries","entries","_step","_Object$entries$_i","_slicedToArray","taskType","_iterator","_createForOfIteratorHelper","s","n","done","keyword","value","includes","err","f","TASK_PROMPTS","EXCEL_FUNCTIONS","SUM","description","signature","example","AVERAGE","COUNT","COUNTA","MAX","MIN","VLOOKUP","XLOOKUP","INDEX","MATCH","IF","SUMIF","COUNTIF","SUMIFS","CONCATENATE","LEFT","RIGHT","MID","TRIM","UPPER","LOWER","TODAY","NOW","YEAR","MONTH","DAY","DATEDIF","IFERROR","IFNA","FORMULA_PATTERNS","id","keywords","pattern","REASONING_STEPS","requiresMultiStep","some","ind","getStoredCorrections","key","defaultValue","arguments","stored","localStorage","getItem","JSON","parse","console","warn","concat","message","safeLocalStorageRead","isCorrection","trim","startsWith","enhancePrompt","userPrompt","dataContext","isCorrectionMsg","systemPrompt","corrections","basePrompt","correctionsContext","keys","_i2","_Object$entries2","_Object$entries2$_i","getTaskSpecificPrompt","_step6","context","_iterator6","corr","insight","type","push","rule","formatted","_i4","_Object$entries4","_Object$entries4$_i","rules","_toConsumableArray","Set","slice","join","getCorrectionContext","_i3","_Object$entries3","_Object$entries3$_i","category","funcs","_step2","_iterator2","func","def","getFunctionCallingContext","ragContext","query","patterns","_step3","limit","scored","_iterator3","_step4","score","_iterator4","split","w","_objectSpread","sort","a","searchPatterns","_step5","_iterator5","getRAGContext","enhancedUserPrompt","steps","step","decomposeTask","enhancedPrompt","generateReasoningPrompt","hasMultiStep","extractResponseText","data","_data$promptFeedback","promptFeedback","blockReason","text","error","blocked","candidates","_step7","allTextParts","_iterator7","_candidate$content","candidate","finishReason","content","parts","_step8","_iterator8","part","combinedText","processResponse","response","functionCalls","match","callPattern","exec","funcName","target","args","parseFunctionCalls","additionalActions","handleCorrection","userMessage","previousAIResponse","original","correction","colMatch","wrong","correct","cellMatch","headerMatch","formatMatch","format","chartMatch","chartType","parseCorrection","Date","now","timestamp","toISOString","maxItems","trimmedData","Array","isArray","setItem","stringify","reducedData","Math","floor","retryError","safeLocalStorageWrite","storeCorrection","t","r","Symbol","iterator","toStringTag","c","Generator","u","create","_regeneratorDefine2","y","G","v","d","bind","l","TypeError","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","defineProperty","_invoke","enumerable","configurable","writable","_arrayLikeToArray","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","apply","_next","_throw","colIndexToLetter","index","letter","String","fromCharCode","colLetterToIndex","col","upper","charCodeAt","validateHeaders","headers","isValid","reason","stringCount","numberCount","toString","constructor","name","from","_unsupportedIterableToArray","_n","F","next","cell","removeSelectionListener","_x7","_removeSelectionListener","_callee6","handler","_t5","_context6","Excel","run","_ref3","_callee5","ctx","_context5","remove","sync","_x0","DIAG_CONFIG","logs","debugMode","updateCallback","log","level","entry","random","substr","unshift","logInfo","logWarn","logError","logDebug","getLogs","toggleDebugMode","disableDebugMode","enableDebugMode","VERSION","CONFIG","state","apiKey","pendingActions","currentData","allSheetsData","conversationHistory","isFirstMessage","lastAIResponse","currentTaskType","worksheetScope","selectionHandler","preview","selections","expandedIndex","highlightedIndex","history","panelVisible","maxEntries","diagnosticsPanelVisible","closeModal","getElementById","classList","setupSelectionListener","_setupSelectionListener","_callee4","_t","_context4","_callee3","worksheet","_context3","workbook","worksheets","getActiveWorksheet","onSelectionChanged","add","readExcelData","_x50","toast","reattachSelectionListener","_reattachSelectionListener","_readExcelData","_callee7","infoEl","errorReason","_t4","_context7","_ref4","sheets","shouldReadAllSheets","activeSheet","activeSheetName","sheetsToRead","sheet","usedRange","sheetName","values","startCol","startRow","rowCount","colCount","headerValidation","columnMap","colLetter","headerName","_sheetName","activeSheetData","scopeText","_t2","_t3","load","items","find","getUsedRange","columnIndex","rowIndex","columnCount","header","address","map","dataStartRow","textContent","_x51","substring","showChat","style","display","addMessage","role","chat","msg","createElement","className","innerHTML","appendChild","setTimeout","scrollTo","top","scrollHeight","behavior","showTyping","el","scrollTop","hideTyping","_document$getElementB22","showLoadingSkeleton","hideLoadingSkeleton","_document$getElementB23","clearChat","disabled","hidePreviewPanel","hideTaskTypeIndicator","checkForUpdates","_checkForUpdates","_callee8","versionBadge","originalText","code","versionMatch","deployedVersion","currentVersion","_context8","fetch","color","Office","onReady","info","host","HostType","updateDiagnosticsPanel","initDiagnostics","version","atob","cursor","addEventListener","savedTheme","documentElement","setAttribute","editBtn","readOnlyBtn","_document$getElementB","_document$getElementB2","_document$getElementB3","_document$getElementB4","_document$getElementB5","_document$getElementB6","_document$getElementB7","_document$getElementB8","_document$getElementB9","_document$getElementB0","_document$getElementB1","_document$getElementB10","_document$getElementB11","_document$getElementB12","_document$getElementB13","_document$getElementB14","_document$getElementB15","_document$getElementB16","_document$getElementB17","_document$getElementB18","_document$getElementB19","_document$getElementB20","_document$getElementB21","sendBtn","input","savedScope","handleSend","shiftKey","preventDefault","height","min","handleApply","_callee","btn","_context","checked","_callee2","_document$querySelect","obfuscated","selectedScope","scopeChanged","_context2","btoa","removeItem","querySelector","scope","toggleHistoryPanel","performUndo","toggleDiagnosticsPanel","checkbox","checkForUpdatesInSettings","performUpdate","versionText","toggleTheme","setMode","handleKeyboardShortcuts","querySelectorAll","forEach","dataset","inp","toggle","mode","initApp","latestAvailableVersion","_checkForUpdatesInSettings","_callee9","checkBtn","updateBtn","statusEl","originalBtnText","_t6","_context9","_performUpdate","_callee0","cacheNames","_t7","_context0","caches","all","delete","reload","_handleSend","_callee1","_parseResponse","actions","_t8","_t9","_context1","click","showTaskTypeIndicator","callAI","parseResponse","getTaskTypeBadge","showPreviewPanel","getErrorMessage","labels","indicator","_x","_callAI","_callee11","enhanced","fullUserMessage","contents","processed","_context11","buildDataContext","getReadOnlySystemPrompt","withRetry","_callee10","res","extracted","_context10","method","body","systemInstruction","generationConfig","temperature","maxOutputTokens","ok","status","json","_state$currentData","samples","_values$_r","val","maxRows","rowNum","_values$r","uniqueVals","_values$_r2","size","row","actionRegex","_attrs$match","_attrs$match2","_attrs$match3","_attrs$match4","_attrs$match5","_attrs$match6","attrs","source","title","position","getActionIcon","icons","formula","chart","validation","autofill","filterSelectedActions","filter","_","panel","list","_document$getElementB24","html","action","isExpanded","isSelected","hasWarning","icon","summary","getActionSummary","details","vals","_unused","fmt","bold","italic","fill","fontColor","fontSize","numberFormat","_unused2","getActionDetails","warningClass","renderPreviewItemHTML","cb","parseInt","updateApplyButtonState","stopPropagation","item","contains","_state$pendingActions","_x2","_highlightRange","highlightRange","_clearHighlight","clearHighlight","toggleSelectAll","allSelected","every","applyBtn","hasSelected","isReadOnly","_callee13","rangeAddress","_t0","_context13","_ref6","_callee12","_context12","getRange","select","_x52","_callee14","_context14","newTheme","getAttribute","ctrlKey","metaKey","activeElement","activeEl","_x3","_withRetry","_callee15","fn","maxRetries","lastError","_loop","_ret","_args16","_context16","delay","_t1","_t10","_context15","pow","_regeneratorValues","captureUndoData","_x4","_x5","_x6","_captureUndoData","_callee16","range","_t11","_context17","formulas","addActionToHistory","undoData","updateUndoButtonState","renderHistoryPanel","_performUndo","_callee18","_t12","_context19","_ref7","_callee17","_context18","_x53","undoBtn","typeLabels","diff","seconds","minutes","hours","days","label","timeStr","div","debug","levelClass","toLocaleTimeString","dataStr","renderLogEntry","_handleApply","_callee20","selectedActions","successCount","errorMsg","_context21","_ref8","_callee19","_t13","_t14","_context20","executeAction","_x54","_x8","_x9","_executeAction","_callee21","_t16","_context22","validationType","createSheet","applyFormula","applyValues","applyFormat","applyConditionalFormat","clearConditionalFormat","applyValidation","createChart","createPivotChart","applySort","autoFill","AutoFillType","fillDefault","applyCopy","applyCopyValues","applyFilter","clearFilter","removeDuplicates","_x1","_x10","_createSheet","_callee22","newSheet","_context23","_x11","_x12","_x13","_x14","_applyCopy","_callee23","sourceRange","_context24","getResizedRange","_x15","_x16","_x17","_x18","_applyCopyValues","_callee24","targetAddress","_context25","_x19","_x20","_applyFormula","_callee25","rows","cols","firstCell","_loop2","_formulas","_loop3","_formulas2","_loop4","_r4","_t17","_context30","getCell","_context26","colAbs","rowAbs","newRow","_context27","newCol","rowFormulas","_loop5","_c2","_context29","_context28","_unused3","_x21","_x22","_x23","_applyFormat","_callee26","_context31","_unused5","font","border","borders","_x24","_x25","_x26","_applyConditionalFormat","_callee27","parsed","cf","operator","_context32","_unused6","conditionalFormats","clearAll","ConditionalFormatType","cellValue","ConditionalCellValueOperator","greaterThan","lessThan","equalTo","greaterThanOrEqual","lessThanOrEqual","between","formula1","formula2","value2","_x27","_x28","_clearConditionalFormat","_callee28","_context33","_x29","_x30","_x31","_x32","_applyValidation","_callee29","uniqueValues","seen","_iterator9","_step9","listSource","_context34","dataValidation","clear","has","inCellDropDown","_x33","_x34","_x35","_x36","_createChart","_callee30","dataRange","_position$match","_position$match2","ct","shouldAggregate","categoryCol","valueCol","_loop6","_loop7","_ret2","_c3","aggregated","aggData","aggStartRow","aggValues","aggRange","chartDataRange","ranges","endCol","endRow","endPosition","_context37","sample","hasText","hasRepeats","_context35","isID","numericSample","isSequential","isUnique","_context36","isNaN","parseFloat","count","sum","_ref9","_ref0","getRangeByIndexes","ChartType","columnClustered","line","pie","doughnut","barClustered","area","xyscatter","radar","barStacked","columnStacked","charts","ChartSeriesBy","auto","setPosition","visible","legend","ChartLegendPosition","bottom","right","_x37","_x38","_x39","_x40","_createPivotChart","_callee31","_position$match3","_position$match4","options","groupByIdx","searchTerm","aggregateIdx","_header","_searchTerm","groupValue","chartData","_key","chartStartRow","chartValues","_t18","_context38","groupBy","aggregate","aggregateFunc","max","columns","opts","_unused4","_part$split$map2","column","ascending","hasHeaders","SortOrientation","_x41","_x42","_x43","_x44","_applyFilter","_callee32","filterOpts","criteria","_context39","autoFilter","clearCriteria","filterOn","FilterOn","_x45","_x46","_clearFilter","_callee33","_context40","_x47","_x48","_x49","_removeDuplicates","_callee34","uniqueRows","_loop8","startCell","_context42","_context41","colIdx","ClearApplyTo","URL"],"ignoreList":[],"sourceRoot":""}