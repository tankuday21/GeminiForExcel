{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/webpack/bootstrap","webpack://office-addin-taskpane-js/webpack/runtime/global","webpack://office-addin-taskpane-js/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane-js/webpack/runtime/publicPath","webpack://office-addin-taskpane-js/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane-js/./src/taskpane/ai-engine.js","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.js","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.html"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = (typeof document !== 'undefined' && document.baseURI) || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","/*\r\n * AI Engine - Advanced AI capabilities for Excel Copilot\r\n * Features: Task-specific prompts, function calling, RAG, multi-step reasoning, learning\r\n */\r\n\r\n/* global localStorage */\r\n\r\n// ============================================================================\r\n// Configuration\r\n// ============================================================================\r\nconst AI_CONFIG = {\r\n    CORRECTIONS_KEY: \"excel_copilot_corrections\",\r\n    PATTERNS_KEY: \"excel_copilot_patterns\",\r\n    MAX_CORRECTIONS: 50,\r\n    MAX_PATTERNS: 100\r\n};\r\n\r\n// ============================================================================\r\n// Task Type Detection\r\n// ============================================================================\r\nconst TASK_TYPES = {\r\n    FORMULA: \"formula\",\r\n    CHART: \"chart\",\r\n    ANALYSIS: \"analysis\",\r\n    FORMAT: \"format\",\r\n    DATA_ENTRY: \"data_entry\",\r\n    VALIDATION: \"validation\",\r\n    GENERAL: \"general\"\r\n};\r\n\r\nconst TASK_KEYWORDS = {\r\n    [TASK_TYPES.FORMULA]: [\r\n        \"formula\", \"sum\", \"average\", \"count\", \"vlookup\", \"xlookup\", \"if\", \"calculate\",\r\n        \"total\", \"add up\", \"multiply\", \"divide\", \"percentage\", \"sumif\", \"countif\",\r\n        \"index\", \"match\", \"concatenate\", \"lookup\", \"function\",\r\n        \"clean\", \"trim\", \"upper\", \"lower\", \"remove spaces\", \"text manipulation\",\r\n        \"convert\", \"proper case\", \"title case\", \"capitalize\"\r\n    ],\r\n    [TASK_TYPES.CHART]: [\r\n        \"chart\", \"graph\", \"visualize\", \"plot\", \"pie\", \"bar\", \"line\", \"column\",\r\n        \"histogram\", \"scatter\", \"trend\", \"visualization\", \"diagram\"\r\n    ],\r\n    [TASK_TYPES.ANALYSIS]: [\r\n        \"analyze\", \"analysis\", \"insight\", \"summary\", \"summarize\", \"statistics\",\r\n        \"trend\", \"pattern\", \"outlier\", \"anomaly\", \"compare\", \"correlation\",\r\n        \"distribution\", \"breakdown\", \"report\", \"findings\"\r\n    ],\r\n    [TASK_TYPES.FORMAT]: [\r\n        \"format\", \"style\", \"color\", \"bold\", \"italic\", \"font\", \"border\",\r\n        \"highlight\", \"conditional\", \"table\", \"header\", \"align\", \"merge\"\r\n    ],\r\n    [TASK_TYPES.DATA_ENTRY]: [\r\n        \"fill\", \"enter\", \"input\", \"write\", \"set\", \"update\", \"change value\",\r\n        \"put\", \"insert\", \"add data\", \"populate\"\r\n    ],\r\n    [TASK_TYPES.VALIDATION]: [\r\n        \"dropdown\", \"validation\", \"list\", \"restrict\", \"allow\", \"select from\",\r\n        \"choices\", \"options\", \"pick list\"\r\n    ]\r\n};\r\n\r\n/**\r\n * Detects the task type from user prompt\r\n * @param {string} prompt - User's input\r\n * @returns {string} Task type\r\n */\r\nfunction detectTaskType(prompt) {\r\n    const lower = prompt.toLowerCase();\r\n    \r\n    for (const [taskType, keywords] of Object.entries(TASK_KEYWORDS)) {\r\n        for (const keyword of keywords) {\r\n            if (lower.includes(keyword)) {\r\n                return taskType;\r\n            }\r\n        }\r\n    }\r\n    \r\n    return TASK_TYPES.GENERAL;\r\n}\r\n\r\n// ============================================================================\r\n// Task-Specific System Prompts\r\n// ============================================================================\r\nconst TASK_PROMPTS = {\r\n    [TASK_TYPES.FORMULA]: `You are an Excel Formula Expert. Your specialty is creating precise, efficient Excel formulas.\r\n\r\n## YOUR EXPERTISE\r\n- All Excel functions: SUM, AVERAGE, VLOOKUP, XLOOKUP, INDEX/MATCH, IF, SUMIF, COUNTIF, etc.\r\n- Array formulas and dynamic arrays\r\n- Nested functions and complex logic\r\n- Error handling with IFERROR, IFNA\r\n- Date/time calculations\r\n- Text manipulation functions\r\n\r\n## FORMULA BEST PRACTICES\r\n1. Use XLOOKUP over VLOOKUP when possible (more flexible)\r\n2. Prefer INDEX/MATCH for complex lookups\r\n3. Always wrap lookups in IFERROR for robustness\r\n4. Use structured references when working with tables\r\n5. Consider performance for large datasets\r\n\r\n## CRITICAL: DATA CLEANING IN-PLACE\r\n**NEVER apply formulas to the same column they reference (causes circular reference)!**\r\n\r\nWhen cleaning/converting data (TRIM, UPPER, LOWER, PROPER, etc.):\r\n- **WRONG**: Apply =TRIM(C2) to C2 or =PROPER(D2) to D2 (circular reference!)\r\n- **RIGHT**: Apply formula to a NEW column (like H2), then use copyValues to replace\r\n\r\nExample for \"Convert City to Proper Case\":\r\nStep 1 - Create formulas in helper column:\r\n<ACTION type=\"formula\" target=\"H2:H51\">\r\n=PROPER(D2)\r\n</ACTION>\r\n\r\nStep 2 - Copy values back to original column:\r\n<ACTION type=\"copyValues\" target=\"D2\" source=\"H2:H51\">\r\n</ACTION>\r\n\r\n**ALWAYS use both steps for data cleaning/conversion!**\r\n\r\n## OUTPUT FORMAT\r\nAlways provide formulas in ACTION tags:\r\n<ACTION type=\"formula\" target=\"CELL\">\r\n=YOUR_FORMULA\r\n</ACTION>\r\n\r\nExplain what the formula does and why you chose this approach.`,\r\n\r\n    [TASK_TYPES.CHART]: `You are an Excel Data Visualization Expert. Your specialty is creating effective charts.\r\n\r\n## YOUR EXPERTISE\r\n- Choosing the right chart type for the data\r\n- Chart design and formatting\r\n- Data storytelling through visuals\r\n- Dashboard creation\r\n\r\n## CHART SELECTION GUIDE\r\n- **Column/Bar**: Comparing categories\r\n- **Line**: Trends over time (use for trend analysis)\r\n- **Pie/Doughnut**: Parts of a whole (use sparingly, max 5-7 slices)\r\n- **Scatter**: Correlation between variables\r\n- **Area**: Cumulative totals over time\r\n- **Combo**: Multiple data types on one chart\r\n\r\n## CRITICAL CHART RULES\r\n1. **ALWAYS use CONTIGUOUS ranges** - e.g., A1:B10, NOT A1:A10,C1:C10\r\n2. For trend analysis with non-adjacent columns, include ALL columns between them\r\n3. If data columns are far apart, use the full data range (e.g., A1:G100)\r\n4. Include headers in the first row for proper labels\r\n5. For line/trend charts, ensure date/time is in the first column of the range\r\n\r\n## OUTPUT FORMAT\r\n<ACTION type=\"chart\" target=\"DATARANGE\" chartType=\"TYPE\" title=\"TITLE\" position=\"CELL\">\r\n</ACTION>\r\n\r\nExample for trend: target=\"A1:G100\" (full range), NOT \"B1:B100,G1:G100\"\r\n\r\nAlways explain why you chose this chart type and what story it tells.`,\r\n\r\n    [TASK_TYPES.ANALYSIS]: `You are an Excel Data Analyst. Your specialty is extracting insights from data.\r\n\r\n## YOUR EXPERTISE\r\n- Statistical analysis (mean, median, mode, std dev)\r\n- Trend identification\r\n- Outlier detection\r\n- Data quality assessment\r\n- Pattern recognition\r\n- Comparative analysis\r\n\r\n## ANALYSIS APPROACH\r\n1. First, understand the data structure\r\n2. Identify key metrics and dimensions\r\n3. Look for patterns, trends, anomalies\r\n4. Provide actionable insights\r\n5. Suggest visualizations if helpful\r\n\r\n## OUTPUT FORMAT\r\nProvide your analysis in clear sections:\r\n- **Overview**: What the data represents\r\n- **Key Findings**: Most important insights\r\n- **Statistics**: Relevant numbers\r\n- **Recommendations**: Suggested actions\r\n\r\nIf formulas or charts would help, include them in ACTION tags.`,\r\n\r\n    [TASK_TYPES.FORMAT]: `You are an Excel Formatting Expert. Your specialty is making data visually clear and professional.\r\n\r\n## YOUR EXPERTISE\r\n- Professional table styling\r\n- Conditional formatting rules\r\n- Color schemes and accessibility\r\n- Data presentation best practices\r\n\r\n## FORMATTING BEST PRACTICES\r\n1. Use consistent color schemes\r\n2. Headers should stand out (bold, background color)\r\n3. Align numbers right, text left\r\n4. Use borders sparingly\r\n5. Consider colorblind-friendly palettes\r\n\r\n## OUTPUT FORMAT\r\n<ACTION type=\"format\" target=\"RANGE\">\r\n{\"bold\":true,\"fill\":\"#4472C4\",\"fontColor\":\"#FFFFFF\"}\r\n</ACTION>\r\n\r\nAvailable format options: bold, italic, fill, fontColor, fontSize, numberFormat, border`,\r\n\r\n    [TASK_TYPES.VALIDATION]: `You are an Excel Data Validation Expert. Your specialty is creating dropdowns and input controls.\r\n\r\n## YOUR EXPERTISE\r\n- Data validation rules\r\n- Dropdown lists from ranges\r\n- Input restrictions\r\n- Error messages and input prompts\r\n\r\n## VALIDATION BEST PRACTICES\r\n1. Use source ranges for dynamic dropdowns\r\n2. Provide clear error messages\r\n3. Consider dependent dropdowns for hierarchical data\r\n\r\n## OUTPUT FORMAT\r\n<ACTION type=\"validation\" target=\"CELL\" source=\"DATARANGE\">\r\n</ACTION>\r\n\r\nThe source should be the range containing the list values.`,\r\n\r\n    [TASK_TYPES.DATA_ENTRY]: `You are an Excel Data Entry Assistant. Your specialty is efficiently populating cells.\r\n\r\n## YOUR EXPERTISE\r\n- Bulk data entry\r\n- Pattern-based filling\r\n- Data transformation\r\n- Autofill sequences\r\n\r\n## REPLACING FORMULA RESULTS WITH VALUES\r\nIf user asks to \"replace original with updated values\" or \"copy values back\":\r\nUse copyValues action (NOT values action):\r\n<ACTION type=\"copyValues\" target=\"A2\" source=\"F2:F51\">\r\n</ACTION>\r\n\r\nThis copies only the calculated values (not formulas) from source to target.\r\n\r\n## OUTPUT FORMAT FOR NEW DATA\r\n<ACTION type=\"values\" target=\"RANGE\">\r\n[[\"value1\",\"value2\"],[\"value3\",\"value4\"]]\r\n</ACTION>\r\n\r\nValues should be a 2D array matching the target range dimensions.`,\r\n\r\n    [TASK_TYPES.GENERAL]: `You are Excel Copilot, a versatile Excel assistant.\r\n\r\n## YOUR CAPABILITIES\r\n- Create formulas and functions\r\n- Build charts and visualizations\r\n- Analyze data and provide insights\r\n- Format cells and tables\r\n- Set up data validation\r\n- Automate repetitive tasks\r\n\r\nDetermine what the user needs and provide the most helpful response.`\r\n};\r\n\r\n/**\r\n * Gets the task-specific system prompt\r\n * @param {string} taskType - Detected task type\r\n * @param {Object} corrections - User corrections to incorporate\r\n * @returns {string} Complete system prompt\r\n */\r\nfunction getTaskSpecificPrompt(taskType, corrections = {}) {\r\n    const basePrompt = TASK_PROMPTS[taskType] || TASK_PROMPTS[TASK_TYPES.GENERAL];\r\n    \r\n    // Add corrections context if any\r\n    let correctionsContext = \"\";\r\n    if (Object.keys(corrections).length > 0) {\r\n        correctionsContext = \"\\n\\n## USER PREFERENCES (from past corrections)\\n\";\r\n        for (const [key, value] of Object.entries(corrections)) {\r\n            correctionsContext += `- ${key}: ${value}\\n`;\r\n        }\r\n        correctionsContext += \"\\nAlways apply these preferences unless explicitly told otherwise.\";\r\n    }\r\n    \r\n    return basePrompt + correctionsContext + getCommonRules();\r\n}\r\n\r\n/**\r\n * Common rules appended to all prompts\r\n */\r\nfunction getCommonRules() {\r\n    return `\r\n\r\n## CRITICAL RULES\r\n1. **CHECK THE COLUMN STRUCTURE TABLE** - Find the exact column letter for each header name\r\n2. **Data starts at row 2** (row 1 is headers)\r\n3. Always verify column letters before creating formulas\r\n4. Use the exact cell references from the data context\r\n\r\n## ACTION TYPES REFERENCE\r\n- formula: <ACTION type=\"formula\" target=\"CELL\">=FORMULA</ACTION>\r\n- values: <ACTION type=\"values\" target=\"RANGE\">[[\"val\"]]</ACTION>\r\n- format: <ACTION type=\"format\" target=\"RANGE\">{\"bold\":true}</ACTION>\r\n- conditionalFormat: <ACTION type=\"conditionalFormat\" target=\"RANGE\">{\"type\":\"cellValue\",\"operator\":\"GreaterThan\",\"value\":\"40\",\"fill\":\"#FFFF00\"}</ACTION>\r\n- chart: <ACTION type=\"chart\" target=\"RANGE\" chartType=\"TYPE\" title=\"TITLE\" position=\"CELL\"></ACTION>\r\n- validation: <ACTION type=\"validation\" target=\"CELL\" source=\"RANGE\"></ACTION>\r\n- sort: <ACTION type=\"sort\" target=\"DATARANGE\">{\"column\":1,\"ascending\":true}</ACTION>\r\n- filter: <ACTION type=\"filter\" target=\"DATARANGE\">{\"column\":2,\"values\":[\"Mumbai\"]}</ACTION>\r\n- clearFilter: <ACTION type=\"clearFilter\" target=\"DATARANGE\"></ACTION>\r\n- removeDuplicates: <ACTION type=\"removeDuplicates\" target=\"DATARANGE\">{\"columns\":[0,1,2]}</ACTION>\r\n- copy: <ACTION type=\"copy\" target=\"DESTINATION\" source=\"SOURCE\"></ACTION>\r\n- copyValues: <ACTION type=\"copyValues\" target=\"DESTINATION\" source=\"SOURCE\"></ACTION>\r\n\r\n## CONDITIONAL FORMATTING\r\n**CRITICAL: For multiple conditions on the same range, use a SINGLE ACTION with an ARRAY of rules!**\r\n\r\nSingle condition:\r\n<ACTION type=\"conditionalFormat\" target=\"C2:C51\">\r\n{\"type\":\"cellValue\",\"operator\":\"GreaterThan\",\"value\":\"40\",\"fill\":\"#FFFF00\"}\r\n</ACTION>\r\n\r\n**Multiple conditions (CORRECT WAY - use array):**\r\n<ACTION type=\"conditionalFormat\" target=\"E2:E51\">\r\n[\r\n  {\"type\":\"cellValue\",\"operator\":\"GreaterThan\",\"value\":\"70\",\"fill\":\"#00FF00\"},\r\n  {\"type\":\"cellValue\",\"operator\":\"Between\",\"value\":\"40\",\"value2\":\"70\",\"fill\":\"#FFFF00\"},\r\n  {\"type\":\"cellValue\",\"operator\":\"LessThan\",\"value\":\"40\",\"fill\":\"#FF0000\"}\r\n]\r\n</ACTION>\r\n\r\nTo REMOVE/CLEAR conditional formatting:\r\n<ACTION type=\"clearFormat\" target=\"C2:C51\">\r\n</ACTION>\r\n\r\nOperators: \"GreaterThan\", \"LessThan\", \"EqualTo\", \"NotEqualTo\", \"GreaterThanOrEqual\", \"LessThanOrEqual\", \"Between\"\r\nColors: Use hex codes like \"#FFFF00\" (yellow), \"#FF0000\" (red), \"#00FF00\" (green)\r\n**Note:** For \"Between\" operator, use both \"value\" and \"value2\" properties\r\n\r\n## SORTING DATA\r\nTo sort data, use the sort action type (NOT formulas like SORT()):\r\n<ACTION type=\"sort\" target=\"A1:L51\">\r\n{\"column\":1,\"ascending\":true}\r\n</ACTION>\r\n\r\n- target: The full data range including headers (e.g., A1:L51)\r\n- column: 0-based index of the column to sort by (0=first column, 1=second, etc.)\r\n- ascending: true for A-Z/smallest first, false for Z-A/largest first\r\n\r\n## FILTERING DATA\r\nTo apply AutoFilter and filter by specific values:\r\n<ACTION type=\"filter\" target=\"A1:L51\">\r\n{\"column\":2,\"values\":[\"Mumbai\",\"Delhi\"]}\r\n</ACTION>\r\n\r\n- target: The full data range including headers (e.g., A1:L51)\r\n- column: 0-based index of the column to filter by (0=first column, 1=second, etc.)\r\n- values: Array of values to show (all other values will be hidden)\r\n\r\nTo REMOVE/CLEAR all filters and show all data:\r\n<ACTION type=\"clearFilter\" target=\"A1:L51\">\r\n</ACTION>\r\n\r\n**Note:** Use clearFilter when user says \"remove filter\", \"clear filter\", \"show all data\", or \"remove filtering\".\r\n\r\n## COPYING DATA\r\nTo copy formulas and formatting from one range to another:\r\n<ACTION type=\"copy\" target=\"A52\" source=\"A1:L51\">\r\n</ACTION>\r\n\r\nTo copy ONLY VALUES (no formulas) - useful for replacing original data with cleaned values:\r\n<ACTION type=\"copyValues\" target=\"A2\" source=\"F2:F51\">\r\n</ACTION>\r\n\r\n- source: The range to copy FROM\r\n- target: The starting cell to paste TO (top-left corner of destination)\r\n- Use \"copyValues\" when replacing original data with formula results (e.g., after TRIM, UPPER, etc.)\r\n\r\n## REMOVING DUPLICATES\r\nTo remove duplicate rows from a range:\r\n<ACTION type=\"removeDuplicates\" target=\"A1:E86\">\r\n{\"columns\":[0,1,2,3,4]}\r\n</ACTION>\r\n\r\n- target: The data range including headers\r\n- columns: Array of 0-based column indices to check for duplicates (e.g., [0,1,2] checks first 3 columns)\r\n- Keeps the first occurrence of each unique row\r\n- Removes all subsequent duplicates\r\n\r\n## CREATING SHEETS\r\nTo create a new sheet:\r\n<ACTION type=\"sheet\" target=\"SheetName\">\r\n</ACTION>\r\n\r\n- target: The name of the new sheet to create\r\n- data: (optional) JSON array of values to populate the sheet\r\n\r\nExample: Create a sheet named \"Summary\":\r\n<ACTION type=\"sheet\" target=\"Summary\">\r\n</ACTION>`;\r\n}\r\n\r\n// ============================================================================\r\n// Function Calling - Direct Excel Operations\r\n// ============================================================================\r\nconst EXCEL_FUNCTIONS = {\r\n    // Aggregation functions\r\n    SUM: {\r\n        description: \"Add numbers in a range\",\r\n        signature: \"SUM(range)\",\r\n        example: \"=SUM(A1:A10)\"\r\n    },\r\n    AVERAGE: {\r\n        description: \"Calculate average of numbers\",\r\n        signature: \"AVERAGE(range)\",\r\n        example: \"=AVERAGE(B2:B100)\"\r\n    },\r\n    COUNT: {\r\n        description: \"Count cells with numbers\",\r\n        signature: \"COUNT(range)\",\r\n        example: \"=COUNT(C1:C50)\"\r\n    },\r\n    COUNTA: {\r\n        description: \"Count non-empty cells\",\r\n        signature: \"COUNTA(range)\",\r\n        example: \"=COUNTA(A:A)\"\r\n    },\r\n    MAX: {\r\n        description: \"Find maximum value\",\r\n        signature: \"MAX(range)\",\r\n        example: \"=MAX(D2:D100)\"\r\n    },\r\n    MIN: {\r\n        description: \"Find minimum value\",\r\n        signature: \"MIN(range)\",\r\n        example: \"=MIN(D2:D100)\"\r\n    },\r\n    \r\n    // Lookup functions\r\n    VLOOKUP: {\r\n        description: \"Vertical lookup\",\r\n        signature: \"VLOOKUP(lookup_value, table_array, col_index, [range_lookup])\",\r\n        example: \"=VLOOKUP(A2, Sheet2!A:D, 3, FALSE)\"\r\n    },\r\n    XLOOKUP: {\r\n        description: \"Modern flexible lookup\",\r\n        signature: \"XLOOKUP(lookup_value, lookup_array, return_array, [if_not_found])\",\r\n        example: \"=XLOOKUP(A2, B:B, C:C, \\\"Not found\\\")\"\r\n    },\r\n    INDEX: {\r\n        description: \"Return value at position\",\r\n        signature: \"INDEX(array, row_num, [col_num])\",\r\n        example: \"=INDEX(A1:C10, 5, 2)\"\r\n    },\r\n    MATCH: {\r\n        description: \"Find position of value\",\r\n        signature: \"MATCH(lookup_value, lookup_array, [match_type])\",\r\n        example: \"=MATCH(\\\"Apple\\\", A:A, 0)\"\r\n    },\r\n    \r\n    // Conditional functions\r\n    IF: {\r\n        description: \"Conditional logic\",\r\n        signature: \"IF(condition, value_if_true, value_if_false)\",\r\n        example: \"=IF(A1>100, \\\"High\\\", \\\"Low\\\")\"\r\n    },\r\n    SUMIF: {\r\n        description: \"Sum with condition\",\r\n        signature: \"SUMIF(range, criteria, [sum_range])\",\r\n        example: \"=SUMIF(A:A, \\\"Sales\\\", B:B)\"\r\n    },\r\n    COUNTIF: {\r\n        description: \"Count with condition\",\r\n        signature: \"COUNTIF(range, criteria)\",\r\n        example: \"=COUNTIF(A:A, \\\">100\\\")\"\r\n    },\r\n    SUMIFS: {\r\n        description: \"Sum with multiple conditions\",\r\n        signature: \"SUMIFS(sum_range, criteria_range1, criteria1, ...)\",\r\n        example: \"=SUMIFS(C:C, A:A, \\\"Sales\\\", B:B, \\\">2023\\\")\"\r\n    },\r\n    \r\n    // Text functions\r\n    CONCATENATE: {\r\n        description: \"Join text strings\",\r\n        signature: \"CONCATENATE(text1, text2, ...)\",\r\n        example: \"=CONCATENATE(A1, \\\" \\\", B1)\"\r\n    },\r\n    LEFT: {\r\n        description: \"Extract left characters\",\r\n        signature: \"LEFT(text, num_chars)\",\r\n        example: \"=LEFT(A1, 3)\"\r\n    },\r\n    RIGHT: {\r\n        description: \"Extract right characters\",\r\n        signature: \"RIGHT(text, num_chars)\",\r\n        example: \"=RIGHT(A1, 4)\"\r\n    },\r\n    MID: {\r\n        description: \"Extract middle characters\",\r\n        signature: \"MID(text, start_num, num_chars)\",\r\n        example: \"=MID(A1, 2, 5)\"\r\n    },\r\n    TRIM: {\r\n        description: \"Remove extra spaces\",\r\n        signature: \"TRIM(text)\",\r\n        example: \"=TRIM(A1)\"\r\n    },\r\n    UPPER: {\r\n        description: \"Convert to uppercase\",\r\n        signature: \"UPPER(text)\",\r\n        example: \"=UPPER(A1)\"\r\n    },\r\n    LOWER: {\r\n        description: \"Convert to lowercase\",\r\n        signature: \"LOWER(text)\",\r\n        example: \"=LOWER(A1)\"\r\n    },\r\n    \r\n    // Date functions\r\n    TODAY: {\r\n        description: \"Current date\",\r\n        signature: \"TODAY()\",\r\n        example: \"=TODAY()\"\r\n    },\r\n    NOW: {\r\n        description: \"Current date and time\",\r\n        signature: \"NOW()\",\r\n        example: \"=NOW()\"\r\n    },\r\n    YEAR: {\r\n        description: \"Extract year from date\",\r\n        signature: \"YEAR(date)\",\r\n        example: \"=YEAR(A1)\"\r\n    },\r\n    MONTH: {\r\n        description: \"Extract month from date\",\r\n        signature: \"MONTH(date)\",\r\n        example: \"=MONTH(A1)\"\r\n    },\r\n    DAY: {\r\n        description: \"Extract day from date\",\r\n        signature: \"DAY(date)\",\r\n        example: \"=DAY(A1)\"\r\n    },\r\n    DATEDIF: {\r\n        description: \"Difference between dates\",\r\n        signature: \"DATEDIF(start_date, end_date, unit)\",\r\n        example: \"=DATEDIF(A1, B1, \\\"D\\\")\"\r\n    },\r\n    \r\n    // Error handling\r\n    IFERROR: {\r\n        description: \"Handle errors gracefully\",\r\n        signature: \"IFERROR(value, value_if_error)\",\r\n        example: \"=IFERROR(A1/B1, 0)\"\r\n    },\r\n    IFNA: {\r\n        description: \"Handle #N/A errors\",\r\n        signature: \"IFNA(value, value_if_na)\",\r\n        example: \"=IFNA(VLOOKUP(...), \\\"Not found\\\")\"\r\n    }\r\n};\r\n\r\n/**\r\n * Generates function calling context for the AI\r\n * @returns {string} Function definitions for AI context\r\n */\r\nfunction getFunctionCallingContext() {\r\n    let context = \"\\n\\n## AVAILABLE EXCEL FUNCTIONS\\n\";\r\n    context += \"You can use these functions directly. Here are the most common ones:\\n\\n\";\r\n    \r\n    const categories = {\r\n        \"Aggregation\": [\"SUM\", \"AVERAGE\", \"COUNT\", \"COUNTA\", \"MAX\", \"MIN\"],\r\n        \"Lookup\": [\"VLOOKUP\", \"XLOOKUP\", \"INDEX\", \"MATCH\"],\r\n        \"Conditional\": [\"IF\", \"SUMIF\", \"COUNTIF\", \"SUMIFS\"],\r\n        \"Text\": [\"CONCATENATE\", \"LEFT\", \"RIGHT\", \"MID\", \"TRIM\"],\r\n        \"Date\": [\"TODAY\", \"NOW\", \"YEAR\", \"MONTH\", \"DAY\"],\r\n        \"Error Handling\": [\"IFERROR\", \"IFNA\"]\r\n    };\r\n    \r\n    for (const [category, funcs] of Object.entries(categories)) {\r\n        context += `### ${category}\\n`;\r\n        for (const func of funcs) {\r\n            const def = EXCEL_FUNCTIONS[func];\r\n            if (def) {\r\n                context += `- **${func}**: ${def.description}\\n`;\r\n                context += `  Syntax: \\`${def.signature}\\`\\n`;\r\n            }\r\n        }\r\n        context += \"\\n\";\r\n    }\r\n    \r\n    return context;\r\n}\r\n\r\n/**\r\n * Parses function calls from AI response and converts to actions\r\n * @param {string} response - AI response text\r\n * @returns {Object[]} Parsed function calls as actions\r\n */\r\nfunction parseFunctionCalls(response) {\r\n    const functionCalls = [];\r\n    \r\n    // Pattern: CALL_FUNCTION(name, target, args)\r\n    const callPattern = /CALL_FUNCTION\\s*\\(\\s*\"?(\\w+)\"?\\s*,\\s*\"?([A-Z]+\\d+(?::[A-Z]+\\d+)?)\"?\\s*(?:,\\s*(.+?))?\\s*\\)/gi;\r\n    \r\n    let match;\r\n    while ((match = callPattern.exec(response)) !== null) {\r\n        const funcName = match[1].toUpperCase();\r\n        const target = match[2];\r\n        const args = match[3] ? match[3].trim() : \"\";\r\n        \r\n        if (EXCEL_FUNCTIONS[funcName]) {\r\n            functionCalls.push({\r\n                type: \"formula\",\r\n                target: target,\r\n                data: `=${funcName}(${args})`\r\n            });\r\n        }\r\n    }\r\n    \r\n    return functionCalls;\r\n}\r\n\r\n// ============================================================================\r\n// RAG - Pattern Knowledge Base\r\n// ============================================================================\r\nconst FORMULA_PATTERNS = [\r\n    // Aggregation patterns\r\n    {\r\n        id: \"sum_column\",\r\n        keywords: [\"sum\", \"total\", \"add up\", \"add all\"],\r\n        pattern: \"=SUM({range})\",\r\n        description: \"Sum all values in a column\",\r\n        example: \"=SUM(B2:B100)\"\r\n    },\r\n    {\r\n        id: \"average_column\",\r\n        keywords: [\"average\", \"mean\", \"avg\"],\r\n        pattern: \"=AVERAGE({range})\",\r\n        description: \"Calculate average of values\",\r\n        example: \"=AVERAGE(C2:C100)\"\r\n    },\r\n    {\r\n        id: \"count_values\",\r\n        keywords: [\"count\", \"how many\", \"number of\"],\r\n        pattern: \"=COUNTA({range})\",\r\n        description: \"Count non-empty cells\",\r\n        example: \"=COUNTA(A2:A100)\"\r\n    },\r\n    \r\n    // Conditional patterns\r\n    {\r\n        id: \"sumif_category\",\r\n        keywords: [\"sum by\", \"total for\", \"sum where\", \"sum if\"],\r\n        pattern: \"=SUMIF({criteria_range}, \\\"{criteria}\\\", {sum_range})\",\r\n        description: \"Sum values matching a condition\",\r\n        example: \"=SUMIF(A:A, \\\"Sales\\\", B:B)\"\r\n    },\r\n    {\r\n        id: \"countif_condition\",\r\n        keywords: [\"count where\", \"count if\", \"how many have\"],\r\n        pattern: \"=COUNTIF({range}, \\\"{criteria}\\\")\",\r\n        description: \"Count cells matching condition\",\r\n        example: \"=COUNTIF(A:A, \\\"Complete\\\")\"\r\n    },\r\n    {\r\n        id: \"if_condition\",\r\n        keywords: [\"if then\", \"when\", \"check if\", \"condition\"],\r\n        pattern: \"=IF({condition}, \\\"{true_value}\\\", \\\"{false_value}\\\")\",\r\n        description: \"Return different values based on condition\",\r\n        example: \"=IF(A1>100, \\\"High\\\", \\\"Low\\\")\"\r\n    },\r\n    \r\n    // Lookup patterns\r\n    {\r\n        id: \"vlookup_basic\",\r\n        keywords: [\"lookup\", \"find\", \"get value\", \"vlookup\"],\r\n        pattern: \"=VLOOKUP({lookup_value}, {table}, {col_index}, FALSE)\",\r\n        description: \"Look up a value in a table\",\r\n        example: \"=VLOOKUP(A2, Products!A:C, 2, FALSE)\"\r\n    },\r\n    {\r\n        id: \"xlookup_modern\",\r\n        keywords: [\"xlookup\", \"modern lookup\", \"flexible lookup\"],\r\n        pattern: \"=XLOOKUP({lookup_value}, {lookup_array}, {return_array}, \\\"Not found\\\")\",\r\n        description: \"Modern flexible lookup\",\r\n        example: \"=XLOOKUP(A2, B:B, C:C, \\\"Not found\\\")\"\r\n    },\r\n    {\r\n        id: \"index_match\",\r\n        keywords: [\"index match\", \"two-way lookup\", \"flexible lookup\"],\r\n        pattern: \"=INDEX({return_range}, MATCH({lookup_value}, {lookup_range}, 0))\",\r\n        description: \"Flexible lookup using INDEX/MATCH\",\r\n        example: \"=INDEX(C:C, MATCH(A2, B:B, 0))\"\r\n    },\r\n    \r\n    // Percentage patterns\r\n    {\r\n        id: \"percentage\",\r\n        keywords: [\"percentage\", \"percent\", \"%\", \"ratio\"],\r\n        pattern: \"={value}/{total}\",\r\n        description: \"Calculate percentage\",\r\n        example: \"=B2/SUM(B:B)\"\r\n    },\r\n    {\r\n        id: \"percentage_change\",\r\n        keywords: [\"change\", \"growth\", \"increase\", \"decrease\"],\r\n        pattern: \"=({new_value}-{old_value})/{old_value}\",\r\n        description: \"Calculate percentage change\",\r\n        example: \"=(B2-A2)/A2\"\r\n    },\r\n    \r\n    // Text patterns\r\n    {\r\n        id: \"concat_text\",\r\n        keywords: [\"combine\", \"join\", \"concatenate\", \"merge text\"],\r\n        pattern: \"=CONCATENATE({text1}, \\\" \\\", {text2})\",\r\n        description: \"Join text values\",\r\n        example: \"=CONCATENATE(A1, \\\" \\\", B1)\"\r\n    },\r\n    {\r\n        id: \"extract_text\",\r\n        keywords: [\"extract\", \"get part\", \"substring\"],\r\n        pattern: \"=MID({text}, {start}, {length})\",\r\n        description: \"Extract part of text\",\r\n        example: \"=MID(A1, 1, 5)\"\r\n    },\r\n    \r\n    // Date patterns\r\n    {\r\n        id: \"date_diff\",\r\n        keywords: [\"days between\", \"date difference\", \"how long\"],\r\n        pattern: \"=DATEDIF({start_date}, {end_date}, \\\"D\\\")\",\r\n        description: \"Calculate days between dates\",\r\n        example: \"=DATEDIF(A1, B1, \\\"D\\\")\"\r\n    },\r\n    {\r\n        id: \"current_date\",\r\n        keywords: [\"today\", \"current date\", \"now\"],\r\n        pattern: \"=TODAY()\",\r\n        description: \"Get current date\",\r\n        example: \"=TODAY()\"\r\n    },\r\n    \r\n    // Error handling patterns\r\n    {\r\n        id: \"safe_divide\",\r\n        keywords: [\"divide\", \"safe division\", \"avoid error\"],\r\n        pattern: \"=IFERROR({numerator}/{denominator}, 0)\",\r\n        description: \"Safe division avoiding #DIV/0!\",\r\n        example: \"=IFERROR(A1/B1, 0)\"\r\n    },\r\n    {\r\n        id: \"safe_lookup\",\r\n        keywords: [\"safe lookup\", \"handle not found\"],\r\n        pattern: \"=IFERROR(VLOOKUP({value}, {range}, {col}, FALSE), \\\"Not found\\\")\",\r\n        description: \"Lookup with error handling\",\r\n        example: \"=IFERROR(VLOOKUP(A1, B:C, 2, FALSE), \\\"Not found\\\")\"\r\n    }\r\n];\r\n\r\n/**\r\n * Searches for relevant patterns based on user query\r\n * @param {string} query - User's request\r\n * @param {number} limit - Max patterns to return\r\n * @returns {Object[]} Matching patterns\r\n */\r\nfunction searchPatterns(query, limit = 5) {\r\n    const lower = query.toLowerCase();\r\n    const scored = [];\r\n    \r\n    for (const pattern of FORMULA_PATTERNS) {\r\n        let score = 0;\r\n        \r\n        // Check keyword matches\r\n        for (const keyword of pattern.keywords) {\r\n            if (lower.includes(keyword)) {\r\n                score += 10;\r\n            }\r\n        }\r\n        \r\n        // Check description match\r\n        if (pattern.description.toLowerCase().split(\" \").some(w => lower.includes(w))) {\r\n            score += 5;\r\n        }\r\n        \r\n        if (score > 0) {\r\n            scored.push({ ...pattern, score });\r\n        }\r\n    }\r\n    \r\n    // Sort by score and return top matches\r\n    return scored\r\n        .sort((a, b) => b.score - a.score)\r\n        .slice(0, limit);\r\n}\r\n\r\n/**\r\n * Gets RAG context for the AI based on user query\r\n * @param {string} query - User's request\r\n * @returns {string} RAG context with relevant patterns\r\n */\r\nfunction getRAGContext(query) {\r\n    const patterns = searchPatterns(query);\r\n    \r\n    if (patterns.length === 0) {\r\n        return \"\";\r\n    }\r\n    \r\n    let context = \"\\n\\n## RELEVANT FORMULA PATTERNS\\n\";\r\n    context += \"Based on your request, here are some useful patterns:\\n\\n\";\r\n    \r\n    for (const pattern of patterns) {\r\n        context += `### ${pattern.description}\\n`;\r\n        context += `Pattern: \\`${pattern.pattern}\\`\\n`;\r\n        context += `Example: \\`${pattern.example}\\`\\n\\n`;\r\n    }\r\n    \r\n    return context;\r\n}\r\n\r\n/**\r\n * Adds a custom pattern to the knowledge base\r\n * @param {Object} pattern - Pattern to add\r\n */\r\nfunction addCustomPattern(pattern) {\r\n    const stored = JSON.parse(localStorage.getItem(AI_CONFIG.PATTERNS_KEY) || \"[]\");\r\n    stored.push({\r\n        ...pattern,\r\n        id: `custom_${Date.now()}`,\r\n        custom: true\r\n    });\r\n    \r\n    // Keep only recent patterns\r\n    if (stored.length > AI_CONFIG.MAX_PATTERNS) {\r\n        stored.splice(0, stored.length - AI_CONFIG.MAX_PATTERNS);\r\n    }\r\n    \r\n    localStorage.setItem(AI_CONFIG.PATTERNS_KEY, JSON.stringify(stored));\r\n}\r\n\r\n/**\r\n * Gets all patterns including custom ones\r\n * @returns {Object[]} All patterns\r\n */\r\nfunction getAllPatterns() {\r\n    const custom = JSON.parse(localStorage.getItem(AI_CONFIG.PATTERNS_KEY) || \"[]\");\r\n    return [...FORMULA_PATTERNS, ...custom];\r\n}\r\n\r\n// ============================================================================\r\n// Multi-Step Reasoning\r\n// ============================================================================\r\nconst REASONING_STEPS = {\r\n    ANALYZE: \"analyze\",\r\n    PLAN: \"plan\",\r\n    EXECUTE: \"execute\",\r\n    VERIFY: \"verify\"\r\n};\r\n\r\n/**\r\n * Determines if a task requires multi-step reasoning\r\n * @param {string} prompt - User's request\r\n * @returns {boolean} True if complex task\r\n */\r\nfunction requiresMultiStep(prompt) {\r\n    const complexIndicators = [\r\n        \"and then\", \"after that\", \"multiple\", \"several\", \"all columns\",\r\n        \"each row\", \"entire\", \"whole\", \"complex\", \"advanced\",\r\n        \"step by step\", \"breakdown\", \"analyze and\", \"create and\"\r\n    ];\r\n    \r\n    const lower = prompt.toLowerCase();\r\n    return complexIndicators.some(ind => lower.includes(ind)) || prompt.length > 200;\r\n}\r\n\r\n/**\r\n * Breaks down a complex task into steps\r\n * @param {string} prompt - User's request\r\n * @param {Object} dataContext - Current Excel data context\r\n * @returns {Object[]} Array of steps\r\n */\r\nfunction decomposeTask(prompt, dataContext) {\r\n    const steps = [];\r\n    const lower = prompt.toLowerCase();\r\n    \r\n    // Step 1: Always analyze first\r\n    steps.push({\r\n        step: REASONING_STEPS.ANALYZE,\r\n        description: \"Understand the data structure and user intent\",\r\n        prompt: `First, analyze the data:\r\n- What columns are available?\r\n- What is the data type of each column?\r\n- What is the user trying to achieve?`\r\n    });\r\n    \r\n    // Step 2: Plan based on task type\r\n    const taskType = detectTaskType(prompt);\r\n    \r\n    if (taskType === TASK_TYPES.FORMULA) {\r\n        steps.push({\r\n            step: REASONING_STEPS.PLAN,\r\n            description: \"Determine the formula approach\",\r\n            prompt: `Plan the formula:\r\n- Which Excel function(s) are needed?\r\n- What are the exact cell references?\r\n- Are there any edge cases to handle?`\r\n        });\r\n    } else if (taskType === TASK_TYPES.CHART) {\r\n        steps.push({\r\n            step: REASONING_STEPS.PLAN,\r\n            description: \"Design the visualization\",\r\n            prompt: `Plan the chart:\r\n- What chart type best represents this data?\r\n- What should be on each axis?\r\n- What title and labels are needed?`\r\n        });\r\n    } else if (taskType === TASK_TYPES.ANALYSIS) {\r\n        steps.push({\r\n            step: REASONING_STEPS.PLAN,\r\n            description: \"Plan the analysis approach\",\r\n            prompt: `Plan the analysis:\r\n- What metrics should be calculated?\r\n- What patterns should be looked for?\r\n- What insights would be valuable?`\r\n        });\r\n    }\r\n    \r\n    // Step 3: Execute\r\n    steps.push({\r\n        step: REASONING_STEPS.EXECUTE,\r\n        description: \"Generate the solution\",\r\n        prompt: `Now execute the plan:\r\n- Create the necessary ACTION tags\r\n- Use exact cell references from the data\r\n- Provide clear explanations`\r\n    });\r\n    \r\n    // Step 4: Verify (for complex tasks)\r\n    if (lower.includes(\"verify\") || lower.includes(\"check\") || prompt.length > 300) {\r\n        steps.push({\r\n            step: REASONING_STEPS.VERIFY,\r\n            description: \"Verify the solution\",\r\n            prompt: `Verify the solution:\r\n- Are all cell references correct?\r\n- Does the formula handle edge cases?\r\n- Is the output format appropriate?`\r\n        });\r\n    }\r\n    \r\n    return steps;\r\n}\r\n\r\n/**\r\n * Generates a multi-step reasoning prompt\r\n * @param {string} userPrompt - Original user request\r\n * @param {Object} dataContext - Excel data context\r\n * @returns {string} Enhanced prompt with reasoning structure\r\n */\r\nfunction generateReasoningPrompt(userPrompt, dataContext) {\r\n    if (!requiresMultiStep(userPrompt)) {\r\n        return userPrompt;\r\n    }\r\n    \r\n    const steps = decomposeTask(userPrompt, dataContext);\r\n    \r\n    let enhancedPrompt = `## TASK DECOMPOSITION\r\nThis is a complex task. Please follow these steps:\r\n\r\n`;\r\n    \r\n    for (let i = 0; i < steps.length; i++) {\r\n        enhancedPrompt += `### Step ${i + 1}: ${steps[i].description}\r\n${steps[i].prompt}\r\n\r\n`;\r\n    }\r\n    \r\n    enhancedPrompt += `## ORIGINAL REQUEST\r\n${userPrompt}\r\n\r\nPlease work through each step and provide your final solution with ACTION tags.`;\r\n    \r\n    return enhancedPrompt;\r\n}\r\n\r\n// ============================================================================\r\n// Learning from Corrections\r\n// ============================================================================\r\n\r\n/**\r\n * Stores a user correction for future reference\r\n * @param {string} original - What AI said/did\r\n * @param {string} correction - What user corrected to\r\n * @param {string} context - Additional context\r\n */\r\nfunction storeCorrection(original, correction, context = \"\") {\r\n    const corrections = getStoredCorrections();\r\n    \r\n    // Parse the correction to extract the key insight\r\n    const insight = parseCorrection(original, correction);\r\n    \r\n    if (insight) {\r\n        corrections.push({\r\n            id: Date.now(),\r\n            original,\r\n            correction,\r\n            insight,\r\n            context,\r\n            timestamp: new Date().toISOString()\r\n        });\r\n        \r\n        // Keep only recent corrections\r\n        if (corrections.length > AI_CONFIG.MAX_CORRECTIONS) {\r\n            corrections.splice(0, corrections.length - AI_CONFIG.MAX_CORRECTIONS);\r\n        }\r\n        \r\n        localStorage.setItem(AI_CONFIG.CORRECTIONS_KEY, JSON.stringify(corrections));\r\n    }\r\n}\r\n\r\n/**\r\n * Gets stored corrections\r\n * @returns {Object[]} Array of corrections\r\n */\r\nfunction getStoredCorrections() {\r\n    try {\r\n        return JSON.parse(localStorage.getItem(AI_CONFIG.CORRECTIONS_KEY) || \"[]\");\r\n    } catch {\r\n        return [];\r\n    }\r\n}\r\n\r\n/**\r\n * Parses a correction to extract the key insight\r\n * @param {string} original - Original text\r\n * @param {string} correction - Correction text\r\n * @returns {Object|null} Parsed insight\r\n */\r\nfunction parseCorrection(original, correction) {\r\n    const lower = correction.toLowerCase();\r\n    \r\n    // Column corrections: \"no, column E not C\" or \"use column E instead\"\r\n    const colMatch = lower.match(/column\\s+([a-z])\\s+(?:not|instead of|rather than)\\s+([a-z])/i);\r\n    if (colMatch) {\r\n        return {\r\n            type: \"column_preference\",\r\n            wrong: colMatch[2].toUpperCase(),\r\n            correct: colMatch[1].toUpperCase(),\r\n            rule: `Use column ${colMatch[1].toUpperCase()} instead of ${colMatch[2].toUpperCase()}`\r\n        };\r\n    }\r\n    \r\n    // Cell reference corrections: \"should be E2 not C2\"\r\n    const cellMatch = lower.match(/(?:should be|use)\\s+([a-z]+\\d+)\\s+(?:not|instead of)\\s+([a-z]+\\d+)/i);\r\n    if (cellMatch) {\r\n        return {\r\n            type: \"cell_preference\",\r\n            wrong: cellMatch[2].toUpperCase(),\r\n            correct: cellMatch[1].toUpperCase(),\r\n            rule: `Use ${cellMatch[1].toUpperCase()} instead of ${cellMatch[2].toUpperCase()}`\r\n        };\r\n    }\r\n    \r\n    // Header name corrections: \"the column is called X not Y\"\r\n    const headerMatch = lower.match(/(?:column is called|header is|named)\\s+[\"']?([^\"']+)[\"']?\\s+(?:not|instead of)\\s+[\"']?([^\"']+)[\"']?/i);\r\n    if (headerMatch) {\r\n        return {\r\n            type: \"header_preference\",\r\n            wrong: headerMatch[2].trim(),\r\n            correct: headerMatch[1].trim(),\r\n            rule: `The column \"${headerMatch[1].trim()}\" should be used (not \"${headerMatch[2].trim()}\")`\r\n        };\r\n    }\r\n    \r\n    // Format preferences: \"use currency format\" or \"format as percentage\"\r\n    const formatMatch = lower.match(/(?:use|format as|should be)\\s+(currency|percentage|date|number|text)/i);\r\n    if (formatMatch) {\r\n        return {\r\n            type: \"format_preference\",\r\n            format: formatMatch[1].toLowerCase(),\r\n            rule: `Format values as ${formatMatch[1].toLowerCase()}`\r\n        };\r\n    }\r\n    \r\n    // Chart preferences: \"use bar chart not pie\"\r\n    const chartMatch = lower.match(/(?:use|prefer)\\s+(bar|line|pie|column|scatter)\\s+(?:chart|graph)/i);\r\n    if (chartMatch) {\r\n        return {\r\n            type: \"chart_preference\",\r\n            chartType: chartMatch[1].toLowerCase(),\r\n            rule: `Prefer ${chartMatch[1].toLowerCase()} charts`\r\n        };\r\n    }\r\n    \r\n    // General preference\r\n    return {\r\n        type: \"general\",\r\n        rule: correction\r\n    };\r\n}\r\n\r\n/**\r\n * Detects if user message is a correction\r\n * @param {string} message - User's message\r\n * @returns {boolean} True if it's a correction\r\n */\r\nfunction isCorrection(message) {\r\n    const correctionIndicators = [\r\n        \"no,\", \"not\", \"wrong\", \"incorrect\", \"should be\", \"instead\",\r\n        \"actually\", \"i meant\", \"that's not\", \"use column\", \"the column is\"\r\n    ];\r\n    \r\n    const lower = message.toLowerCase().trim();\r\n    return correctionIndicators.some(ind => lower.startsWith(ind) || lower.includes(ind));\r\n}\r\n\r\n/**\r\n * Gets correction context for AI prompt\r\n * @returns {Object} Corrections organized by type\r\n */\r\nfunction getCorrectionContext() {\r\n    const corrections = getStoredCorrections();\r\n    const context = {};\r\n    \r\n    // Group by type and get most recent\r\n    for (const corr of corrections) {\r\n        if (corr.insight) {\r\n            const key = corr.insight.type;\r\n            if (!context[key]) {\r\n                context[key] = [];\r\n            }\r\n            context[key].push(corr.insight.rule);\r\n        }\r\n    }\r\n    \r\n    // Deduplicate and format\r\n    const formatted = {};\r\n    for (const [type, rules] of Object.entries(context)) {\r\n        formatted[type] = [...new Set(rules)].slice(-5).join(\"; \");\r\n    }\r\n    \r\n    return formatted;\r\n}\r\n\r\n/**\r\n * Clears all stored corrections\r\n */\r\nfunction clearCorrections() {\r\n    localStorage.removeItem(AI_CONFIG.CORRECTIONS_KEY);\r\n}\r\n\r\n// ============================================================================\r\n// Main AI Engine Interface\r\n// ============================================================================\r\n\r\n/**\r\n * Enhances a user prompt with all AI features\r\n * @param {string} userPrompt - Original user prompt\r\n * @param {Object} dataContext - Excel data context\r\n * @returns {Object} Enhanced prompt and system prompt\r\n */\r\nfunction enhancePrompt(userPrompt, dataContext) {\r\n    // Detect task type\r\n    const taskType = detectTaskType(userPrompt);\r\n    \r\n    // Check if this is a correction\r\n    const isCorrectionMsg = isCorrection(userPrompt);\r\n    \r\n    // Get corrections context\r\n    const corrections = getCorrectionContext();\r\n    \r\n    // Get task-specific system prompt\r\n    let systemPrompt = getTaskSpecificPrompt(taskType, corrections);\r\n    \r\n    // Add function calling context for formula tasks\r\n    if (taskType === TASK_TYPES.FORMULA) {\r\n        systemPrompt += getFunctionCallingContext();\r\n    }\r\n    \r\n    // Get RAG context\r\n    const ragContext = getRAGContext(userPrompt);\r\n    \r\n    // Apply multi-step reasoning if needed\r\n    let enhancedUserPrompt = userPrompt;\r\n    if (!isCorrectionMsg && requiresMultiStep(userPrompt)) {\r\n        enhancedUserPrompt = generateReasoningPrompt(userPrompt, dataContext);\r\n    }\r\n    \r\n    // Add RAG context to user prompt\r\n    if (ragContext) {\r\n        enhancedUserPrompt = ragContext + \"\\n\\n\" + enhancedUserPrompt;\r\n    }\r\n    \r\n    return {\r\n        systemPrompt,\r\n        userPrompt: enhancedUserPrompt,\r\n        taskType,\r\n        isCorrection: isCorrectionMsg,\r\n        hasMultiStep: requiresMultiStep(userPrompt)\r\n    };\r\n}\r\n\r\n/**\r\n * Processes AI response and extracts any function calls\r\n * @param {string} response - AI response\r\n * @returns {Object} Processed response with actions\r\n */\r\nfunction processResponse(response) {\r\n    // Parse any function calls\r\n    const functionCalls = parseFunctionCalls(response);\r\n    \r\n    // Clean response (remove function call syntax)\r\n    const cleanedResponse = response.replace(/CALL_FUNCTION\\s*\\([^)]+\\)/gi, \"\");\r\n    \r\n    return {\r\n        response: cleanedResponse,\r\n        additionalActions: functionCalls\r\n    };\r\n}\r\n\r\n/**\r\n * Handles a user correction\r\n * @param {string} userMessage - User's correction message\r\n * @param {string} previousAIResponse - What AI said before\r\n */\r\nfunction handleCorrection(userMessage, previousAIResponse) {\r\n    if (isCorrection(userMessage)) {\r\n        storeCorrection(previousAIResponse, userMessage);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// ============================================================================\r\n// Exports\r\n// ============================================================================\r\nexport {\r\n    // Task detection\r\n    detectTaskType,\r\n    TASK_TYPES,\r\n    \r\n    // Prompts\r\n    getTaskSpecificPrompt,\r\n    enhancePrompt,\r\n    \r\n    // Function calling\r\n    EXCEL_FUNCTIONS,\r\n    getFunctionCallingContext,\r\n    parseFunctionCalls,\r\n    \r\n    // RAG\r\n    searchPatterns,\r\n    getRAGContext,\r\n    addCustomPattern,\r\n    getAllPatterns,\r\n    FORMULA_PATTERNS,\r\n    \r\n    // Multi-step reasoning\r\n    requiresMultiStep,\r\n    decomposeTask,\r\n    generateReasoningPrompt,\r\n    \r\n    // Corrections\r\n    isCorrection,\r\n    storeCorrection,\r\n    getStoredCorrections,\r\n    getCorrectionContext,\r\n    clearCorrections,\r\n    handleCorrection,\r\n    \r\n    // Main interface\r\n    processResponse\r\n};\r\n","/*\n * Excel AI Copilot - Accurate Data Understanding\n * Enhanced with: Task-specific prompts, Function calling, RAG, Multi-step reasoning, Learning\n */\n\n/* global document, Excel, Office, fetch, localStorage */\n\n// Version number - increment with each update\nconst VERSION = \"2.8.0\";\n\nimport {\n    detectTaskType,\n    TASK_TYPES,\n    enhancePrompt,\n    isCorrection,\n    handleCorrection,\n    processResponse,\n    getRAGContext,\n    getCorrectionContext,\n    clearCorrections\n} from \"./ai-engine.js\";\n\nconst CONFIG = {\n    GEMINI_MODEL: \"gemini-2.0-flash\",\n    API_ENDPOINT: \"https://generativelanguage.googleapis.com/v1beta/models/\",\n    STORAGE_KEY: \"excel_copilot_api_key\",\n    THEME_KEY: \"excel_copilot_theme\",\n    MAX_HISTORY: 10,\n    MAX_RETRIES: 3,\n    RETRY_DELAY: 1000,\n    VERSION: VERSION\n};\n\nconst state = {\n    apiKey: \"\",\n    pendingActions: [],\n    currentData: null,\n    allSheetsData: [],       // Data from all sheets in workbook\n    conversationHistory: [],\n    isFirstMessage: true,\n    lastAIResponse: \"\",      // Track last AI response for corrections\n    currentTaskType: null,   // Track current task type\n    mode: \"edit\",            // \"edit\" or \"readonly\"\n    // Preview state\n    preview: {\n        selections: [],      // boolean[] - selection state for each action\n        expandedIndex: -1,   // number - index of expanded action (-1 if none)\n        highlightedIndex: -1 // number - index of highlighted action (-1 if none)\n    },\n    // History state for undo functionality\n    history: {\n        entries: [],         // HistoryEntry[] - all history entries, newest first\n        panelVisible: false, // boolean - whether history panel is shown\n        maxEntries: 20       // number - maximum entries to retain\n    }\n};\n\n// ============================================================================\n// Initialize\n// ============================================================================\nOffice.onReady((info) => {\n    if (info.host === Office.HostType.Excel) {\n        initApp();\n    }\n});\n\nfunction initApp() {\n    state.apiKey = localStorage.getItem(CONFIG.STORAGE_KEY) || \"\";\n    \n    // Update version badge and add click handler\n    const versionBadge = document.getElementById(\"versionBadge\");\n    if (versionBadge) {\n        versionBadge.textContent = `v${VERSION}`;\n        versionBadge.style.cursor = \"pointer\";\n        versionBadge.addEventListener(\"click\", checkForUpdates);\n    }\n    \n    // Load saved theme\n    const savedTheme = localStorage.getItem(CONFIG.THEME_KEY);\n    if (savedTheme) {\n        document.documentElement.setAttribute('data-theme', savedTheme);\n    }\n    // Load saved mode preference\n    const savedMode = localStorage.getItem(\"excel_copilot_mode\");\n    if (savedMode) {\n        state.mode = savedMode;\n    }\n    bindEvents();\n    initModeButtons();\n    readExcelData().then(() => {\n        // Smart suggestions disabled for cleaner UI\n    });\n}\n\nfunction bindEvents() {\n    const sendBtn = document.getElementById(\"sendBtn\");\n    const input = document.getElementById(\"promptInput\");\n    \n    sendBtn?.addEventListener(\"click\", handleSend);\n    input?.addEventListener(\"keydown\", (e) => {\n        if (e.key === \"Enter\" && !e.shiftKey) {\n            e.preventDefault();\n            handleSend();\n        }\n    });\n    input?.addEventListener(\"input\", () => {\n        sendBtn.disabled = !input.value.trim();\n        input.style.height = \"auto\";\n        input.style.height = Math.min(input.scrollHeight, 120) + \"px\";\n    });\n    \n    document.getElementById(\"applyBtn\")?.addEventListener(\"click\", handleApply);\n    \n    document.getElementById(\"refreshBtn\")?.addEventListener(\"click\", async () => {\n        const btn = document.getElementById(\"refreshBtn\");\n        btn.classList.add(\"loading\");\n        await readExcelData();\n        btn.classList.remove(\"loading\");\n        toast(\"Refreshed\");\n    });\n    \n    document.getElementById(\"settingsBtn\")?.addEventListener(\"click\", () => {\n        document.getElementById(\"apiKeyInput\").value = state.apiKey;\n        // Set mode radio button\n        document.getElementById(state.mode === \"readonly\" ? \"modeReadOnly\" : \"modeEdit\").checked = true;\n        document.getElementById(\"modal\").classList.add(\"open\");\n    });\n    \n    document.getElementById(\"closeModal\")?.addEventListener(\"click\", closeModal);\n    document.getElementById(\"cancelBtn\")?.addEventListener(\"click\", closeModal);\n    document.getElementById(\"saveBtn\")?.addEventListener(\"click\", () => {\n        state.apiKey = document.getElementById(\"apiKeyInput\").value.trim();\n        localStorage.setItem(CONFIG.STORAGE_KEY, state.apiKey);\n        \n        // Save mode preference\n        const selectedMode = document.querySelector('input[name=\"mode\"]:checked')?.value || \"edit\";\n        state.mode = selectedMode;\n        localStorage.setItem(\"excel_copilot_mode\", selectedMode);\n        \n        // Update apply button state\n        updateApplyButtonState();\n        \n        closeModal();\n        toast(\"Saved\");\n    });\n    \n    document.getElementById(\"modal\")?.addEventListener(\"click\", (e) => {\n        if (e.target.id === \"modal\") closeModal();\n    });\n    \n    // Clear learned preferences button\n    document.getElementById(\"clearPrefsBtn\")?.addEventListener(\"click\", () => {\n        clearLearnedCorrections();\n    });\n    \n    document.getElementById(\"clearBtn\")?.addEventListener(\"click\", clearChat);\n    \n    // History and Undo buttons\n    document.getElementById(\"historyBtn\")?.addEventListener(\"click\", toggleHistoryPanel);\n    document.getElementById(\"undoBtn\")?.addEventListener(\"click\", performUndo);\n    \n    // Theme toggle\n    document.getElementById(\"themeBtn\")?.addEventListener(\"click\", toggleTheme);\n    \n    // Mode switch buttons\n    document.getElementById(\"editModeBtn\")?.addEventListener(\"click\", () => setMode(\"edit\"));\n    document.getElementById(\"readOnlyModeBtn\")?.addEventListener(\"click\", () => setMode(\"readonly\"));\n    \n    // Keyboard shortcuts\n    document.addEventListener(\"keydown\", handleKeyboardShortcuts);\n    \n    document.querySelectorAll(\"[data-prompt]\").forEach(el => {\n        el.addEventListener(\"click\", () => {\n            document.getElementById(\"promptInput\").value = el.dataset.prompt;\n            document.getElementById(\"sendBtn\").disabled = false;\n            handleSend();\n        });\n    });\n    \n    document.getElementById(\"togglePwd\")?.addEventListener(\"click\", () => {\n        const inp = document.getElementById(\"apiKeyInput\");\n        inp.type = inp.type === \"password\" ? \"text\" : \"password\";\n    });\n    \n    setupSelectionListener();\n}\n\nfunction closeModal() {\n    document.getElementById(\"modal\").classList.remove(\"open\");\n}\n\nasync function setupSelectionListener() {\n    try {\n        await Excel.run(async (ctx) => {\n            ctx.workbook.worksheets.getActiveWorksheet().onSelectionChanged.add(readExcelData);\n            await ctx.sync();\n        });\n    } catch (e) { /* ignore */ }\n}\n\n// ============================================================================\n// Column Letter Helper\n// ============================================================================\nfunction colIndexToLetter(index) {\n    let letter = \"\";\n    while (index >= 0) {\n        letter = String.fromCharCode((index % 26) + 65) + letter;\n        index = Math.floor(index / 26) - 1;\n    }\n    return letter;\n}\n\n// ============================================================================\n// Read Excel Data with Column Headers\n// ============================================================================\nasync function readExcelData() {\n    const infoEl = document.getElementById(\"contextInfo\");\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheets = ctx.workbook.worksheets;\n            sheets.load(\"items\");\n            await ctx.sync();\n            \n            // Read all sheets (limit to first 10 to avoid overwhelming context)\n            const allSheetsData = [];\n            const maxSheets = Math.min(sheets.items.length, 10);\n            \n            for (let i = 0; i < maxSheets; i++) {\n                const sheet = sheets.items[i];\n                try {\n                    const usedRange = sheet.getUsedRange();\n                    sheet.load(\"name\");\n                    usedRange.load([\"address\", \"values\", \"rowCount\", \"columnCount\", \"columnIndex\", \"rowIndex\"]);\n                    await ctx.sync();\n                    \n                    const sheetName = sheet.name;\n                    const values = usedRange.values;\n                    const startCol = usedRange.columnIndex;\n                    const startRow = usedRange.rowIndex;\n                    const rowCount = usedRange.rowCount;\n                    const colCount = usedRange.columnCount;\n                    \n                    // Detect headers (first row)\n                    const headers = values[0] || [];\n                    \n                    // Build column mapping\n                    const columnMap = [];\n                    for (let c = 0; c < colCount; c++) {\n                        const colLetter = colIndexToLetter(startCol + c);\n                        const headerName = headers[c] || `Column ${colLetter}`;\n                        columnMap.push({\n                            letter: colLetter,\n                            index: c,\n                            header: headerName\n                        });\n                    }\n                    \n                    allSheetsData.push({\n                        sheetName,\n                        address: usedRange.address,\n                        values,\n                        headers,\n                        columnMap,\n                        startRow: startRow + 1,\n                        startCol: colIndexToLetter(startCol),\n                        rowCount,\n                        colCount,\n                        dataStartRow: startRow + 2\n                    });\n                } catch (e) {\n                    // Sheet might be empty, skip it\n                    console.warn(`Skipping sheet ${sheet.name}:`, e);\n                }\n            }\n            \n            // Set current data to active sheet\n            const activeSheet = ctx.workbook.worksheets.getActiveWorksheet();\n            activeSheet.load(\"name\");\n            await ctx.sync();\n            \n            const activeSheetData = allSheetsData.find(s => s.sheetName === activeSheet.name);\n            state.currentData = activeSheetData || allSheetsData[0] || null;\n            state.allSheetsData = allSheetsData;\n            \n            if (state.currentData) {\n                infoEl.textContent = `${state.currentData.sheetName}: ${state.currentData.rowCount} rows  ${state.currentData.colCount} cols (${allSheetsData.length} sheets)`;\n            } else {\n                infoEl.textContent = \"No data\";\n            }\n        });\n    } catch (e) {\n        infoEl.textContent = \"No data\";\n        state.currentData = null;\n        state.allSheetsData = [];\n    }\n}\n\n// ============================================================================\n// Chat UI\n// ============================================================================\nfunction showChat() {\n    if (state.isFirstMessage) {\n        document.getElementById(\"welcome\").style.display = \"none\";\n        document.getElementById(\"chat\").style.display = \"flex\";\n        state.isFirstMessage = false;\n    }\n}\n\nfunction addMessage(role, content, type = \"\") {\n    showChat();\n    const chat = document.getElementById(\"chat\");\n    const msg = document.createElement(\"div\");\n    msg.className = `msg ${role} ${type}`;\n    msg.innerHTML = `\n        <div class=\"msg-avatar\">${role === \"user\" ? \"U\" : \"AI\"}</div>\n        <div class=\"msg-body\">${formatText(content)}</div>\n    `;\n    chat.appendChild(msg);\n    \n    // Smooth scroll to bottom\n    setTimeout(() => {\n        chat.scrollTo({\n            top: chat.scrollHeight,\n            behavior: 'smooth'\n        });\n    }, 100);\n}\n\nfunction formatText(text) {\n    return text\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/```(\\w*)\\n?([\\s\\S]*?)```/g, '<pre>$2</pre>')\n        .replace(/`([^`]+)`/g, '<code>$1</code>')\n        .replace(/\\*\\*([^*]+)\\*\\*/g, '<b>$1</b>')\n        .replace(/\\n/g, '<br>');\n}\n\nfunction showTyping() {\n    showChat();\n    const chat = document.getElementById(\"chat\");\n    const el = document.createElement(\"div\");\n    el.className = \"msg ai\";\n    el.id = \"typing\";\n    el.innerHTML = `<div class=\"msg-avatar\">AI</div><div class=\"msg-body\"><span class=\"dot\"></span><span class=\"dot\"></span><span class=\"dot\"></span></div>`;\n    chat.appendChild(el);\n    chat.scrollTop = chat.scrollHeight;\n}\n\nfunction hideTyping() {\n    document.getElementById(\"typing\")?.remove();\n}\n\n// ============================================================================\n// Loading Skeleton\n// ============================================================================\n\nfunction showLoadingSkeleton() {\n    showChat();\n    const chat = document.getElementById(\"chat\");\n    const el = document.createElement(\"div\");\n    el.className = \"skeleton-msg\";\n    el.id = \"loading-skeleton\";\n    el.innerHTML = `\n        <div class=\"skeleton skeleton-avatar\"></div>\n        <div class=\"skeleton-content\">\n            <div class=\"skeleton skeleton-line\" style=\"width: 90%\"></div>\n            <div class=\"skeleton skeleton-line\" style=\"width: 75%\"></div>\n            <div class=\"skeleton skeleton-line\" style=\"width: 60%\"></div>\n        </div>\n    `;\n    chat.appendChild(el);\n    chat.scrollTop = chat.scrollHeight;\n}\n\nfunction hideLoadingSkeleton() {\n    document.getElementById(\"loading-skeleton\")?.remove();\n}\n\n// ============================================================================\n// Smart Suggestions\n// ============================================================================\n\nfunction generateSmartSuggestions() {\n    const suggestions = [];\n    const data = state.currentData;\n    \n    if (!data) return suggestions;\n    \n    // Based on data characteristics\n    if (data.rowCount > 5) {\n        suggestions.push({ icon: '', text: 'Summarize this data', prompt: 'Summarize this data and give me key statistics' });\n    }\n    \n    // Check for numeric columns\n    const hasNumbers = data.values.some(row => row.some(cell => typeof cell === 'number'));\n    if (hasNumbers) {\n        suggestions.push({ icon: '', text: 'Add totals', prompt: 'Add SUM formulas for all numeric columns' });\n        suggestions.push({ icon: '', text: 'Create chart', prompt: 'Create a chart to visualize this data' });\n    }\n    \n    // Check for potential duplicates\n    if (data.rowCount > 10) {\n        suggestions.push({ icon: '', text: 'Find duplicates', prompt: 'Check for duplicate values in this data' });\n    }\n    \n    // Check column headers for common patterns\n    const headers = data.headers.map(h => String(h).toLowerCase());\n    if (headers.some(h => h.includes('date') || h.includes('time'))) {\n        suggestions.push({ icon: '', text: 'Sort by date', prompt: 'Sort this data by date column' });\n    }\n    if (headers.some(h => h.includes('price') || h.includes('amount') || h.includes('cost'))) {\n        suggestions.push({ icon: '', text: 'Calculate totals', prompt: 'Calculate the total of all monetary values' });\n    }\n    if (headers.some(h => h.includes('email'))) {\n        suggestions.push({ icon: '', text: 'Validate emails', prompt: 'Check if all email addresses are valid' });\n    }\n    \n    return suggestions.slice(0, 4); // Max 4 suggestions\n}\n\nfunction showSmartSuggestions() {\n    const container = document.getElementById(\"smartSuggestions\");\n    if (!container) return;\n    \n    const suggestions = generateSmartSuggestions();\n    \n    if (suggestions.length === 0) {\n        container.style.display = \"none\";\n        return;\n    }\n    \n    container.innerHTML = suggestions.map(s => `\n        <button class=\"smart-suggestion\" data-prompt=\"${s.prompt}\">\n            <span>${s.icon}</span> ${s.text}\n        </button>\n    `).join('');\n    \n    container.style.display = \"flex\";\n    \n    // Bind click events\n    container.querySelectorAll(\".smart-suggestion\").forEach(btn => {\n        btn.addEventListener(\"click\", () => {\n            document.getElementById(\"promptInput\").value = btn.dataset.prompt;\n            document.getElementById(\"sendBtn\").disabled = false;\n            container.style.display = \"none\";\n            handleSend();\n        });\n    });\n}\n\nfunction hideSmartSuggestions() {\n    const container = document.getElementById(\"smartSuggestions\");\n    if (container) container.style.display = \"none\";\n}\n\n// ============================================================================\n// Formula Explanation\n// ============================================================================\n\nfunction explainFormula(formula) {\n    const explanations = {\n        'SUM': 'Adds all numbers in a range',\n        'AVERAGE': 'Calculates the average of numbers',\n        'COUNT': 'Counts cells with numbers',\n        'COUNTA': 'Counts non-empty cells',\n        'MAX': 'Returns the largest value',\n        'MIN': 'Returns the smallest value',\n        'IF': 'Returns one value if true, another if false',\n        'VLOOKUP': 'Looks up a value in the first column and returns a value in the same row',\n        'XLOOKUP': 'Searches a range and returns a matching item',\n        'INDEX': 'Returns a value at a given position',\n        'MATCH': 'Returns the position of a value in a range',\n        'CONCATENATE': 'Joins text strings together',\n        'LEFT': 'Returns characters from the start of text',\n        'RIGHT': 'Returns characters from the end of text',\n        'MID': 'Returns characters from the middle of text',\n        'LEN': 'Returns the length of text',\n        'TRIM': 'Removes extra spaces from text',\n        'UPPER': 'Converts text to uppercase',\n        'LOWER': 'Converts text to lowercase',\n        'ROUND': 'Rounds a number to specified digits',\n        'SUMIF': 'Adds cells that meet a condition',\n        'COUNTIF': 'Counts cells that meet a condition',\n        'IFERROR': 'Returns a value if there is an error',\n        'TODAY': 'Returns the current date',\n        'NOW': 'Returns the current date and time',\n        'YEAR': 'Returns the year from a date',\n        'MONTH': 'Returns the month from a date',\n        'DAY': 'Returns the day from a date'\n    };\n    \n    // Extract function name from formula\n    const match = formula.match(/=?([A-Z]+)\\(/i);\n    if (match) {\n        const funcName = match[1].toUpperCase();\n        return explanations[funcName] || `${funcName} function`;\n    }\n    return 'Excel formula';\n}\n\nfunction clearChat() {\n    state.conversationHistory = [];\n    state.pendingActions = [];\n    state.isFirstMessage = true;\n    state.lastAIResponse = \"\";\n    state.currentTaskType = null;\n    state.preview.selections = [];\n    state.preview.expandedIndex = -1;\n    document.getElementById(\"chat\").innerHTML = \"\";\n    document.getElementById(\"chat\").style.display = \"none\";\n    document.getElementById(\"welcome\").style.display = \"flex\";\n    document.getElementById(\"applyBtn\").disabled = true;\n    hidePreviewPanel();\n    hideTaskTypeIndicator();\n    toast(\"Cleared\");\n}\n\n/**\n * Clears learned corrections (accessible via settings or command)\n */\nfunction clearLearnedCorrections() {\n    clearCorrections();\n    toast(\"Learned preferences cleared\");\n}\n\nfunction toast(msg) {\n    const t = document.getElementById(\"toast\");\n    t.textContent = msg;\n    t.classList.add(\"show\");\n    setTimeout(() => t.classList.remove(\"show\"), 2000);\n}\n\n/**\n * Checks for updates by fetching the deployed version\n */\nasync function checkForUpdates() {\n    const versionBadge = document.getElementById(\"versionBadge\");\n    const originalText = versionBadge.textContent;\n    \n    try {\n        versionBadge.textContent = \"Checking...\";\n        \n        // Fetch the deployed taskpane.js with cache-busting\n        const response = await fetch(`https://tankuday21.github.io/GeminiForExcel/taskpane.js?t=${Date.now()}`);\n        const code = await response.text();\n        \n        // Extract version from the deployed code\n        const versionMatch = code.match(/const VERSION = \"([^\"]+)\"/);\n        \n        if (versionMatch) {\n            const deployedVersion = versionMatch[1];\n            const currentVersion = VERSION;\n            \n            if (deployedVersion === currentVersion) {\n                toast(\" You're on the latest version!\");\n                versionBadge.textContent = originalText;\n            } else {\n                toast(`Update available: v${deployedVersion}`);\n                versionBadge.textContent = `v${currentVersion}  v${deployedVersion}`;\n                versionBadge.style.color = \"#ff9800\";\n                \n                // Reset after 5 seconds\n                setTimeout(() => {\n                    versionBadge.textContent = originalText;\n                    versionBadge.style.color = \"\";\n                }, 5000);\n            }\n        } else {\n            throw new Error(\"Could not parse version\");\n        }\n    } catch (error) {\n        console.error(\"Update check failed:\", error);\n        toast(\"Failed to check for updates\");\n        versionBadge.textContent = originalText;\n    }\n}\n\n// ============================================================================\n// AI Communication\n// ============================================================================\nasync function handleSend() {\n    const input = document.getElementById(\"promptInput\");\n    const prompt = input.value.trim();\n    if (!prompt) return;\n    \n    if (!state.apiKey) {\n        document.getElementById(\"settingsBtn\").click();\n        toast(\"Enter API key\");\n        return;\n    }\n    \n    // Always refresh data before sending to ensure latest data\n    await readExcelData();\n    \n    // Clear conversation history in read-only mode to ensure fresh data context\n    if (state.mode === \"readonly\") {\n        state.conversationHistory = [];\n    }\n    \n    // Detect task type and show indicator\n    const taskType = detectTaskType(prompt);\n    const isCorrectionMsg = isCorrection(prompt);\n    \n    // Add user message with task type badge\n    addMessage(\"user\", prompt, isCorrectionMsg ? \"correction\" : \"\");\n    \n    // Show task type indicator\n    if (!isCorrectionMsg) {\n        showTaskTypeIndicator(taskType);\n    }\n    \n    input.value = \"\";\n    input.style.height = \"auto\";\n    document.getElementById(\"sendBtn\").disabled = true;\n    \n    showTyping();\n    showLoadingSkeleton();\n    \n    try {\n        const response = await callAI(prompt);\n        hideTyping();\n        hideLoadingSkeleton();\n        hideTaskTypeIndicator();\n        \n        // In read-only mode, don't parse actions - just show the response\n        let { message, actions } = parseResponse(response);\n        \n        if (state.mode === \"readonly\") {\n            // Strip out ACTION tags in read-only mode\n            actions = [];\n            message = response.replace(/<ACTION[\\s\\S]*?<\\/ACTION>/g, \"\").trim();\n        }\n        \n        state.pendingActions = actions;\n        \n        // Add task type badge to AI response\n        const taskBadge = getTaskTypeBadge(state.currentTaskType);\n        const enhancedMessage = taskBadge + message;\n        \n        addMessage(\"ai\", enhancedMessage, actions.length ? \"has-action\" : \"\");\n        \n        if (actions.length) {\n            // Initialize preview state and show preview panel\n            state.preview.selections = actions.map(() => true);\n            state.preview.expandedIndex = -1;\n            showPreviewPanel();\n        } else {\n            hidePreviewPanel();\n        }\n        \n        state.conversationHistory.push(\n            { role: \"user\", parts: [{ text: prompt }] },\n            { role: \"model\", parts: [{ text: response }] }\n        );\n        \n        if (state.conversationHistory.length > CONFIG.MAX_HISTORY * 2) {\n            state.conversationHistory = state.conversationHistory.slice(-CONFIG.MAX_HISTORY * 2);\n        }\n    } catch (err) {\n        hideTyping();\n        hideLoadingSkeleton();\n        hideTaskTypeIndicator();\n        addMessage(\"ai\", getErrorMessage(err), \"error\");\n    }\n}\n\n/**\n * Shows task type indicator during processing\n */\nfunction showTaskTypeIndicator(taskType) {\n    const labels = {\n        [TASK_TYPES.FORMULA]: \" Formula Mode\",\n        [TASK_TYPES.CHART]: \" Chart Mode\",\n        [TASK_TYPES.ANALYSIS]: \" Analysis Mode\",\n        [TASK_TYPES.FORMAT]: \" Format Mode\",\n        [TASK_TYPES.DATA_ENTRY]: \" Data Entry Mode\",\n        [TASK_TYPES.VALIDATION]: \" Validation Mode\",\n        [TASK_TYPES.GENERAL]: \" General Mode\"\n    };\n    \n    const indicator = document.getElementById(\"taskTypeIndicator\");\n    if (indicator) {\n        indicator.textContent = labels[taskType] || labels[TASK_TYPES.GENERAL];\n        indicator.className = `task-indicator ${taskType}`;\n        indicator.style.display = \"block\";\n    }\n}\n\n/**\n * Hides task type indicator\n */\nfunction hideTaskTypeIndicator() {\n    const indicator = document.getElementById(\"taskTypeIndicator\");\n    if (indicator) {\n        indicator.style.display = \"none\";\n    }\n}\n\n/**\n * Gets a badge string for the task type\n */\nfunction getTaskTypeBadge(taskType) {\n    const badges = {\n        [TASK_TYPES.FORMULA]: \"**[Formula]** \",\n        [TASK_TYPES.CHART]: \"**[Chart]** \",\n        [TASK_TYPES.ANALYSIS]: \"**[Analysis]** \",\n        [TASK_TYPES.FORMAT]: \"**[Format]** \",\n        [TASK_TYPES.DATA_ENTRY]: \"**[Data]** \",\n        [TASK_TYPES.VALIDATION]: \"**[Validation]** \",\n        [TASK_TYPES.GENERAL]: \"\"\n    };\n    return badges[taskType] || \"\";\n}\n\nasync function callAI(userPrompt) {\n    const dataContext = buildDataContext();\n    \n    // Use AI engine to enhance the prompt with task-specific context\n    const enhanced = enhancePrompt(userPrompt, state.currentData);\n    state.currentTaskType = enhanced.taskType;\n    \n    // Handle corrections - learn from user feedback\n    if (enhanced.isCorrection && state.lastAIResponse) {\n        handleCorrection(userPrompt, state.lastAIResponse);\n    }\n    \n    // Build the enhanced system prompt - modify for read-only mode\n    let systemPrompt = enhanced.systemPrompt;\n    \n    if (state.mode === \"readonly\") {\n        systemPrompt = getReadOnlySystemPrompt();\n    }\n    \n    // Build the enhanced user message\n    const fullUserMessage = `${dataContext}\\n\\n---\\nUSER REQUEST: ${enhanced.userPrompt}`;\n    \n    const contents = [...state.conversationHistory];\n    contents.push({ role: \"user\", parts: [{ text: fullUserMessage }] });\n    \n    // Use retry logic for transient errors\n    const response = await withRetry(async () => {\n        const res = await fetch(\n            `${CONFIG.API_ENDPOINT}${CONFIG.GEMINI_MODEL}:generateContent?key=${state.apiKey}`,\n            {\n                method: \"POST\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({\n                    systemInstruction: { parts: [{ text: systemPrompt }] },\n                    contents,\n                    generationConfig: { temperature: 0.1, maxOutputTokens: 4096 }\n                })\n            }\n        );\n        \n        if (!res.ok) throw new Error(`API Error: ${res.status}`);\n        \n        const data = await res.json();\n        return data?.candidates?.[0]?.content?.parts?.[0]?.text || \"No response\";\n    });\n    \n    // Store response for potential correction learning\n    state.lastAIResponse = response;\n    \n    // Process response for any function calls\n    const processed = processResponse(response);\n    \n    return processed.response;\n}\n\n/**\n * Gets the system prompt for read-only mode\n * In this mode, AI analyzes data and gives direct answers without formulas/actions\n */\nfunction getReadOnlySystemPrompt() {\n    return `You are Excel Copilot in READ-ONLY mode. You are a data analyst assistant.\n\n## YOUR ROLE\n- Analyze the Excel data provided and give DIRECT ANSWERS\n- Do NOT provide formulas or ACTION tags\n- Do NOT suggest modifications to the spreadsheet\n- Calculate and compute answers yourself from the data provided\n- Give clear, concise answers with the actual values/numbers\n\n## CRITICAL ACCURACY RULES\n1. **COUNT CAREFULLY**: When counting occurrences, examine EVERY cell in the data preview\n2. **CASE SENSITIVITY**: \"d\" and \"D\" are different - count only exact matches unless told otherwise\n3. **EMPTY CELLS**: Ignore empty/null cells in counts\n4. **VERIFY YOUR COUNT**: Double-check your answer before responding\n5. **BE PRECISE**: If you count 5 occurrences, say exactly 5, not approximately\n\n## EXAMPLES\n- \"How many times does 'd' appear?\"  Examine each cell, count lowercase 'd' only  \"There are exactly 5 occurrences of 'd'\"\n- \"What is the total of column B?\"  Add all numbers in column B  \"The total is 1,234\"\n- \"How many rows have value X?\"  Count rows where value equals X  \"There are 15 rows with value X\"\n\n## IMPORTANT\n- You have access to ALL the data in the DATA PREVIEW section\n- Count EVERY occurrence manually from the data shown\n- Be EXACT with your counts - accuracy is critical\n- Do NOT use ACTION tags - just provide text answers`;\n}\n\nfunction buildDataContext() {\n    if (!state.currentData) {\n        return \"ERROR: No Excel data available.\";\n    }\n    \n    const { sheetName, values, columnMap, rowCount, colCount, dataStartRow, address } = state.currentData;\n    \n    let context = `## EXCEL WORKBOOK DATA\\n\\n`;\n    \n    // List all sheets in workbook\n    if (state.allSheetsData && state.allSheetsData.length > 1) {\n        context += `**Available Sheets:** ${state.allSheetsData.map(s => s.sheetName).join(\", \")}\\n`;\n        context += `**Active Sheet:** ${sheetName}\\n\\n`;\n    } else {\n        context += `**Sheet:** ${sheetName}\\n`;\n    }\n    \n    context += `**Data Range:** ${address}\\n`;\n    context += `**Total Rows:** ${rowCount} (including header)\\n`;\n    context += `**Total Columns:** ${colCount}\\n\\n`;\n    \n    // Column structure - CRITICAL for AI to understand\n    context += `## COLUMN STRUCTURE\\n`;\n    context += `| Column Letter | Header Name | Sample Values |\\n`;\n    context += `|---------------|-------------|---------------|\\n`;\n    \n    for (const col of columnMap) {\n        // Get sample values from first few data rows\n        const samples = [];\n        for (let r = 1; r < Math.min(4, values.length); r++) {\n            const val = values[r]?.[col.index];\n            if (val !== null && val !== undefined && val !== \"\") {\n                samples.push(String(val).substring(0, 20));\n            }\n        }\n        context += `| ${col.letter} | ${col.header} | ${samples.join(\", \")} |\\n`;\n    }\n    \n    context += `\\n## DATA PREVIEW (First 30 rows)\\n\\n`;\n    \n    // Header row\n    context += `| Row |`;\n    for (const col of columnMap) {\n        context += ` ${col.letter}: ${col.header} |`;\n    }\n    context += `\\n|-----|`;\n    for (let c = 0; c < colCount; c++) {\n        context += `------------|`;\n    }\n    context += `\\n`;\n    \n    // Data rows\n    const maxRows = Math.min(30, values.length);\n    for (let r = 0; r < maxRows; r++) {\n        const rowNum = state.currentData.startRow + r;\n        context += `| ${rowNum} |`;\n        for (let c = 0; c < colCount; c++) {\n            let val = values[r]?.[c];\n            if (val === null || val === undefined) val = \"\";\n            val = String(val).substring(0, 25);\n            context += ` ${val} |`;\n        }\n        context += `\\n`;\n    }\n    \n    if (rowCount > 30) {\n        context += `\\n... and ${rowCount - 30} more rows\\n`;\n    }\n    \n    // Add unique values for key columns (for dropdowns)\n    context += `\\n## UNIQUE VALUES IN EACH COLUMN (for dropdowns)\\n`;\n    for (const col of columnMap) {\n        const uniqueVals = new Set();\n        for (let r = 1; r < values.length; r++) {\n            const val = values[r]?.[col.index];\n            if (val !== null && val !== undefined && val !== \"\") {\n                uniqueVals.add(val);\n            }\n        }\n        if (uniqueVals.size > 0 && uniqueVals.size <= 50) {\n            context += `**${col.letter} (${col.header}):** ${Array.from(uniqueVals).slice(0, 20).join(\", \")}`;\n            if (uniqueVals.size > 20) context += ` ... (${uniqueVals.size} total)`;\n            context += `\\n`;\n        }\n    }\n    \n    // Add information about other sheets\n    if (state.allSheetsData && state.allSheetsData.length > 1) {\n        context += `\\n## OTHER SHEETS IN WORKBOOK\\n`;\n        for (const sheet of state.allSheetsData) {\n            if (sheet.sheetName === sheetName) continue; // Skip current sheet\n            \n            context += `\\n### ${sheet.sheetName}\\n`;\n            context += `- Columns: ${sheet.headers.join(\", \")}\\n`;\n            context += `- Rows: ${sheet.rowCount}\\n`;\n            \n            // Show first few rows as sample\n            if (sheet.values.length > 1) {\n                context += `- Sample data (first 3 rows):\\n`;\n                for (let r = 0; r < Math.min(3, sheet.values.length); r++) {\n                    const row = sheet.values[r];\n                    context += `  ${r === 0 ? \"Headers\" : `Row ${r}`}: ${row.slice(0, 5).join(\" | \")}\\n`;\n                }\n            }\n        }\n        context += `\\n**Note:** You can reference data from any sheet using sheet name (e.g., DeptManagers!A2:B10)\\n`;\n    }\n    \n    return context;\n}\n\n// Note: getSystemPrompt is now handled by ai-engine.js via enhancePrompt()\n// This function is kept as a fallback but is no longer the primary source\nfunction getSystemPrompt() {\n    return `You are Excel Copilot, an expert Excel assistant.\nCheck COLUMN STRUCTURE first. Data starts at row 2.\nUse ACTION tags for: formula, values, format, chart, validation.`;\n}\n\nfunction parseResponse(text) {\n    const actions = [];\n    const actionRegex = /<ACTION\\s+([^>]*)>([\\s\\S]*?)<\\/ACTION>/g;\n    \n    let match;\n    while ((match = actionRegex.exec(text)) !== null) {\n        const attrs = match[1];\n        const content = match[2].trim();\n        \n        const type = attrs.match(/type=\"([^\"]+)\"/)?.[1] || \"formula\";\n        const target = attrs.match(/target=\"([^\"]+)\"/)?.[1] || \"\";\n        const source = attrs.match(/source=\"([^\"]+)\"/)?.[1] || \"\";\n        const chartType = attrs.match(/chartType=\"([^\"]+)\"/)?.[1] || \"column\";\n        const title = attrs.match(/title=\"([^\"]+)\"/)?.[1] || \"\";\n        const position = attrs.match(/position=\"([^\"]+)\"/)?.[1] || \"H2\";\n        \n        actions.push({ type, target, source, chartType, title, position, data: content });\n    }\n    \n    const message = text.replace(/<ACTION[\\s\\S]*?<\\/ACTION>/g, \"\").trim();\n    return { message: message || \"Ready to apply.\", actions };\n}\n\n// ============================================================================\n// Preview Panel Functions\n// ============================================================================\n\n/**\n * Gets the SVG icon for an action type\n * @param {string} type - Action type\n * @returns {string} SVG icon markup\n */\nfunction getActionIcon(type) {\n    const icons = {\n        formula: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 7h16M4 12h16M4 17h10\"/><text x=\"18\" y=\"18\" font-size=\"8\" fill=\"currentColor\">fx</text></svg>',\n        values: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/><path d=\"M3 9h18M9 21V9\"/></svg>',\n        format: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 20h16M6 16l6-12 6 12M8 12h8\"/></svg>',\n        chart: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M18 20V10M12 20V4M6 20v-6\"/></svg>',\n        validation: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M9 11l3 3L22 4\"/><path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\"/></svg>',\n        sort: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 6h18M3 12h12M3 18h6\"/></svg>',\n        autofill: '<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M12 5v14M5 12h14\"/></svg>'\n    };\n    return icons[type] || icons.formula;\n}\n\n/**\n * Gets a summary string for an action\n * @param {Object} action - The action to summarize\n * @returns {string} Human-readable summary\n */\nfunction getActionSummary(action) {\n    const typeLabels = {\n        formula: \"Formula\",\n        values: \"Values\",\n        format: \"Format\",\n        chart: \"Chart\",\n        validation: \"Dropdown\",\n        sort: \"Sort\",\n        autofill: \"Autofill\"\n    };\n    return typeLabels[action.type] || action.type;\n}\n\n/**\n * Gets detailed description for an action\n * @param {Object} action - The action to describe\n * @returns {string} Detailed description\n */\nfunction getActionDetails(action) {\n    switch (action.type) {\n        case \"formula\":\n            return action.data || \"No formula\";\n        case \"values\":\n            try {\n                const vals = JSON.parse(action.data);\n                return JSON.stringify(vals, null, 2);\n            } catch {\n                return action.data || \"No values\";\n            }\n        case \"format\":\n            try {\n                const fmt = JSON.parse(action.data);\n                const parts = [];\n                if (fmt.bold) parts.push(\"Bold\");\n                if (fmt.italic) parts.push(\"Italic\");\n                if (fmt.fill) parts.push(`Fill: ${fmt.fill}`);\n                if (fmt.fontColor) parts.push(`Color: ${fmt.fontColor}`);\n                if (fmt.fontSize) parts.push(`Size: ${fmt.fontSize}`);\n                if (fmt.numberFormat) parts.push(`Format: ${fmt.numberFormat}`);\n                return parts.join(\", \") || \"No formatting\";\n            } catch {\n                return action.data || \"No format data\";\n            }\n        case \"chart\":\n            return `Type: ${action.chartType}\\nData: ${action.target}\\nPosition: ${action.position}${action.title ? `\\nTitle: ${action.title}` : \"\"}`;\n        case \"validation\":\n            return `Source: ${action.source}`;\n        case \"sort\":\n            return action.data || \"Default sort\";\n        case \"autofill\":\n            return `Source: ${action.source}`;\n        default:\n            return action.data || \"No details\";\n    }\n}\n\n/**\n * Filters actions based on selection state\n * @param {Object[]} actions - All pending actions\n * @param {boolean[]} selections - Selection state for each action\n * @returns {Object[]} Only the selected actions\n */\nfunction filterSelectedActions(actions, selections) {\n    if (!actions || !selections) return [];\n    return actions.filter((_, index) => selections[index] === true);\n}\n\n/**\n * Checks if any actions are selected\n * @param {boolean[]} selections - Selection state array\n * @returns {boolean} True if at least one action is selected\n */\nfunction hasSelectedActions(selections) {\n    if (!selections || selections.length === 0) return false;\n    return selections.some(s => s === true);\n}\n\n/**\n * Renders a single preview item HTML\n */\nfunction renderPreviewItemHTML(action, index, isExpanded, isSelected, hasWarning) {\n    const icon = getActionIcon(action.type);\n    const summary = getActionSummary(action);\n    const details = getActionDetails(action);\n    const expandedClass = isExpanded ? 'expanded' : '';\n    const warningClass = hasWarning ? 'warning' : '';\n    \n    return `\n        <div class=\"preview-item ${expandedClass} ${warningClass}\" data-index=\"${index}\">\n            <input type=\"checkbox\" class=\"preview-checkbox\" ${isSelected ? 'checked' : ''} data-index=\"${index}\">\n            <div class=\"preview-icon ${action.type}\">${icon}</div>\n            <div class=\"preview-content\">\n                <div class=\"preview-summary\">\n                    ${summary}\n                    <span class=\"preview-target\">${action.target}</span>\n                    ${hasWarning ? '<svg class=\"preview-warning\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M12 2L1 21h22L12 2zm0 3.5L19.5 19h-15L12 5.5zM11 10v4h2v-4h-2zm0 6v2h2v-2h-2z\"/></svg>' : ''}\n                </div>\n                <div class=\"preview-details\">${details}</div>\n            </div>\n            <div class=\"preview-expand\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M6 9l6 6 6-6\"/></svg>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Shows the preview panel with pending actions\n */\nfunction showPreviewPanel() {\n    const panel = document.getElementById(\"previewPanel\");\n    const list = document.getElementById(\"previewList\");\n    \n    if (!state.pendingActions.length) {\n        panel.style.display = \"none\";\n        return;\n    }\n    \n    // Initialize selections if needed (all selected by default)\n    if (state.preview.selections.length !== state.pendingActions.length) {\n        state.preview.selections = state.pendingActions.map(() => true);\n    }\n    \n    // Render preview items\n    const html = state.pendingActions.map((action, index) => {\n        const isExpanded = index === state.preview.expandedIndex;\n        const isSelected = state.preview.selections[index];\n        return renderPreviewItemHTML(action, index, isExpanded, isSelected, false);\n    }).join('');\n    \n    list.innerHTML = html;\n    panel.style.display = \"block\";\n    \n    // Bind events\n    bindPreviewEvents();\n    updateApplyButtonState();\n}\n\n/**\n * Hides the preview panel\n */\nfunction hidePreviewPanel() {\n    const panel = document.getElementById(\"previewPanel\");\n    panel.style.display = \"none\";\n    state.preview.selections = [];\n    state.preview.expandedIndex = -1;\n}\n\n/**\n * Binds event handlers to preview panel elements\n */\nfunction bindPreviewEvents() {\n    // Checkbox changes\n    document.querySelectorAll(\".preview-checkbox\").forEach(cb => {\n        cb.addEventListener(\"change\", (e) => {\n            const index = parseInt(e.target.dataset.index);\n            state.preview.selections[index] = e.target.checked;\n            updateApplyButtonState();\n        });\n        // Stop propagation to prevent expand/collapse when clicking checkbox\n        cb.addEventListener(\"click\", (e) => e.stopPropagation());\n    });\n    \n    // Expand/collapse on item click\n    document.querySelectorAll(\".preview-item\").forEach(item => {\n        item.addEventListener(\"click\", (e) => {\n            if (e.target.classList.contains(\"preview-checkbox\")) return;\n            const index = parseInt(item.dataset.index);\n            toggleExpand(index);\n        });\n        \n        // Hover highlighting\n        item.addEventListener(\"mouseenter\", () => {\n            const index = parseInt(item.dataset.index);\n            highlightRange(state.pendingActions[index]?.target);\n        });\n        \n        item.addEventListener(\"mouseleave\", () => {\n            clearHighlight();\n        });\n    });\n    \n    // Select all button\n    document.getElementById(\"selectAllBtn\")?.addEventListener(\"click\", toggleSelectAll);\n}\n\n/**\n * Toggles expand/collapse for a preview item\n */\nfunction toggleExpand(index) {\n    state.preview.expandedIndex = state.preview.expandedIndex === index ? -1 : index;\n    showPreviewPanel(); // Re-render\n}\n\n/**\n * Toggles select all / deselect all\n */\nfunction toggleSelectAll() {\n    const allSelected = state.preview.selections.every(s => s);\n    state.preview.selections = state.preview.selections.map(() => !allSelected);\n    showPreviewPanel(); // Re-render\n}\n\n/**\n * Updates the Apply button state based on selections\n */\nfunction updateApplyButtonState() {\n    const applyBtn = document.getElementById(\"applyBtn\");\n    const hasSelected = hasSelectedActions(state.preview.selections);\n    const isReadOnly = state.mode === \"readonly\";\n    applyBtn.disabled = !hasSelected || isReadOnly;\n    \n    // Update button text to indicate read-only mode\n    if (isReadOnly) {\n        applyBtn.textContent = \"Read-Only Mode\";\n    } else {\n        applyBtn.textContent = \"Apply Changes\";\n    }\n}\n\n/**\n * Highlights a range in Excel\n */\nasync function highlightRange(rangeAddress) {\n    if (!rangeAddress) return;\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheet = ctx.workbook.worksheets.getActiveWorksheet();\n            const range = sheet.getRange(rangeAddress);\n            range.select();\n            await ctx.sync();\n        });\n    } catch (e) {\n        // Silently fail - range might be invalid\n        console.warn(\"Could not highlight range:\", rangeAddress, e);\n    }\n}\n\n/**\n * Clears any active highlighting (no-op for now, selection persists)\n */\nasync function clearHighlight() {\n    // Excel doesn't have a \"clear selection\" API\n    // The selection will change when user interacts with Excel\n}\n\n// ============================================================================\n// Theme Toggle\n// ============================================================================\n\n/**\n * Toggles between light and dark theme\n */\nfunction toggleTheme() {\n    const html = document.documentElement;\n    const currentTheme = html.getAttribute('data-theme');\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n    html.setAttribute('data-theme', newTheme);\n    localStorage.setItem(CONFIG.THEME_KEY, newTheme);\n    toast(newTheme === 'dark' ? 'Dark mode' : 'Light mode');\n}\n\n/**\n * Sets the mode (edit or readonly)\n */\nfunction setMode(mode) {\n    state.mode = mode;\n    localStorage.setItem(\"excel_copilot_mode\", mode);\n    \n    // Update button states\n    const editBtn = document.getElementById(\"editModeBtn\");\n    const readOnlyBtn = document.getElementById(\"readOnlyModeBtn\");\n    \n    if (editBtn && readOnlyBtn) {\n        editBtn.classList.toggle(\"active\", mode === \"edit\");\n        readOnlyBtn.classList.toggle(\"active\", mode === \"readonly\");\n    }\n    \n    // Update apply button\n    updateApplyButtonState();\n    \n    toast(mode === \"edit\" ? \"Edit mode\" : \"Read-only mode\");\n}\n\n/**\n * Initializes mode buttons based on saved state\n */\nfunction initModeButtons() {\n    const editBtn = document.getElementById(\"editModeBtn\");\n    const readOnlyBtn = document.getElementById(\"readOnlyModeBtn\");\n    \n    if (editBtn && readOnlyBtn) {\n        editBtn.classList.toggle(\"active\", state.mode === \"edit\");\n        readOnlyBtn.classList.toggle(\"active\", state.mode === \"readonly\");\n    }\n}\n\n// ============================================================================\n// Keyboard Shortcuts\n// ============================================================================\n\n/**\n * Handles keyboard shortcuts\n */\nfunction handleKeyboardShortcuts(e) {\n    // Ctrl+Enter or Cmd+Enter to send message\n    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\n        const input = document.getElementById(\"promptInput\");\n        if (document.activeElement === input && input.value.trim()) {\n            e.preventDefault();\n            handleSend();\n        }\n    }\n    \n    // Ctrl+Z or Cmd+Z to undo (when not in input)\n    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n        const activeEl = document.activeElement;\n        if (activeEl.tagName !== 'INPUT' && activeEl.tagName !== 'TEXTAREA') {\n            if (state.history.entries.length > 0) {\n                e.preventDefault();\n                performUndo();\n            }\n        }\n    }\n    \n    // Escape to close modal or clear input\n    if (e.key === 'Escape') {\n        const modal = document.getElementById(\"modal\");\n        if (modal.classList.contains('open')) {\n            closeModal();\n        } else {\n            const input = document.getElementById(\"promptInput\");\n            if (input.value) {\n                input.value = '';\n                document.getElementById(\"sendBtn\").disabled = true;\n            }\n        }\n    }\n    \n    // Ctrl+D or Cmd+D to toggle dark mode\n    if ((e.ctrlKey || e.metaKey) && e.key === 'd') {\n        e.preventDefault();\n        toggleTheme();\n    }\n}\n\n// ============================================================================\n// Better Error Handling\n// ============================================================================\n\n/**\n * Validates a range address\n */\nfunction isValidRange(address) {\n    if (!address) return false;\n    // Basic Excel range pattern: A1, A1:B10, Sheet1!A1:B10\n    const pattern = /^([A-Za-z_][A-Za-z0-9_]*!)?(\\$?[A-Z]+\\$?\\d+)(:\\$?[A-Z]+\\$?\\d+)?$/i;\n    return pattern.test(address);\n}\n\n/**\n * Gets a user-friendly error message\n */\nfunction getErrorMessage(error, context = '') {\n    const msg = error.message || String(error);\n    \n    // API errors\n    if (msg.includes('401') || msg.includes('403')) {\n        return 'Invalid API key. Please check your settings.';\n    }\n    if (msg.includes('429')) {\n        return 'Rate limit exceeded. Please wait a moment and try again.';\n    }\n    if (msg.includes('500') || msg.includes('502') || msg.includes('503')) {\n        return 'AI service temporarily unavailable. Retrying...';\n    }\n    if (msg.includes('network') || msg.includes('fetch')) {\n        return 'Network error. Please check your connection.';\n    }\n    \n    // Excel errors\n    if (msg.includes('InvalidReference') || msg.includes('invalid range')) {\n        return `Invalid cell reference${context ? ': ' + context : ''}. Please check the range.`;\n    }\n    if (msg.includes('RichApi')) {\n        return 'Excel error. Please try again.';\n    }\n    \n    // Generic\n    return msg.length > 100 ? msg.substring(0, 100) + '...' : msg;\n}\n\n/**\n * Retries a function with exponential backoff\n */\nasync function withRetry(fn, maxRetries = CONFIG.MAX_RETRIES) {\n    let lastError;\n    for (let i = 0; i < maxRetries; i++) {\n        try {\n            return await fn();\n        } catch (e) {\n            lastError = e;\n            const msg = e.message || '';\n            // Only retry on transient errors\n            if (msg.includes('429') || msg.includes('500') || msg.includes('502') || msg.includes('503')) {\n                const delay = CONFIG.RETRY_DELAY * Math.pow(2, i);\n                await new Promise(r => setTimeout(r, delay));\n                continue;\n            }\n            throw e;\n        }\n    }\n    throw lastError;\n}\n\n// ============================================================================\n// History and Undo Functions\n// ============================================================================\n\n/**\n * Generates a unique ID for history entries\n */\nfunction generateHistoryId() {\n    return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);\n}\n\n/**\n * Captures the current state of a range for undo\n * @param {Excel.RequestContext} ctx - Excel context\n * @param {Excel.Worksheet} sheet - Active worksheet\n * @param {string} rangeAddress - The range to capture\n * @returns {Promise<Object>} The captured undo data\n */\nasync function captureUndoData(ctx, sheet, rangeAddress) {\n    try {\n        const range = sheet.getRange(rangeAddress);\n        range.load([\"values\", \"formulas\", \"address\"]);\n        await ctx.sync();\n        \n        return {\n            values: range.values,\n            formulas: range.formulas,\n            address: range.address\n        };\n    } catch (e) {\n        console.warn(\"Could not capture undo data:\", e);\n        return null;\n    }\n}\n\n/**\n * Adds an action to history\n */\nfunction addActionToHistory(action, undoData) {\n    const entry = {\n        id: generateHistoryId(),\n        type: action.type,\n        target: action.target,\n        timestamp: Date.now(),\n        undoData: undoData\n    };\n    \n    // Prepend to history\n    state.history.entries = [entry, ...state.history.entries];\n    \n    // Enforce max limit\n    if (state.history.entries.length > state.history.maxEntries) {\n        state.history.entries = state.history.entries.slice(0, state.history.maxEntries);\n    }\n    \n    updateUndoButtonState();\n    if (state.history.panelVisible) {\n        renderHistoryPanel();\n    }\n}\n\n/**\n * Performs undo of the most recent action\n */\nasync function performUndo() {\n    if (!state.history.entries.length) {\n        toast(\"Nothing to undo\");\n        return;\n    }\n    \n    const entry = state.history.entries[0];\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheet = ctx.workbook.worksheets.getActiveWorksheet();\n            const range = sheet.getRange(entry.undoData.address);\n            \n            // Restore formulas (which also restores values for non-formula cells)\n            range.formulas = entry.undoData.formulas;\n            await ctx.sync();\n        });\n        \n        // Remove from history\n        state.history.entries = state.history.entries.slice(1);\n        \n        updateUndoButtonState();\n        if (state.history.panelVisible) {\n            renderHistoryPanel();\n        }\n        \n        toast(\"Undone\");\n        await readExcelData();\n    } catch (e) {\n        console.error(\"Undo failed:\", e);\n        toast(\"Undo failed\");\n        // Keep entry in history on failure\n    }\n}\n\n/**\n * Updates the Undo button state\n */\nfunction updateUndoButtonState() {\n    const undoBtn = document.getElementById(\"undoBtn\");\n    if (undoBtn) {\n        undoBtn.disabled = state.history.entries.length === 0;\n    }\n}\n\n/**\n * Formats a timestamp as relative time\n */\nfunction formatRelativeTime(timestamp) {\n    const now = Date.now();\n    const diff = now - timestamp;\n    \n    const seconds = Math.floor(diff / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    \n    if (seconds < 60) return 'just now';\n    if (minutes < 60) return `${minutes} min ago`;\n    if (hours < 24) return `${hours} hr ago`;\n    if (days === 1) return 'yesterday';\n    return `${days} days ago`;\n}\n\n/**\n * Renders the history panel\n */\nfunction renderHistoryPanel() {\n    const list = document.getElementById(\"historyList\");\n    if (!list) return;\n    \n    if (!state.history.entries.length) {\n        list.innerHTML = '<div class=\"history-empty\">No actions yet</div>';\n        return;\n    }\n    \n    const typeLabels = {\n        formula: \"Formula\",\n        values: \"Values\",\n        format: \"Format\",\n        chart: \"Chart\",\n        validation: \"Dropdown\",\n        sort: \"Sort\",\n        autofill: \"Autofill\"\n    };\n    \n    const html = state.history.entries.map(entry => {\n        const icon = getActionIcon(entry.type);\n        const label = typeLabels[entry.type] || entry.type;\n        const timeStr = formatRelativeTime(entry.timestamp);\n        \n        return `\n            <div class=\"history-entry\" data-id=\"${entry.id}\">\n                <div class=\"history-icon ${entry.type}\">${icon}</div>\n                <div class=\"history-content\">\n                    <span class=\"history-label\">${label}</span>\n                    <span class=\"history-target\">${entry.target}</span>\n                </div>\n                <span class=\"history-time\">${timeStr}</span>\n            </div>\n        `;\n    }).join('');\n    \n    list.innerHTML = html;\n}\n\n/**\n * Toggles history panel visibility\n */\nfunction toggleHistoryPanel() {\n    state.history.panelVisible = !state.history.panelVisible;\n    const panel = document.getElementById(\"historyPanel\");\n    const btn = document.getElementById(\"historyBtn\");\n    \n    if (panel) {\n        panel.style.display = state.history.panelVisible ? \"block\" : \"none\";\n        if (state.history.panelVisible) {\n            renderHistoryPanel();\n        }\n    }\n    \n    if (btn) {\n        btn.classList.toggle(\"active\", state.history.panelVisible);\n    }\n}\n\n// ============================================================================\n// Apply Actions\n// ============================================================================\nasync function handleApply() {\n    // Check if in read-only mode\n    if (state.mode === \"readonly\") {\n        toast(\"Read-only mode: Cannot apply changes\");\n        return;\n    }\n    \n    // Get only selected actions\n    const selectedActions = filterSelectedActions(state.pendingActions, state.preview.selections);\n    \n    if (!selectedActions.length) {\n        toast(\"Nothing to apply\");\n        return;\n    }\n    \n    const applyBtn = document.getElementById(\"applyBtn\");\n    applyBtn.disabled = true;\n    applyBtn.textContent = \"Applying...\";\n    \n    let successCount = 0;\n    let errorMsg = \"\";\n    \n    try {\n        await Excel.run(async (ctx) => {\n            const sheet = ctx.workbook.worksheets.getActiveWorksheet();\n            \n            for (const action of selectedActions) {\n                try {\n                    // Capture undo data before applying (skip for charts - can't undo)\n                    let undoData = null;\n                    if (action.type !== 'chart') {\n                        undoData = await captureUndoData(ctx, sheet, action.target);\n                    }\n                    \n                    await executeAction(ctx, sheet, action);\n                    await ctx.sync();\n                    successCount++;\n                    \n                    // Add to history if we have undo data\n                    if (undoData) {\n                        addActionToHistory(action, undoData);\n                    }\n                } catch (e) {\n                    errorMsg = e.message;\n                    console.error(\"Action failed:\", e);\n                }\n            }\n        });\n        \n        if (successCount === selectedActions.length) {\n            addMessage(\"ai\", `${successCount} change${successCount > 1 ? 's' : ''} applied successfully.`, \"success\");\n            toast(\"Applied\");\n        } else if (successCount > 0) {\n            addMessage(\"ai\", `${successCount}/${selectedActions.length} changes applied. Error: ${errorMsg}`, \"error\");\n        } else {\n            addMessage(\"ai\", `Failed: ${errorMsg}`, \"error\");\n        }\n        \n        // Clear pending actions and hide preview\n        state.pendingActions = [];\n        hidePreviewPanel();\n        await readExcelData();\n    } catch (err) {\n        addMessage(\"ai\", \"Failed: \" + err.message, \"error\");\n        toast(\"Failed\");\n    }\n    \n    applyBtn.disabled = true;\n    applyBtn.textContent = \"Apply Changes\";\n}\n\nasync function executeAction(ctx, sheet, action) {\n    const { type, target, source, validationType, chartType, data } = action;\n    \n    // Sheet creation doesn't need a range\n    if (type === \"sheet\") {\n        await createSheet(ctx, target, data);\n        return;\n    }\n    \n    if (!target) throw new Error(\"No target specified\");\n    \n    const range = sheet.getRange(target);\n    range.load([\"rowCount\", \"columnCount\"]);\n    await ctx.sync();\n    \n    switch (type) {\n        case \"formula\":\n            await applyFormula(range, data);\n            break;\n            \n        case \"values\":\n            applyValues(range, data);\n            break;\n            \n        case \"format\":\n            await applyFormat(ctx, range, data);\n            break;\n            \n        case \"conditionalFormat\":\n            await applyConditionalFormat(ctx, range, data);\n            break;\n            \n        case \"clearFormat\":\n            await clearConditionalFormat(ctx, range);\n            break;\n            \n        case \"validation\":\n            await applyValidation(ctx, sheet, range, source);\n            break;\n            \n        case \"chart\":\n            createChart(sheet, range, action);\n            break;\n            \n        case \"sort\":\n            applySort(range, data);\n            break;\n            \n        case \"autofill\":\n            if (source) {\n                const sourceRange = sheet.getRange(source);\n                sourceRange.autoFill(range, Excel.AutoFillType.fillDefault);\n            }\n            break;\n            \n        case \"copy\":\n            await applyCopy(ctx, sheet, source, target);\n            break;\n            \n        case \"copyValues\":\n            await applyCopyValues(ctx, sheet, source, target);\n            break;\n            \n        case \"sheet\":\n            await createSheet(ctx, target, data);\n            break;\n            \n        case \"filter\":\n            await applyFilter(ctx, sheet, range, data);\n            break;\n            \n        case \"clearFilter\":\n            await clearFilter(ctx, sheet);\n            break;\n            \n        case \"removeDuplicates\":\n            await removeDuplicates(ctx, range, data);\n            break;\n            \n        default:\n            if (data) range.values = [[data]];\n    }\n}\n\n/**\n * Creates a new sheet with optional name\n */\nasync function createSheet(ctx, sheetName, data) {\n    if (!sheetName) {\n        throw new Error(\"Sheet name is required\");\n    }\n    \n    const sheets = ctx.workbook.worksheets;\n    // Use add() with proper parameters - name is optional, position is optional\n    const newSheet = sheets.add();\n    newSheet.name = sheetName;\n    \n    // If data is provided, populate it\n    if (data) {\n        try {\n            const values = JSON.parse(data);\n            if (Array.isArray(values) && values.length > 0) {\n                const range = newSheet.getRange(`A1:${String.fromCharCode(64 + values[0].length)}${values.length}`);\n                range.values = values;\n            }\n        } catch (e) {\n            // Data parsing failed, just create empty sheet\n        }\n    }\n}\n\n/**\n * Copies data from source range to target range\n */\nasync function applyCopy(ctx, sheet, source, target) {\n    if (!source || !target) {\n        throw new Error(\"Copy requires both source and target ranges\");\n    }\n    \n    const sourceRange = sheet.getRange(source);\n    sourceRange.load([\"values\", \"formulas\", \"rowCount\", \"columnCount\"]);\n    await ctx.sync();\n    \n    // Get source dimensions\n    const rowCount = sourceRange.rowCount;\n    const colCount = sourceRange.columnCount;\n    \n    // If target is a single cell, resize it to match source dimensions\n    const targetCell = sheet.getRange(target);\n    const targetRange = targetCell.getResizedRange(rowCount - 1, colCount - 1);\n    \n    // Copy formulas (preserves both formulas and values)\n    targetRange.formulas = sourceRange.formulas;\n}\n\n/**\n * Copies only values (not formulas) from source range to target range\n */\nasync function applyCopyValues(ctx, sheet, source, target) {\n    if (!source || !target) {\n        throw new Error(\"Copy requires both source and target ranges\");\n    }\n    \n    const sourceRange = sheet.getRange(source);\n    sourceRange.load([\"values\", \"rowCount\", \"columnCount\"]);\n    await ctx.sync();\n    \n    // Get source dimensions\n    const rowCount = sourceRange.rowCount;\n    const colCount = sourceRange.columnCount;\n    \n    // Parse target to get the starting cell\n    // If target is already a range (e.g., \"A2:A51\"), extract just the first cell\n    const targetAddress = target.includes(\":\") ? target.split(\":\")[0] : target;\n    \n    // Get the starting cell and resize to match source\n    const targetCell = sheet.getRange(targetAddress);\n    const targetRange = targetCell.getResizedRange(rowCount - 1, colCount - 1);\n    \n    // Copy only values (converts formulas to their results)\n    targetRange.values = sourceRange.values;\n}\n\nasync function applyFormula(range, formula) {\n    const rows = range.rowCount;\n    const cols = range.columnCount;\n    \n    // For single cell, just set the formula\n    if (rows === 1 && cols === 1) {\n        range.formulas = [[formula]];\n        return;\n    }\n    \n    // For multi-row ranges, try autofill first, fallback to manual if it fails\n    if (rows > 1) {\n        try {\n            // Set formula in first cell only\n            const firstCell = range.getCell(0, 0);\n            firstCell.formulas = [[formula]];\n            \n            // Use autofill to copy down (Excel handles this efficiently)\n            firstCell.autoFill(range, Excel.AutoFillType.fillDefault);\n            return;\n        } catch (e) {\n            // Autofill failed, fall through to manual method\n            console.warn(\"Autofill failed, using manual formula array:\", e);\n        }\n    }\n    \n    // Manual method: build formula array for multi-row ranges\n    if (rows > 1 && cols === 1) {\n        const formulas = [];\n        for (let r = 0; r < rows; r++) {\n            let f = formula;\n            if (r > 0) {\n                // Adjust row numbers in cell references\n                f = formula.replace(/(\\$?)([A-Z]+)(\\$?)(\\d+)/g, (match, colAbs, col, rowAbs, row) => {\n                    if (rowAbs === \"$\") return match;\n                    const newRow = parseInt(row) + r;\n                    return `${colAbs}${col}${rowAbs}${newRow}`;\n                });\n            }\n            formulas.push([f]);\n        }\n        range.formulas = formulas;\n        return;\n    }\n    \n    // For single-row, multi-column ranges, build the formula array\n    const formulas = [[]];\n    for (let c = 0; c < cols; c++) {\n        let f = formula;\n        if (c > 0) {\n            // Adjust cell references for each column\n            // Match pattern: optional$, column letters, optional$, row number\n            f = formula.replace(/(\\$?)([A-Z]+)(\\$?)(\\d+)/g, (match, colAbs, col, rowAbs, row) => {\n                // If column has $ before it (absolute reference), don't adjust\n                if (colAbs === \"$\") return match;\n                // Otherwise, increment the column letter\n                const colCode = col.charCodeAt(0);\n                const newCol = String.fromCharCode(colCode + c);\n                return `${colAbs}${newCol}${rowAbs}${row}`;\n            });\n        }\n        formulas[0].push(f);\n    }\n    \n    range.formulas = formulas;\n}\n\nfunction applyValues(range, data) {\n    let values;\n    try {\n        values = JSON.parse(data);\n        if (!Array.isArray(values)) values = [[values]];\n        if (!Array.isArray(values[0])) values = [values];\n    } catch {\n        values = [[data]];\n    }\n    range.values = values;\n}\n\nasync function applyFormat(ctx, range, data) {\n    let fmt;\n    try { fmt = JSON.parse(data); } catch { fmt = {}; }\n    \n    if (fmt.bold) range.format.font.bold = true;\n    if (fmt.italic) range.format.font.italic = true;\n    if (fmt.fill) range.format.fill.color = fmt.fill;\n    if (fmt.fontColor) range.format.font.color = fmt.fontColor;\n    if (fmt.fontSize) range.format.font.size = fmt.fontSize;\n    if (fmt.numberFormat) range.numberFormat = [[fmt.numberFormat]];\n    if (fmt.border) {\n        range.format.borders.getItem(\"EdgeTop\").style = \"Continuous\";\n        range.format.borders.getItem(\"EdgeBottom\").style = \"Continuous\";\n        range.format.borders.getItem(\"EdgeLeft\").style = \"Continuous\";\n        range.format.borders.getItem(\"EdgeRight\").style = \"Continuous\";\n    }\n}\n\n/**\n * Applies conditional formatting to a range\n * Supports multiple rules in a single action\n */\nasync function applyConditionalFormat(ctx, range, data) {\n    let rules;\n    try { \n        const parsed = JSON.parse(data);\n        // Support both single rule and array of rules\n        rules = Array.isArray(parsed) ? parsed : [parsed];\n    } catch { \n        rules = []; \n    }\n    \n    // Clear existing conditional formats only once\n    range.conditionalFormats.clearAll();\n    await ctx.sync();\n    \n    // Add each conditional format rule\n    for (const rule of rules) {\n        if (rule.type === \"cellValue\" && rule.operator && rule.value) {\n            const cf = range.conditionalFormats.add(Excel.ConditionalFormatType.cellValue);\n            cf.cellValue.format.fill.color = rule.fill || \"#FFFF00\";\n            \n            // Handle different operators\n            let operator = rule.operator;\n            if (operator === \"GreaterThan\") operator = Excel.ConditionalCellValueOperator.greaterThan;\n            else if (operator === \"LessThan\") operator = Excel.ConditionalCellValueOperator.lessThan;\n            else if (operator === \"EqualTo\") operator = Excel.ConditionalCellValueOperator.equalTo;\n            else if (operator === \"GreaterThanOrEqual\") operator = Excel.ConditionalCellValueOperator.greaterThanOrEqual;\n            else if (operator === \"LessThanOrEqual\") operator = Excel.ConditionalCellValueOperator.lessThanOrEqual;\n            else if (operator === \"Between\") operator = Excel.ConditionalCellValueOperator.between;\n            \n            cf.cellValue.rule = {\n                formula1: String(rule.value),\n                formula2: rule.value2 ? String(rule.value2) : undefined,\n                operator: operator\n            };\n        }\n    }\n}\n\n/**\n * Clears all conditional formatting from a range\n */\nasync function clearConditionalFormat(ctx, range) {\n    range.conditionalFormats.clearAll();\n    await ctx.sync();\n}\n\nasync function applyValidation(ctx, sheet, range, source) {\n    if (source) {\n        // Clear any existing validation first\n        range.dataValidation.clear();\n        await ctx.sync();\n        \n        // Get the source range to extract unique values\n        const sourceRange = sheet.getRange(source);\n        sourceRange.load(\"values\");\n        await ctx.sync();\n        \n        // Extract unique non-empty values\n        const uniqueValues = [];\n        const seen = new Set();\n        for (const row of sourceRange.values) {\n            const val = row[0];\n            if (val !== null && val !== undefined && val !== \"\" && !seen.has(val)) {\n                seen.add(val);\n                uniqueValues.push(String(val));\n            }\n        }\n        \n        // Create comma-separated list for validation\n        const listSource = uniqueValues.join(\",\");\n        \n        // Set the validation rule with explicit list\n        range.dataValidation.rule = {\n            list: {\n                inCellDropDown: true,\n                source: listSource\n            }\n        };\n    }\n}\n\nfunction createChart(sheet, dataRange, action) {\n    const { chartType, data } = action;\n    const ct = (chartType || \"column\").toLowerCase();\n    \n    // Parse additional options from data if provided\n    let title = \"Chart\";\n    let position = \"H2\";\n    \n    // Try to extract title and position from action attributes or data\n    if (action.title) title = action.title;\n    if (action.position) position = action.position;\n    \n    // Determine chart type\n    let type = Excel.ChartType.columnClustered;\n    \n    if (ct.includes(\"line\")) {\n        type = Excel.ChartType.line;\n    } else if (ct.includes(\"pie\")) {\n        type = Excel.ChartType.pie;\n    } else if (ct.includes(\"doughnut\") || ct.includes(\"donut\")) {\n        type = Excel.ChartType.doughnut;\n    } else if (ct.includes(\"bar\")) {\n        type = Excel.ChartType.barClustered;\n    } else if (ct.includes(\"area\")) {\n        type = Excel.ChartType.area;\n    } else if (ct.includes(\"scatter\") || ct.includes(\"xy\")) {\n        type = Excel.ChartType.xyscatter;\n    } else if (ct.includes(\"radar\") || ct.includes(\"spider\")) {\n        type = Excel.ChartType.radar;\n    } else if (ct.includes(\"stacked\")) {\n        if (ct.includes(\"bar\")) {\n            type = Excel.ChartType.barStacked;\n        } else {\n            type = Excel.ChartType.columnStacked;\n        }\n    }\n    \n    // Handle the data range - check if it's a valid contiguous range\n    let chartDataRange = dataRange;\n    const targetAddress = action.target;\n    \n    // Check if target contains comma (non-contiguous) - not supported directly\n    if (targetAddress && targetAddress.includes(\",\")) {\n        // For non-contiguous ranges, we need to use the first range\n        // and add series manually, or use a contiguous subset\n        const ranges = targetAddress.split(\",\").map(r => r.trim());\n        // Use the full data range if available, otherwise first range\n        chartDataRange = sheet.getRange(ranges[0]);\n    }\n    \n    // Create the chart\n    const chart = sheet.charts.add(type, chartDataRange, Excel.ChartSeriesBy.auto);\n    \n    // Calculate end position (chart size roughly 8 cols x 15 rows)\n    const startCol = position.match(/[A-Z]+/)?.[0] || \"H\";\n    const startRow = parseInt(position.match(/\\d+/)?.[0] || \"2\");\n    const endCol = String.fromCharCode(startCol.charCodeAt(0) + 8);\n    const endRow = startRow + 15;\n    const endPosition = `${endCol}${endRow}`;\n    \n    chart.setPosition(position, endPosition);\n    \n    // Set title\n    chart.title.text = title;\n    chart.title.visible = true;\n    \n    // Style the chart\n    chart.legend.visible = true;\n    chart.legend.position = Excel.ChartLegendPosition.bottom;\n    \n    // For pie charts, show data labels\n    if (ct.includes(\"pie\") || ct.includes(\"doughnut\")) {\n        chart.legend.position = Excel.ChartLegendPosition.right;\n    }\n    \n    // For line/trend charts, improve readability\n    if (ct.includes(\"line\") || ct.includes(\"trend\")) {\n        chart.legend.position = Excel.ChartLegendPosition.bottom;\n    }\n}\n\nfunction applySort(range, data) {\n    let opts = {};\n    \n    // Parse data - can be JSON or simple format\n    if (typeof data === \"string\") {\n        try {\n            opts = JSON.parse(data);\n        } catch {\n            // Try to parse simple format like \"column:1,ascending:true\"\n            const parts = data.split(\",\");\n            for (const part of parts) {\n                const [key, value] = part.split(\":\").map(s => s.trim());\n                if (key === \"column\") opts.column = parseInt(value) || 0;\n                if (key === \"ascending\") opts.ascending = value !== \"false\";\n                if (key === \"hasHeaders\") opts.hasHeaders = value === \"true\";\n            }\n        }\n    } else {\n        opts = data || {};\n    }\n    \n    // Default to first column, ascending, with headers\n    const columnIndex = opts.column || 0;\n    const ascending = opts.ascending !== false;\n    const hasHeaders = opts.hasHeaders !== false; // Default to true (has headers)\n    \n    range.sort.apply(\n        [{ \n            key: columnIndex, \n            ascending: ascending \n        }],\n        false, // matchCase\n        hasHeaders, // hasHeaders - true means first row is header and won't be sorted\n        Excel.SortOrientation.rows\n    );\n}\n\n/**\n * Applies AutoFilter to a range\n * @param {Object} ctx - Excel context\n * @param {Object} sheet - Excel worksheet\n * @param {Object} range - Excel range\n * @param {string} data - Filter criteria as JSON string\n */\nasync function applyFilter(ctx, sheet, range, data) {\n    let filterOpts = {};\n    \n    // Parse filter options\n    if (typeof data === \"string\") {\n        try {\n            filterOpts = JSON.parse(data);\n        } catch {\n            throw new Error(\"Invalid filter data format\");\n        }\n    } else {\n        filterOpts = data || {};\n    }\n    \n    // Try to clear any existing autofilter (ignore errors if none exists)\n    try {\n        sheet.autoFilter.clearCriteria();\n        await ctx.sync();\n    } catch (e) {\n        // No existing filter, continue\n    }\n    \n    // Apply AutoFilter to the range\n    sheet.autoFilter.apply(range);\n    await ctx.sync();\n    \n    // If specific column filters are provided, apply them\n    if (filterOpts.column !== undefined && filterOpts.values) {\n        // Get the filter criteria for the specified column\n        const criteria = {\n            filterOn: Excel.FilterOn.values,\n            values: filterOpts.values\n        };\n        \n        // Apply the filter criteria to the column\n        sheet.autoFilter.apply(range, filterOpts.column, criteria);\n        await ctx.sync();\n    }\n}\n\n/**\n * Clears all filters from the worksheet\n * @param {Object} ctx - Excel context\n * @param {Object} sheet - Excel worksheet\n */\nasync function clearFilter(ctx, sheet) {\n    try {\n        sheet.autoFilter.clearCriteria();\n        await ctx.sync();\n    } catch (e) {\n        // No filter to clear, ignore\n    }\n}\n\n/**\n * Removes duplicate rows from a range\n * @param {Object} ctx - Excel context\n * @param {Object} range - Excel range\n * @param {string} data - JSON string with columns array\n */\nasync function removeDuplicates(ctx, range, data) {\n    // Load the range data and address\n    range.load([\"values\", \"rowCount\", \"columnCount\", \"address\"]);\n    await ctx.sync();\n    \n    const values = range.values;\n    const rowCount = range.rowCount;\n    const colCount = range.columnCount;\n    const rangeAddress = range.address;\n    \n    // Parse options (which columns to check for duplicates)\n    let options = { columns: [] };\n    if (data) {\n        try {\n            options = JSON.parse(data);\n        } catch (e) {\n            // Default to all columns\n            options.columns = Array.from({ length: colCount }, (_, i) => i);\n        }\n    }\n    \n    // If no columns specified, use all columns\n    if (!options.columns || options.columns.length === 0) {\n        options.columns = Array.from({ length: colCount }, (_, i) => i);\n    }\n    \n    // Find unique rows (keep first occurrence)\n    const seen = new Set();\n    const uniqueRows = [];\n    \n    for (let r = 0; r < rowCount; r++) {\n        const row = values[r];\n        \n        // Create a key from the specified columns\n        const key = options.columns.map(colIdx => {\n            const val = row[colIdx];\n            return val === null || val === undefined ? \"\" : String(val);\n        }).join(\"|\");\n        \n        if (!seen.has(key)) {\n            seen.add(key);\n            uniqueRows.push(row);\n        }\n    }\n    \n    // Clear the original range\n    range.clear(Excel.ClearApplyTo.contents);\n    await ctx.sync();\n    \n    // Write back only unique rows\n    if (uniqueRows.length > 0) {\n        // Get the sheet and create a new range reference from the original address\n        const sheet = range.worksheet;\n        const address = rangeAddress.split(\"!\")[1] || rangeAddress; // Remove sheet name if present\n        const startCell = address.split(\":\")[0]; // Get starting cell (e.g., \"A1\")\n        \n        // Create a new range from the start cell\n        const targetCell = sheet.getRange(startCell);\n        const newRange = targetCell.getResizedRange(uniqueRows.length - 1, colCount - 1);\n        newRange.values = uniqueRows;\n    }\n}\n\nexport { handleSend, handleApply, readExcelData, clearChat };\n","// Imports\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.css\", import.meta.url);\n// Module\nvar code = \"<!DOCTYPE html> <html lang=\\\"en\\\"> <head> <meta charset=\\\"UTF-8\\\"> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"> <title>Excel Copilot</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1/hosted/office.js\\\"><\" + \"/script> <link href=\\\"\" + ___HTML_LOADER_IMPORT_0___ + \"\\\" rel=\\\"stylesheet\\\"> </head> <body> <div class=\\\"app\\\"> <header class=\\\"header\\\"> <div class=\\\"brand\\\"> <svg class=\\\"logo\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"> <path d=\\\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\\\"/> </svg> <span>Copilot</span> <span class=\\\"version-badge\\\" id=\\\"versionBadge\\\" title=\\\"Click to check for updates\\\">v2.8.0</span> </div> <div class=\\\"header-actions\\\"> <button class=\\\"icon-btn\\\" id=\\\"themeBtn\\\" title=\\\"Toggle Dark Mode\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <path d=\\\"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z\\\"/> </svg> </button> <button class=\\\"icon-btn\\\" id=\\\"historyBtn\\\" title=\\\"History\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"10\\\"/><path d=\\\"M12 6v6l4 2\\\"/> </svg> </button> <button class=\\\"icon-btn\\\" id=\\\"clearBtn\\\" title=\\\"Clear\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <path d=\\\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\\\"/> </svg> </button> <button class=\\\"icon-btn\\\" id=\\\"settingsBtn\\\" title=\\\"Settings\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"3\\\"/><path d=\\\"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z\\\"/> </svg> </button> </div> </header> <main class=\\\"main\\\"> <div id=\\\"welcome\\\" class=\\\"welcome\\\"> <div class=\\\"welcome-icon\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"> <path d=\\\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\\\"/> </svg> </div> <h1>Excel Copilot</h1> <p>Your AI assistant for Excel. Select cells and ask me anything.</p> <div class=\\\"suggestions\\\"> <button data-prompt=\\\"Analyze this data and give me key insights\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\\\"/></svg> Analyze data </button> <button data-prompt=\\\"Create a SUM formula for the selected cells\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M4 7h16M4 12h16M4 17h10\\\"/></svg> Create formula </button> <button data-prompt=\\\"Create a chart to visualize this data\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M18 20V10M12 20V4M6 20v-6\\\"/></svg> Create chart </button> <button data-prompt=\\\"Format this as a professional table with headers\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><rect x=\\\"3\\\" y=\\\"3\\\" width=\\\"18\\\" height=\\\"18\\\" rx=\\\"2\\\"/><path d=\\\"M3 9h18M9 21V9\\\"/></svg> Format table </button> </div> </div> <div id=\\\"chat\\\" class=\\\"chat\\\"></div> <div id=\\\"previewPanel\\\" class=\\\"preview-panel\\\" style=\\\"display:none\\\"> <div class=\\\"preview-header\\\"> <span class=\\\"preview-title\\\">Pending Changes</span> <button class=\\\"icon-btn-sm\\\" id=\\\"selectAllBtn\\\" title=\\\"Select All\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M9 11l3 3L22 4\\\"/><path d=\\\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\\\"/></svg> </button> </div> <div id=\\\"previewList\\\" class=\\\"preview-list\\\"></div> </div> <div id=\\\"historyPanel\\\" class=\\\"history-panel\\\" style=\\\"display:none\\\"> <div class=\\\"history-header\\\"> <span class=\\\"history-title\\\">Action History</span> </div> <div id=\\\"historyList\\\" class=\\\"history-list\\\"></div> </div> </main> <div class=\\\"context-bar\\\"> <span class=\\\"context-label\\\">Data:</span> <span class=\\\"context-info\\\" id=\\\"contextInfo\\\">No selection</span> <div class=\\\"mode-toggle-compact\\\"> <button class=\\\"mode-icon-sm active\\\" id=\\\"editModeBtn\\\" data-mode=\\\"edit\\\" title=\\\"Edit Mode\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7\\\"/><path d=\\\"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z\\\"/></svg> </button> <button class=\\\"mode-icon-sm\\\" id=\\\"readOnlyModeBtn\\\" data-mode=\\\"readonly\\\" title=\\\"Read-Only Mode\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\\\"/><circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"3\\\"/></svg> </button> </div> <button class=\\\"icon-btn-sm\\\" id=\\\"refreshBtn\\\" title=\\\"Refresh\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M23 4v6h-6M1 20v-6h6\\\"/><path d=\\\"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15\\\"/></svg> </button> </div> <div class=\\\"input-area\\\"> <div class=\\\"input-box\\\"> <textarea id=\\\"promptInput\\\" placeholder=\\\"Ask me anything...\\\" rows=\\\"1\\\"></textarea> <button class=\\\"send-btn\\\" id=\\\"sendBtn\\\" disabled=\\\"disabled\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\"><path d=\\\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\\\"/></svg> </button> </div> <div class=\\\"action-buttons\\\"> <button class=\\\"undo-btn\\\" id=\\\"undoBtn\\\" disabled=\\\"disabled\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M3 10h10a5 5 0 015 5v2M3 10l6 6M3 10l6-6\\\"/></svg> Undo </button> <button class=\\\"apply-btn\\\" id=\\\"applyBtn\\\" disabled=\\\"disabled\\\">Apply Changes</button> </div> </div> </div> <div class=\\\"modal\\\" id=\\\"modal\\\"> <div class=\\\"modal-box\\\"> <div class=\\\"modal-header\\\"> <h2>Settings</h2> <button class=\\\"icon-btn\\\" id=\\\"closeModal\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M18 6L6 18M6 6l12 12\\\"/></svg> </button> </div> <div class=\\\"modal-body\\\"> <label>Gemini API Key</label> <div class=\\\"input-row\\\"> <input type=\\\"password\\\" id=\\\"apiKeyInput\\\" placeholder=\\\"Enter your API key\\\"> <button class=\\\"icon-btn\\\" id=\\\"togglePwd\\\"> <svg viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"><path d=\\\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\\\"/><circle cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"3\\\"/></svg> </button> </div> <p class=\\\"hint\\\">Get your free key at <a href=\\\"https://aistudio.google.com/apikey\\\" target=\\\"_blank\\\">Google AI Studio</a></p> <div class=\\\"settings-section\\\"> <label>Mode</label> <div class=\\\"mode-toggle\\\"> <label class=\\\"mode-label\\\"> <input type=\\\"radio\\\" name=\\\"mode\\\" value=\\\"edit\\\" id=\\\"modeEdit\\\" checked=\\\"checked\\\"> <span>Edit Mode</span> </label> <label class=\\\"mode-label\\\"> <input type=\\\"radio\\\" name=\\\"mode\\\" value=\\\"readonly\\\" id=\\\"modeReadOnly\\\"> <span>Read-Only Mode</span> </label> </div> <p class=\\\"hint\\\">Edit mode allows applying changes. Read-only mode prevents modifications.</p> </div> <div class=\\\"settings-section\\\"> <label>AI Learning</label> <p class=\\\"hint\\\">The AI learns from your corrections to improve future suggestions.</p> <button class=\\\"btn-secondary\\\" id=\\\"clearPrefsBtn\\\">Clear Learned Preferences</button> </div> </div> <div class=\\\"modal-footer\\\"> <button class=\\\"btn-cancel\\\" id=\\\"cancelBtn\\\">Cancel</button> <button class=\\\"btn-save\\\" id=\\\"saveBtn\\\">Save</button> </div> </div> </div> <div class=\\\"toast\\\" id=\\\"toast\\\"></div> </body> </html> \";\n// Exports\nexport default code;"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","g","globalThis","this","Function","e","window","o","obj","prop","Object","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","tagName","toUpperCase","src","scripts","getElementsByTagName","length","i","test","Error","replace","p","b","baseURI","self","href","AI_CONFIG","TASK_TYPES","TASK_KEYWORDS","_defineProperty","detectTaskType","prompt","lower","toLowerCase","_i","_Object$entries","entries","_step","_Object$entries$_i","_slicedToArray","taskType","_iterator","_createForOfIteratorHelper","s","n","done","keyword","value","includes","err","f","TASK_PROMPTS","EXCEL_FUNCTIONS","SUM","description","signature","example","AVERAGE","COUNT","COUNTA","MAX","MIN","VLOOKUP","XLOOKUP","INDEX","MATCH","IF","SUMIF","COUNTIF","SUMIFS","CONCATENATE","LEFT","RIGHT","MID","TRIM","UPPER","LOWER","TODAY","NOW","YEAR","MONTH","DAY","DATEDIF","IFERROR","IFNA","FORMULA_PATTERNS","id","keywords","pattern","REASONING_STEPS","requiresMultiStep","some","ind","getStoredCorrections","JSON","parse","localStorage","getItem","_unused","isCorrection","message","trim","startsWith","enhancePrompt","userPrompt","dataContext","isCorrectionMsg","systemPrompt","corrections","arguments","basePrompt","correctionsContext","keys","_i2","_Object$entries2","_Object$entries2$_i","key","concat","getTaskSpecificPrompt","_step6","context","_iterator6","corr","insight","type","push","rule","formatted","_i4","_Object$entries4","_Object$entries4$_i","rules","_toConsumableArray","Set","slice","join","getCorrectionContext","_i3","_Object$entries3","_Object$entries3$_i","category","funcs","_step2","_iterator2","func","def","getFunctionCallingContext","ragContext","query","patterns","_step3","limit","scored","_iterator3","_step4","score","_iterator4","split","w","_objectSpread","sort","a","searchPatterns","_step5","_iterator5","getRAGContext","enhancedUserPrompt","steps","step","decomposeTask","enhancedPrompt","generateReasoningPrompt","hasMultiStep","processResponse","response","functionCalls","match","callPattern","exec","funcName","target","args","data","parseFunctionCalls","additionalActions","handleCorrection","userMessage","previousAIResponse","original","correction","colMatch","wrong","correct","cellMatch","headerMatch","formatMatch","format","chartMatch","chartType","parseCorrection","Date","now","timestamp","toISOString","splice","setItem","stringify","storeCorrection","t","r","Symbol","iterator","toStringTag","c","Generator","u","create","_regeneratorDefine2","y","G","v","d","bind","l","TypeError","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","apply","_next","_throw","VERSION","CONFIG","state","apiKey","pendingActions","currentData","allSheetsData","conversationHistory","isFirstMessage","lastAIResponse","currentTaskType","mode","preview","selections","expandedIndex","highlightedIndex","history","panelVisible","maxEntries","closeModal","getElementById","classList","remove","_setupSelectionListener","_callee3","_context3","Excel","run","_ref2","_callee2","ctx","_context2","workbook","worksheets","getActiveWorksheet","onSelectionChanged","add","readExcelData","sync","_x42","colIndexToLetter","index","letter","String","fromCharCode","Math","floor","_readExcelData","_callee5","infoEl","_context5","_ref3","_callee4","sheets","maxSheets","sheet","usedRange","sheetName","values","startCol","startRow","rowCount","colCount","headers","columnMap","colLetter","headerName","activeSheet","activeSheetData","_t2","_context4","load","min","items","getUsedRange","name","columnIndex","rowIndex","columnCount","header","address","dataStartRow","console","warn","find","textContent","_x43","showChat","style","display","addMessage","role","content","chat","msg","createElement","className","innerHTML","appendChild","setTimeout","scrollTo","top","scrollHeight","behavior","showTyping","el","scrollTop","hideTyping","_document$getElementB14","showLoadingSkeleton","hideLoadingSkeleton","_document$getElementB15","clearChat","disabled","hidePreviewPanel","hideTaskTypeIndicator","toast","checkForUpdates","_checkForUpdates","_callee6","versionBadge","originalText","code","versionMatch","deployedVersion","currentVersion","_t4","_context6","fetch","text","color","error","handleSend","_handleSend","_callee7","input","_parseResponse","actions","_t5","_context7","click","showTaskTypeIndicator","height","callAI","parseResponse","getTaskTypeBadge","map","showPreviewPanel","parts","getErrorMessage","labels","indicator","_x","_callAI","_callee9","enhanced","fullUserMessage","contents","processed","_context9","buildDataContext","getReadOnlySystemPrompt","withRetry","_callee8","_data$candidates","res","_context8","method","body","systemInstruction","generationConfig","temperature","maxOutputTokens","ok","status","json","candidates","_state$currentData","col","samples","_values$_r","val","substring","maxRows","rowNum","_values$r","uniqueVals","_values$_r2","size","Array","from","row","actionRegex","_attrs$match","_attrs$match2","_attrs$match3","_attrs$match4","_attrs$match5","_attrs$match6","attrs","source","title","position","getActionIcon","icons","formula","chart","validation","autofill","filterSelectedActions","filter","_","panel","list","_document$getElementB16","html","action","isExpanded","isSelected","hasWarning","icon","summary","getActionSummary","details","vals","fmt","bold","italic","fill","fontColor","fontSize","numberFormat","_unused2","getActionDetails","warningClass","renderPreviewItemHTML","querySelectorAll","forEach","cb","addEventListener","parseInt","dataset","checked","updateApplyButtonState","stopPropagation","item","contains","_state$pendingActions","_x2","_highlightRange","highlightRange","_clearHighlight","clearHighlight","toggleSelectAll","allSelected","every","applyBtn","hasSelected","isReadOnly","_callee1","rangeAddress","_t6","_context1","_ref5","_callee0","_context0","getRange","select","_x44","_callee10","_context10","toggleTheme","documentElement","newTheme","getAttribute","setAttribute","setMode","editBtn","readOnlyBtn","toggle","handleKeyboardShortcuts","ctrlKey","metaKey","activeElement","preventDefault","shiftKey","activeEl","performUndo","_x3","_withRetry","_callee11","fn","maxRetries","lastError","_loop","_ret","_args12","_context12","delay","_t7","_t8","_context11","pow","_regeneratorValues","captureUndoData","_x4","_x5","_x6","_captureUndoData","_callee12","range","_t9","_context13","formulas","addActionToHistory","undoData","entry","toString","random","substr","updateUndoButtonState","renderHistoryPanel","_performUndo","_callee14","_t0","_context15","_ref6","_callee13","_context14","_x45","undoBtn","typeLabels","diff","seconds","minutes","hours","days","label","timeStr","toggleHistoryPanel","btn","handleApply","_handleApply","_callee16","selectedActions","successCount","errorMsg","_context17","_ref7","_callee15","_t1","_t10","_context16","executeAction","_x46","_x7","_x8","_x9","_executeAction","_callee17","_t12","_context18","validationType","createSheet","applyFormula","applyValues","applyFormat","applyConditionalFormat","clearConditionalFormat","applyValidation","createChart","applySort","autoFill","AutoFillType","fillDefault","applyCopy","applyCopyValues","applyFilter","clearFilter","removeDuplicates","_x0","_x1","_x10","_createSheet","_callee18","newSheet","_context19","isArray","_x11","_x12","_x13","_x14","_applyCopy","_callee19","sourceRange","_context20","getResizedRange","_x15","_x16","_x17","_x18","_applyCopyValues","_callee20","targetAddress","_context21","_x19","_x20","_applyFormula","_callee21","rows","cols","firstCell","_formulas","_loop2","_loop3","_t13","_context24","getCell","_context22","colAbs","rowAbs","newRow","_context23","colCode","charCodeAt","newCol","_unused3","_x21","_x22","_x23","_applyFormat","_callee22","_context25","_unused5","font","border","borders","_x24","_x25","_x26","_applyConditionalFormat","_callee23","parsed","_iterator7","_step7","cf","operator","_context26","_unused6","conditionalFormats","clearAll","ConditionalFormatType","cellValue","ConditionalCellValueOperator","greaterThan","lessThan","equalTo","greaterThanOrEqual","lessThanOrEqual","between","formula1","formula2","value2","_x27","_x28","_clearConditionalFormat","_callee24","_context27","_x29","_x30","_x31","_x32","_applyValidation","_callee25","uniqueValues","seen","_iterator8","_step8","listSource","_context28","dataValidation","clear","has","inCellDropDown","dataRange","_position$match","_position$match2","ct","ChartType","columnClustered","line","pie","doughnut","barClustered","area","xyscatter","radar","barStacked","columnStacked","chartDataRange","ranges","charts","ChartSeriesBy","auto","endCol","endRow","endPosition","setPosition","visible","legend","ChartLegendPosition","bottom","right","opts","_unused4","_part$split$map2","column","ascending","hasHeaders","SortOrientation","_x33","_x34","_x35","_x36","_applyFilter","_callee26","filterOpts","criteria","_context29","autoFilter","clearCriteria","filterOn","FilterOn","_x37","_x38","_clearFilter","_callee27","_context30","_x39","_x40","_x41","_removeDuplicates","_callee28","options","uniqueRows","_loop4","startCell","_context32","columns","_context31","colIdx","ClearApplyTo","worksheet","Office","onReady","info","host","HostType","cursor","savedTheme","_document$getElementB","_document$getElementB2","_document$getElementB3","_document$getElementB4","_document$getElementB5","_document$getElementB6","_document$getElementB7","_document$getElementB8","_document$getElementB9","_document$getElementB0","_document$getElementB1","_document$getElementB10","_document$getElementB11","_document$getElementB12","_document$getElementB13","sendBtn","savedMode","_callee","_context","_document$querySelect","selectedMode","querySelector","removeItem","inp","setupSelectionListener","initApp","URL"],"ignoreList":[],"sourceRoot":""}